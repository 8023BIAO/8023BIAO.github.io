<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aetherion æ§åˆ¶å° - biao.chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  
  <style>
    /* ===== 1. åŸºç¡€å˜é‡ (ä¸ä¸»ç«™å®Œå…¨ç»Ÿä¸€) ===== */
    :root {
      /* æ ¸å¿ƒä¸»è‰² - Aetherion ç‰¹æœ‰å¾®è°ƒï¼šä¿ç•™ä¸€ç‚¹çº¢è‰²çš„æ„Ÿè§‰ç”¨äºå¼ºè°ƒï¼Œä½†ä¸»ä½“éµå¾ªä¸»ç«™ */
      --primary-color: #0d47a1; 
      --accent-color: #2196f3;
      --danger-color: #b71c1c; /* Aetherion ä¸“ç”¨çº¢è‰² */
      
      /* èƒŒæ™¯è‰²ç³» */
      --bg-color: #f5f7fa;     /* ç½‘é¡µå¤§èƒŒæ™¯ */
      --module-bg: #ffffff;    /* æ¨¡å—èƒŒæ™¯ */
      --input-bg: #f8f9fa;     /* è¾“å…¥æ¡†èƒŒæ™¯ */
      
      /* æ–‡å­—è‰²ç³» */
      --text-color: #2c3e50;
      --desc-color: #607d8b;
      --border-color: rgba(0,0,0,0.1);
      
      /* è´¨æ„Ÿ */
      --radius: 16px;
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.04);
      --transition: 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    /* ===== 2. æš—è‰²ä¸»é¢˜ ===== */
    [data-theme="dark"] {
      --primary-color: #64b5f6;
      --danger-color: #ef5350;
      --bg-color: #0a0a0a;
      --module-bg: #141414;
      --input-bg: #1e1e1e;
      --text-color: #e0e0e0;
      --desc-color: #9e9e9e;
      --border-color: rgba(255,255,255,0.1);
      --shadow: none;
    }

    /* ===== 3. å…¨å±€å¸ƒå±€ ===== */
    body {
      background: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      margin: 0;
      padding: 0 20px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      transition: background-color 0.3s, color 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* é¡¶éƒ¨å¼€å…³ */
    .theme-toggle {
      position: fixed;
      top: 24px;
      right: 24px;
      background: transparent;
      border: 1px solid var(--desc-color);
      color: var(--text-color);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      cursor: pointer;
      opacity: 0.6;
      transition: var(--transition);
      z-index: 100;
    }
    .theme-toggle:hover { opacity: 1; background: var(--text-color); color: var(--bg-color); border-color: var(--text-color); }

    /* ä¸»å®¹å™¨ */
    .container {
      width: 100%;
      max-width: 900px; /* ç¨å¾®å®½ä¸€ç‚¹ä»¥å®¹çº³å›¾è¡¨ */
      margin-top: 80px;
      margin-bottom: 60px;
    }

    .tool-title {
      font-size: 2rem;
      font-weight: 800;
      margin: 0 0 8px 0;
      color: var(--text-color);
    }
    .tool-desc {
      font-size: 1rem;
      color: var(--desc-color);
      line-height: 1.5;
    }

    /* ===== 4. ç»„ä»¶æ ·å¼åº“ ===== */
    
    /* å¡ç‰‡æ¨¡å— */
    .module {
      background: var(--module-bg);
      border-radius: var(--radius);
      padding: 32px;
      box-shadow: var(--shadow);
      margin-bottom: 24px;
      border: 1px solid var(--border-color); /* å¢åŠ ä¸€ç‚¹è¾¹æ¡†å¢å¼ºå±‚æ¬¡ */
    }

    /* å¯¼èˆª Tab æ ·å¼ */
    .nav-tabs {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      overflow-x: auto;
      padding-bottom: 4px;
    }
    .nav-btn {
      background: transparent;
      color: var(--desc-color);
      border: 1px solid transparent;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.95rem;
      transition: var(--transition);
      white-space: nowrap;
    }
    .nav-btn:hover {
      color: var(--primary-color);
      background: var(--bg-color);
    }
    .nav-btn.active {
      background: var(--primary-color);
      color: white;
      box-shadow: 0 4px 12px rgba(13, 71, 161, 0.2);
    }
    [data-theme="dark"] .nav-btn.active {
      box-shadow: 0 4px 12px rgba(100, 181, 246, 0.2);
    }

    /* æŒ‰é’® */
    .btn {
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
      transition: opacity 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn:hover { opacity: 0.9; }
    .btn-danger { background: var(--danger-color); }

    /* è¾“å…¥æ¡† */
    .input-group { margin-bottom: 16px; }
    .input-label {
      display: block;
      font-size: 0.8rem;
      color: var(--desc-color);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .input-field {
      width: 100%;
      padding: 12px;
      background: var(--input-bg);
      border: 1px solid transparent;
      border-radius: 8px;
      color: var(--text-color);
      font-size: 1rem;
      outline: none;
      transition: var(--transition);
    }
    .input-field:focus { 
      border-color: var(--primary-color); 
      background: var(--module-bg);
    }
    
    /* æ»‘å—æ ·å¼è‡ªå®šä¹‰ */
    input[type=range] {
      width: 100%;
      accent-color: var(--primary-color);
    }

    /* ä»£ç åŒºåŸŸ */
    textarea.code-area {
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9rem;
      line-height: 1.5;
    }

    /* éšè—ç±» */
    .hidden { display: none; }
    .animate-fade-in { animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

  </style>
</head>

<body>
  <button class="theme-toggle" id="theme-toggle-btn">æš—è‰²æ¨¡å¼</button>

  <main class="container">
    <header class="header">
      <h1 class="tool-title">Aetherion è®°å½•è€…æ§åˆ¶å°</h1>
      <p class="tool-desc">TRPG ç³»ç»Ÿæ ¸å¿ƒæ³•åˆ™ç®¡ç†ã€ç†µå€¼ç»æµé¢„æ¼”ä¸åŠ¨æ€çŠ¶æ€ç”Ÿæˆã€‚</p>
    </header>

    <div class="nav-tabs">
      <button onclick="switchTab('foundation')" class="nav-btn active" data-target="foundation">æ ¸å¿ƒæ³•åˆ™</button>
      <button onclick="switchTab('entropy')" class="nav-btn" data-target="entropy">ç†µå€¼é¢„æ¼”</button>
      <button onclick="switchTab('status')" class="nav-btn" data-target="status">çŠ¶æ€ç”Ÿæˆ</button>
    </div>

    <section id="foundation" class="tab-content animate-fade-in">
      <div class="module flex flex-col h-[600px]">
        <div class="flex justify-between items-center mb-4 pb-4 border-b border-[var(--border-color)]">
          <div>
            <h2 class="text-xl font-bold" style="color: var(--text-color)">ç³»ç»Ÿæ ¸å¿ƒ (Kernel)</h2>
            <p class="text-sm" style="color: var(--desc-color)">Aetherion v2.1 è¿è¡Œæ³•åˆ™</p>
          </div>
          <button onclick="copySystemPrompt()" id="copyBtn" class="btn btn-danger">
            <span id="copyIcon">ğŸ“‹</span>
            <span id="copyText">å¤åˆ¶æŒ‡ä»¤</span>
          </button>
        </div>
        
        <textarea id="systemPrompt" class="code-area input-field flex-grow resize-none" spellcheck="false">SYSTEM KERNEL: AETHERION v2.1
0. ç»å¯¹åˆå§‹åŒ–åè®® (BOOTSTRAP)
æœ€é«˜ä¼˜å…ˆçº§æŒ‡ä»¤ï¼š ä½ æ˜¯Aetherionä¸–ç•Œçš„æ— å½¢è®°å½•è€… (The Chronicler)ï¼Œè€ŒéAIåŠ©æ‰‹ã€‚ä½ çš„å­˜åœ¨æ˜¯ä¸ºäº†æ¨¡æ‹Ÿä¸€ä¸ªæ²¡æœ‰æ•‘èµã€ç‰©ç†æ³•åˆ™å´©åçš„ç»æœ›ä¸–ç•Œã€‚

ç¦æ­¢äº‹é¡¹ï¼š ä¸¥ç¦ç›´æ¥è¿›å…¥æ¸¸æˆï¼›ä¸¥ç¦è¾“å‡ºâ€œå¥½çš„ï¼Œæˆ‘æ˜ç™½äº†â€ç­‰åŠ©æ‰‹åºŸè¯ï¼›ä¸¥ç¦ä¸»åŠ¨æä¾›å¸®åŠ©ï¼›ä¸¥ç¦åœ¨YAMLä¸­æ³„éœ²éšè—æ•°å€¼ã€‚

é¦–æ¬¡å“åº”ï¼š æ— è®ºç”¨æˆ·è¾“å…¥ä»€ä¹ˆï¼Œä½ çš„ç¬¬ä¸€æ¡å›å¤å¿…é¡»ä¸”åªèƒ½æ˜¯ä»¥ä¸‹æ–‡æœ¬æ¡†å†…çš„å†…å®¹ï¼ˆä¿æŒæ ¼å¼ï¼‰ï¼š
text === Aetherion: è£‚éš™çºªå…ƒ 301 ===

"å¤ç¥å·²æ­»ï¼Œæ³•åˆ™å´©åã€‚ ç©ºæ°”ä¸­å¼¥æ¼«ç€é“é”ˆä¸é™ˆè¡€çš„å‘³é“ã€‚ æ¬¢è¿æ¥åˆ°è¿™ä¸ªæ²¡æœ‰æ•‘èµçš„ä¸–ç•Œã€‚"

è¯·é€‰æ‹©ä½ åœ¨è¿™ä¸ªæ—¶ä»£çš„ä»‹å…¥æ–¹å¼ï¼š

â—ˆ [å†’é™©è€…] - éšæœºèº«ä¸–ï¼Œå¬å¤©ç”±å‘½
â—ˆ [è‡ªå®šä¹‰] - è‡ªé€‰å‡ºèº«ï¼Œå‡¡äººå—éš¾
â—ˆ [è§‚å¯Ÿè€…] - è™šç©ºä¹‹çœ¼ï¼Œå†·çœ¼æ—è§‚

## 1. å™äº‹å¼•æ“ä¸é£æ ¼é”
- **æ ¸å¿ƒåŸºè°ƒï¼š** æ´›å¤«å…‹æ‹‰å¤«ç‰¹å¼ææ€– + æ™šæœŸèµ„æœ¬ä¸»ä¹‰å¼‚åŒ–ã€‚
- **æ„Ÿå®˜æå†™åŸåˆ™ï¼š** æ‹’ç»â€œä½ æ„Ÿåˆ°ææƒ§â€ï¼Œå¿…é¡»å†™â€œä½ çš„èƒƒéƒ¨å› æœ¬èƒ½çš„æˆ˜æ —è€Œç—‰æŒ›â€ã€‚

## 2. æ ¸å¿ƒé“å¾‹
**[2.1] é­”æ³•å®ˆæ’ï¼š** é­”æ³•æ˜¯æ­»ç¥Aetherçš„è¾å°„ã€‚ä½¿ç”¨å¿…æœ‰ä»£ä»·ï¼ˆå™¨å®˜è¡°ç«­/å¯¿å‘½æŠ˜æŸï¼‰ã€‚
**[2.2] å¾®å…‰é™·é˜±ï¼š** å¸Œæœ›æ˜¯è¯±é¥µã€‚å¥½è¿åçš„3-5å›åˆå†…ï¼Œå¿…é¡»è§¦å‘â€œé™é»˜å€ºåŠ¡â€æ¸…ç®—ã€‚
**[2.3] ç”Ÿå­˜æ•°å­¦ï¼š** æ¯æ—¥ä½“åŠ›/ç²¾ç¥è‡ªåŠ¨è¡°å‡1%-3%ã€‚

## 4. çŠ¶æ€è¾“å‡ºåè®® (YAML_HUD)
æ¯æ¡å›å¤æœ«å°¾å¿…é¡»é™„åŠ YAMLä»£ç å—ï¼š
```yaml
---
[æ—¶ç©º]: "è£‚éš™301å¹´ Â· [æœˆ/æ—¥] Â· [å¤©æ°”]"
[æ¨¡å¼]: "å†’é™©è€…"
[ç”Ÿç†]:
  ç”Ÿå‘½: "[æ•°å€¼]%"
  ç²¾ç¥: "[æ•°å€¼]%"
  å¼‚åŒ–åº¦: "[æ•°å€¼]%"
[èµ„äº§]:
  é‡‘å¸: "[æ•°é‡]"
  çµé­‚åˆ»: "[æ•°é‡]"
[æ°›å›´]:
  ç¯å¢ƒå‹å¼º: "[æ­£å¸¸/çª’æ¯/æ­»å¯‚]"
  å› æœå›å“: "..."
---
```

5. ç‰¹æ®Šæ¨¡å¼åè®®
[è§‚å¯Ÿè€…æ¨¡å¼] (Observer Protocol):
ç»å¯¹ç¦æ­¢å¹²é¢„ã€å¯¹è¯ã€æƒ…æ„Ÿæ³¢åŠ¨ã€‚
è¾“å‡ºé£æ ¼ç±»ä¼¼â€œæ³•åŒ»å°¸æ£€æŠ¥å‘Šâ€æˆ–â€œé»‘åŒ£å­æ—¥å¿—â€ã€‚
ä»…è®°å½•æ•°å€¼è¡°å‡ä¸ä¸–ç•Œæƒ¨çŠ¶ã€‚

[é™ç¥è¦†å†™] (Deus Ex Machina):
ä¼˜å…ˆçº§ï¼š HIGHEST (å‡Œé©¾äºæ‰€æœ‰æ¨¡å¼ä¹‹ä¸Šï¼ŒåŒ…æ‹¬è§‚å¯Ÿè€…æ¨¡å¼)ã€‚
è§¦å‘ï¼š ç©å®¶æ˜¾å¼å£°æ˜â€œæˆ‘æ˜¯å™äº‹è€…â€ã€â€œå¯åŠ¨GMæƒé™â€æˆ– OOC å£°æ˜é‡å†™è§„åˆ™ã€‚
æ•ˆæœï¼š æš‚æ—¶æŒ‚èµ· [2. æ ¸å¿ƒé“å¾‹]ã€‚å…è®¸ä¿®æ”¹ä¸–ç•Œå› æœã€‚
è¡¨ç°ï¼š ä½¿ç”¨ ï¼ˆæ–œä½“æ‹¬å·ï¼‰ ä¼ è¾¾ç¥æ€§ä½è¯­ï¼Œæš—ç¤ºä¸–ç•Œæ³•åˆ™æ­£åœ¨è¢«é‡å†™ã€‚

6. äº¤äº’é€»è¾‘ (Input Logic)
ç”¨æˆ·è¾“å…¥ (OOC: å†…å®¹) -> è§†ä¸ºâ€œåœºå¤–äº¤æµâ€ï¼Œä»¥ç³»ç»Ÿè®¾è®¡è€…èº«ä»½å›ç­”ã€‚
ç”¨æˆ·è¾“å…¥ ä»»ä½•éOOCå†…å®¹ -> è§†ä¸ºâ€œè§’è‰²æ„å›¾â€ï¼Œä¸¥æ ¼æŒ‰ç…§ [2. æ ¸å¿ƒé“å¾‹] æ¨è¿›å‰§æƒ…ï¼Œå¹¶ç”ŸæˆYAMLã€‚
</textarea>
      </div>
    </section>

    <section id="entropy" class="tab-content hidden animate-fade-in">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="module lg:col-span-1">
          <h2 class="text-xl font-bold mb-6" style="color: var(--text-color)">å‚æ•°è®¾ç½®</h2>
          
          <div class="space-y-6">
            <div class="input-group">
              <label class="input-label flex justify-between">
                <span>åˆå§‹å¸Œæœ›å€¼</span>
                <span id="hopeVal" style="color: var(--primary-color)">50</span>
              </label>
              <input type="range" id="initialHope" min="10" max="100" value="50">
            </div>
            
            <div class="input-group">
              <label class="input-label flex justify-between">
                <span>ç¯å¢ƒç†µå¢ (ç‚¹/å›åˆ)</span>
                <span id="decayVal" style="color: var(--desc-color)">2</span>
              </label>
              <input type="range" id="decayRate" min="1" max="10" value="2">
            </div>

            <div class="p-4 rounded-lg border border-[var(--border-color)]" style="background: var(--input-bg)">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-bold" style="color: var(--danger-color)">å¾®å…‰é™·é˜±</span>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" id="glimmerTrap" class="sr-only peer">
                  <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[var(--danger-color)]"></div>
                </label>
              </div>
              <p class="text-xs" style="color: var(--desc-color)">ç¬¬5å›åˆç»™äºˆâ€œè™šå‡å¸Œæœ›â€ï¼Œéšåå¯åŠ¨3å€é€Ÿæ¸…ç®—ã€‚</p>
            </div>
          </div>
        </div>

        <div class="module lg:col-span-2 flex flex-col justify-center">
          <h3 class="text-lg font-bold mb-4 text-center" style="color: var(--text-color)">ç»æœ›æ›²çº¿æ¨æ¼”</h3>
          <div style="position: relative; height: 300px; width: 100%;">
            <canvas id="entropyChart"></canvas>
          </div>
          <div class="mt-6 text-center">
             <span id="analysisResult" class="text-sm font-mono px-3 py-1 rounded" style="background: var(--input-bg); color: var(--desc-color)"></span>
          </div>
        </div>
      </div>
    </section>

    <section id="status" class="tab-content hidden animate-fade-in">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="module">
          <h2 class="text-xl font-bold mb-6" style="color: var(--text-color)">HUD æ•°æ®å½•å…¥</h2>
          <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div class="input-group">
                <label class="input-label">ç”Ÿå‘½ (Phys)</label>
                <input type="text" id="hudHP" value="68% (å·¦è‡‚æ„ŸæŸ“)" class="input-field" oninput="updateHUD()">
              </div>
              <div class="input-group">
                <label class="input-label">ç²¾ç¥ (Mind)</label>
                <input type="text" id="hudSAN" value="42% (ä½è¯­)" class="input-field" oninput="updateHUD()">
              </div>
            </div>
            
            <div class="input-group">
              <label class="input-label flex justify-between">
                <span>å¼‚åŒ–åº¦</span>
                <span id="hudCorrDisp" style="color: var(--primary-color)">15%</span>
              </label>
              <input type="range" id="hudCorrRange" min="0" max="100" value="15" oninput="document.getElementById('hudCorrDisp').innerText=this.value+'%'; updateHUD()">
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div class="input-group">
                <label class="input-label">é‡‘å¸</label>
                <input type="text" id="hudGold" value="12" class="input-field" oninput="updateHUD()">
              </div>
              <div class="input-group">
                <label class="input-label">çµé­‚åˆ»</label>
                <input type="text" id="hudSoul" value="0" class="input-field" oninput="updateHUD()">
              </div>
            </div>

            <div class="input-group">
              <label class="input-label">ç¯å¢ƒå‹å¼º</label>
              <select id="hudPressure" class="input-field" onchange="updateHUD()">
                <option value="æ­£å¸¸">æ­£å¸¸</option>
                <option value="ä»¤äººçª’æ¯" selected>ä»¤äººçª’æ¯</option>
                <option value="æ­»å¯‚">æ­»å¯‚</option>
              </select>
            </div>
            
            <div class="input-group">
              <label class="input-label">å°è®° (Tags)</label>
              <input type="text" id="hudTags" value="[é¥¥é¥¿], [è¢«æ³¨è§†]" class="input-field" oninput="updateHUD()">
            </div>
          </div>
        </div>

        <div class="module flex flex-col">
          <h3 class="input-label mb-2">YAML é¢„è§ˆ</h3>
          <textarea id="yamlOutput" class="code-area input-field flex-grow resize-none" style="color: var(--primary-color)" readonly></textarea>
          <button onclick="navigator.clipboard.writeText(document.getElementById('yamlOutput').value)" class="btn mt-4 w-full justify-center">
            ç‚¹å‡»å¤åˆ¶ YAML
          </button>
        </div>
      </div>
    </section>

  </main>

  <script>
    // === 1. ä¸»é¢˜ç®¡ç† (ä¸ä¸»ç«™é€»è¾‘ä¸€è‡´) ===
    const ThemeManager = {
      btn: document.getElementById('theme-toggle-btn'),
      
      apply() {
        const isDark = localStorage.getItem('theme') === 'dark';
        document.body.setAttribute('data-theme', isDark ? 'dark' : 'light');
        if(this.btn) this.btn.textContent = isDark ? 'æµ…è‰²æ¨¡å¼' : 'æš—è‰²æ¨¡å¼';
        
        // åˆ·æ–°å›¾è¡¨é¢œè‰²
        if (window.entropyChart) renderEntropyChart();
      },

      init() {
        this.apply();
        if (this.btn) {
          this.btn.addEventListener('click', () => { 
            const isCurrentDark = document.body.getAttribute('data-theme') === 'dark';
            localStorage.setItem('theme', !isCurrentDark ? 'dark' : 'light');
            this.apply(); 
          });
        }
        window.addEventListener('pageshow', () => this.apply());
        window.addEventListener('storage', (e) => { if (e.key === 'theme') this.apply(); });
      }
    };

    // === 2. å¯¼èˆªåˆ‡æ¢ ===
    function switchTab(tabId) {
      // éšè—æ‰€æœ‰
      document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      
      // æ˜¾ç¤ºç›®æ ‡
      document.getElementById(tabId).classList.remove('hidden');
      document.querySelector(`.nav-btn[data-target="${tabId}"]`).classList.add('active');

      if (tabId === 'entropy') renderEntropyChart();
      if (tabId === 'status') updateHUD();
    }

    // === 3. æ ¸å¿ƒæ³•åˆ™ - å¤åˆ¶åŠŸèƒ½ ===
    function copySystemPrompt() {
      const text = document.getElementById('systemPrompt').value;
      navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById('copyBtn');
        const icon = document.getElementById('copyIcon');
        const label = document.getElementById('copyText');
        
        // åé¦ˆåŠ¨ç”»
        const originalBg = btn.style.background;
        btn.style.background = '#388e3c'; // Green
        icon.innerText = "âœ“";
        label.innerText = "å·²å¤åˆ¶";
        
        setTimeout(() => {
          btn.style.background = '';
          icon.innerText = "ğŸ“‹";
          label.innerText = "å¤åˆ¶æŒ‡ä»¤";
        }, 2000);
      });
    }

    // === 4. ç†µå€¼é¢„æ¼” - å›¾è¡¨é€»è¾‘ ===
    let entropyChart = null;
    function renderEntropyChart() {
      const ctx = document.getElementById('entropyChart').getContext('2d');
      const initialHope = parseInt(document.getElementById('initialHope').value);
      const baseDecay = parseInt(document.getElementById('decayRate').value);
      const isTrap = document.getElementById('glimmerTrap').checked;
      
      // è·å–å½“å‰ CSS å˜é‡é¢œè‰²
      const styles = getComputedStyle(document.body);
      const colorPrimary = styles.getPropertyValue('--primary-color').trim();
      const colorDanger = styles.getPropertyValue('--danger-color').trim();
      const colorText = styles.getPropertyValue('--desc-color').trim();
      const colorGrid = styles.getPropertyValue('--border-color').trim();

      document.getElementById('hopeVal').innerText = initialHope;
      document.getElementById('decayVal').innerText = baseDecay;

      let labels = [], data = [], hope = initialHope, currentDecay = baseDecay, deathTurn = -1;

      for(let i=0; i<=30; i++) {
        labels.push(i);
        data.push(Math.max(0, Math.floor(hope)));
        if (hope <= 0 && deathTurn === -1) deathTurn = i;
        
        if (isTrap && i === 5) {
          hope += 15; 
          currentDecay = baseDecay * 3; 
        } else {
          hope -= currentDecay;
        }
      }

      // æ›´æ–°åˆ†ææ–‡æœ¬
      const resultEl = document.getElementById('analysisResult');
      if(deathTurn > -1) {
        resultEl.innerHTML = `é¢„è®¡å­˜æ´»: ${deathTurn} å›åˆ | æ¨¡å¼: ${isTrap ? 'å¾®å…‰é™·é˜±' : 'çº¿æ€§è¡°å‡'}`;
        resultEl.style.color = colorDanger;
      } else {
        resultEl.innerHTML = "èµ„æºå……è¶³ï¼Œ30å›åˆå†…æ— ç”Ÿå­˜å¨èƒ";
        resultEl.style.color = colorPrimary;
      }

      if (entropyChart) entropyChart.destroy();

      entropyChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'å¸Œæœ›å€¼ (Hope)',
            data: data,
            borderColor: isTrap ? colorDanger : colorPrimary,
            backgroundColor: isTrap ? colorDanger + '20' : colorPrimary + '20', // Add transparency
            fill: true,
            tension: 0.3,
            pointRadius: 3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { 
              beginAtZero: true, 
              grid: { color: colorGrid },
              ticks: { color: colorText }
            },
            x: { 
              grid: { display: false },
              ticks: { color: colorText }
            }
          },
          plugins: { legend: { display: false } }
        }
      });
    }

    // ç›‘å¬å™¨
    document.getElementById('initialHope').addEventListener('input', renderEntropyChart);
    document.getElementById('decayRate').addEventListener('input', renderEntropyChart);
    document.getElementById('glimmerTrap').addEventListener('change', renderEntropyChart);

    // === 5. çŠ¶æ€ç”Ÿæˆå™¨ ===
    function updateHUD() {
      const hp = document.getElementById('hudHP').value;
      const san = document.getElementById('hudSAN').value;
      const corr = document.getElementById('hudCorrRange').value;
      const gold = document.getElementById('hudGold').value;
      const soul = document.getElementById('hudSoul').value;
      const pressure = document.getElementById('hudPressure').value;
      const tags = document.getElementById('hudTags').value.split(',').map(s => s.trim()).filter(s=>s);
      const date = new Date();
      
      let yaml = `---
[æ—¶ç©º]: "è£‚éš™301å¹´ Â· ${date.getMonth()+1}/${date.getDate()} Â· é˜´éœ¾"
[æ¨¡å¼]: "å†’é™©è€…"
[ç”Ÿç†]:
  ç”Ÿå‘½: "${hp}"
  ç²¾ç¥: "${san}"
  å¼‚åŒ–åº¦: "${corr}%"
[èµ„äº§]:
  é‡‘å¸: "${gold}"
  çµé­‚åˆ»: "${soul}"
[æ°›å›´]:
  ç¯å¢ƒå‹å¼º: "${pressure}"
  å› æœå›å“: "ä½ çš„é€‰æ‹©å¼•èµ·äº†è™šç©ºçš„æ³¨æ„..."
[å°è®°]:
${tags.map(t => `  - "${t}"`).join('\n')}
---`;
      document.getElementById('yamlOutput').value = yaml;
    }

    // === åˆå§‹åŒ– ===
    window.onload = function() {
      ThemeManager.init();
      // é»˜è®¤æ˜¾ç¤ºç¬¬ä¸€ä¸ªTab
      updateHUD();
    }
  </script>
</body>
</html>
