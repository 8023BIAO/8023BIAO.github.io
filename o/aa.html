<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aetherion Architect V7</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --glow: #6a4cff;
            --bg: #0a0a12;
            --text: #e0e0ff;
            --glass: rgba(20, 20, 35, .75);
            --safe: #00e676;
            --warn: #ffea00;
            --danger: #ff1744;
            --epic: #9c27b0;
            --legendary: #ffd700
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: radial-gradient(circle at 20% 30%, rgba(40, 10, 60, .15)0%, transparent 40%), radial-gradient(circle at 80% 70%, rgba(10, 30, 60, .1)0%, transparent 40%)
        }

        #particles {
            position: fixed;
            inset: 0;
            z-index: 0;
            opacity: .6;
            pointer-events: none
        }

        .container {
            position: relative;
            z-index: 10;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px
        }

        header {
            padding: 4rem 0 2rem;
            text-align: center
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 900;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: .1em;
            text-shadow: 0 0 20px rgba(106, 76, 255, .6)
        }

        .subtitle {
            color: #b0b0ff;
            font-size: 1rem;
            letter-spacing: .15em;
            margin-top: .5rem
        }

        .quote {
            max-width: 700px;
            margin: 1.5rem auto;
            padding: 1rem;
            border-left: 3px solid var(--glow);
            background: linear-gradient(90deg, rgba(106, 76, 255, .1), transparent);
            font-style: italic;
            color: #aaa
        }

        .card {
            background: var(--glass);
            border: 1px solid rgba(106, 76, 255, .3);
            border-radius: 8px;
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            transition: .3s
        }

        .card:hover {
            border-color: var(--glow);
            box-shadow: 0 0 20px rgba(106, 76, 255, .2)
        }

        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem
        }

        .grid {
            display: grid;
            gap: 1.5rem;
            margin: 2rem 0
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr))
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr))
        }

        @media(min-width:768px) {
            .grid-2 {
                grid-template-columns: repeat(2, 1fr)
            }
            .grid-3 {
                grid-template-columns: repeat(3, 1fr)
            }
        }

        @media(min-width:1200px) {
            .grid-4 {
                grid-template-columns: repeat(4, 1fr)
            }
        }

        label {
            display: block;
            color: #8888aa;
            font-size: .75rem;
            text-transform: uppercase;
            margin-bottom: .3rem;
            letter-spacing: 1px
        }

        input,
        select {
            width: 100%;
            background: rgba(0, 0, 0, .4);
            border: 1px solid #444;
            color: #fff;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Share Tech Mono';
            margin-bottom: 1rem;
            outline: none
        }

        input:focus,
        select:focus {
            border-color: var(--glow);
            box-shadow: 0 0 10px rgba(106, 76, 255, .3)
        }

        .result {
            background: rgba(0, 0, 0, .6);
            border-left: 4px solid #555;
            padding: 1rem;
            margin-top: 1rem
        }

        .result-safe {
            border-left-color: var(--safe)
        }

        .result-safe .val {
            color: var(--safe)
        }

        .result-warn {
            border-left-color: var(--warn)
        }

        .result-warn .val {
            color: var(--warn)
        }

        .result-danger {
            border-left-color: var(--danger);
            box-shadow: 0 0 15px rgba(255, 23, 68, .2)
        }

        .result-danger .val {
            color: var(--danger)
        }

        .result-epic {
            border-left-color: var(--epic);
            box-shadow: 0 0 15px rgba(156, 39, 176, .2)
        }

        .result-epic .val {
            color: #ce93d8
        }

        .result-legendary {
            border-left-color: var(--legendary);
            box-shadow: 0 0 15px rgba(255, 215, 0, .2)
        }

        .result-legendary .val {
            color: var(--legendary)
        }

        .val {
            font-size: 1.5rem;
            font-weight: bold;
            font-family: 'Orbitron'
        }

        .desc {
            font-size: .8rem;
            color: #aaa;
            margin-top: .3rem
        }

        .terminal {
            background: rgba(10, 8, 15, .95);
            border: 1px solid #333;
            border-radius: 4px;
            padding: 1rem;
            height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: .85rem;
            color: #a0a0ff;
            scrollbar-width: thin;
            scrollbar-color: var(--glow)#1a1a1a
        }

        .terminal::-webkit-scrollbar {
            width: 6px
        }

        .terminal::-webkit-scrollbar-track {
            background: #1a1a1a
        }

        .terminal::-webkit-scrollbar-thumb {
            background: var(--glow);
            border-radius: 3px
        }

        .btn {
            background: transparent;
            border: 1px solid var(--glow);
            color: var(--glow);
            padding: 8px 16px;
            font-family: 'Share Tech Mono';
            cursor: pointer;
            transition: .3s;
            text-transform: uppercase;
            font-size: .85rem;
            display: inline-flex;
            align-items: center;
            gap: 8px
        }

        .btn:hover {
            background: var(--glow);
            color: #fff;
            box-shadow: 0 0 15px var(--glow)
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .flowchart {
            background: rgba(0, 0, 0, .3);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto
        }

        footer {
            text-align: center;
            padding: 3rem 0;
            color: #666;
            font-size: .9rem
        }

        input[type=range] {
            -webkit-appearance: none;
            background: transparent
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: var(--glow);
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 0 10px var(--glow)
        }

        input[type=range]::-webkit-slider-runnable-track {
            height: 4px;
            background: #444;
            border-radius: 2px
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: .85rem
        }

        th,
        td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #333
        }

        th {
            color: var(--glow);
            font-weight: normal;
            text-transform: uppercase;
            font-size: .75rem
        }

        .flow-container {
            display: flex;
            flex-direction: column;
            gap: 0
        }

        .flow-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            margin: 2px 0;
            background: rgba(0, 0, 0, .3);
            border-radius: 6px;
            border-left: 3px solid #555;
            transition: .2s
        }

        .flow-row:hover {
            background: rgba(106, 76, 255, .1);
            border-left-color: var(--glow)
        }

        .flow-arrow {
            text-align: center;
            color: #666;
            font-size: 1.2rem;
            padding: 4px 0
        }

        .flow-input {
            border-left-color: #6a4cff;
            background: rgba(106, 76, 255, .1)
        }

        .flow-calc {
            border-left-color: #ffea00;
            background: rgba(255, 234, 0, .05)
        }

        .flow-branch {
            border-left-color: #ff9800;
            background: rgba(255, 152, 0, .05)
        }

        .flow-danger {
            border-left-color: #ff1744;
            background: rgba(255, 23, 68, .1)
        }

        .flow-safe {
            border-left-color: #00e676;
            background: rgba(0, 230, 118, .1)
        }

        .flow-label {
            font-family: 'Orbitron', sans-serif;
            font-size: .9rem;
            color: #fff;
            min-width: 100px
        }

        .flow-desc {
            color: #aaa;
            font-size: .85rem;
            flex: 1
        }

        .flow-val {
            font-family: 'Share Tech Mono';
            color: var(--glow);
            font-size: .9rem
        }

        /* Monster card styles */
        .monster-card {
            background: rgba(0, 0, 0, .4);
            border: 1px solid #333;
            border-radius: 6px;
            padding: 1rem;
            margin: 0.5rem 0;
            transition: .2s;
        }

        .monster-card:hover {
            border-color: var(--glow);
            background: rgba(106, 76, 255, .05);
        }

        .monster-name {
            font-family: 'Orbitron', sans-serif;
            color: #fff;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .monster-tag {
            display: inline-block;
            background: rgba(106, 76, 255, .2);
            color: #b0b0ff;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-right: 4px;
            margin-bottom: 4px;
        }

        .monster-tag.danger {
            background: rgba(255, 23, 68, .2);
            color: #ff8a80;
        }

        .monster-tag.safe {
            background: rgba(0, 230, 118, .2);
            color: #69f0ae;
        }

        /* Equipment quality colors */
        .quality-poor { color: #9e9e9e; }
        .quality-common { color: #fff; }
        .quality-uncommon { color: #00e676; }
        .quality-rare { color: #448aff; }
        .quality-epic { color: #ce93d8; }
        .quality-legendary { color: #ffd700; text-shadow: 0 0 5px rgba(255, 215, 0, .5); }

        /* Weather indicator */
        .weather-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .weather-sunny { background: rgba(255, 193, 7, .2); color: #ffd54f; }
        .weather-rain { background: rgba(33, 150, 243, .2); color: #64b5f6; }
        .weather-storm { background: rgba(156, 39, 176, .2); color: #ce93d8; }
        .weather-fog { background: rgba(96, 125, 139, .2); color: #b0bec5; }
        .weather-marea { background: rgba(244, 67, 54, .2); color: #ef9a9a; }

        /* Faction reputation */
        .rep-hostile { color: #ff1744; }
        .rep-unfriendly { color: #ff9800; }
        .rep-neutral { color: #9e9e9e; }
        .rep-friendly { color: #00e676; }
        .rep-honored { color: #ffd700; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 1rem;
            border-bottom: 1px solid rgba(106, 76, 255, .3);
            overflow-x: auto;
        }

        .tab {
            padding: 8px 16px;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            font-family: 'Share Tech Mono';
            font-size: 0.85rem;
            white-space: nowrap;
            transition: .2s;
        }

        .tab:hover {
            color: #fff;
        }

        .tab.active {
            color: var(--glow);
            border-bottom: 2px solid var(--glow);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media(max-width:768px) {
            .flow-row {
                flex-wrap: wrap;
                gap: 6px
            }

            .flow-label {
                width: 100%;
                min-width: auto
            }

            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
        }

        /* Scroll to top button */
        .scroll-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: var(--glass);
            border: 1px solid var(--glow);
            border-radius: 50%;
            color: var(--glow);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: .3s;
            z-index: 100;
        }

        .scroll-top.visible {
            opacity: 1;
        }

        .scroll-top:hover {
            background: var(--glow);
            color: #fff;
        }
    </style>
</head>

<body>
    <div id="particles"></div>
    <div class="container">
        <header>
            <h1>AETHERION</h1>
            <div class="subtitle">裂隙纪元 301 · 熵增物理引擎</div>
            <div class="quote">"欢迎来到没有救赎但允许抗争的世界。死亡是计算结果，非剧情杀"</div>
        </header>

        <!-- 核心法则 -->
        <div class="card" style="margin:3rem 0">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;border-bottom:1px solid rgba(106,76,255,.3);padding-bottom:1rem;flex-wrap:wrap;gap:10px">
                <h2 class="section-title" style="margin:0"><i class="fas fa-scroll"></i> 核心法则协议 V7</h2>
                <div class="btn-group">
                    <button class="btn" onclick="App.copy()"><i class="fas fa-copy"></i> 复制</button>
                    <button class="btn" onclick="App.download()"><i class="fas fa-download"></i> 下载</button>
                    <button class="btn" onclick="App.toggleRules()"><i class="fas fa-eye"></i> 显示/隐藏</button>
                </div>
            </div>
            <div class="terminal" id="ruleDisplay">正在加载法则...</div>
        </div>

        <!-- 标签页导航 -->
        <div class="tabs">
            <button class="tab active" onclick="App.switchTab('calculators')"><i class="fas fa-calculator"></i> 计算器</button>
            <button class="tab" onclick="App.switchTab('monsters')"><i class="fas fa-dragon"></i> 魔物图鉴</button>
            <button class="tab" onclick="App.switchTab('weather')"><i class="fas fa-cloud"></i> 天气系统</button>
            <button class="tab" onclick="App.switchTab('equipment')"><i class="fas fa-shield-alt"></i> 装备系统</button>
            <button class="tab" onclick="App.switchTab('factions')"><i class="fas fa-flag"></i> 派系关系</button>
        </div>

        <!-- 计算器标签页 -->
        <div id="tab-calculators" class="tab-content active">
            <!-- 物理引擎控制台 -->
            <h2 class="section-title justify-center"><i class="fas fa-microchip"></i> 物理引擎控制台</h2>
            <div class="grid grid-2">
                <!-- 熵增计算器 -->
                <div class="card">
                    <div class="section-title" style="font-size:1.1rem"><i class="fas fa-calculator"></i> 熵增万能公式</div>
                    <label>行动强度 (I)</label>
                    <select id="actionI">
                        <option value="1">静滞 (1) - 睡觉、冥想、进食</option>
                        <option value="5" selected>轻度 (5) - 走路、采集、交谈</option>
                        <option value="15">重度 (15) - 战斗、挖掘、急行军</option>
                        <option value="30">过载 (30) - 濒死爆发、禁忌施法</option>
                    </select>
                    <label>环境乘区 (E)</label>
                    <select id="envE">
                        <option value="0.5">秩序区 (0.5)</option>
                        <option value="1.0" selected>荒野区 (1.0) - 标准环境</option>
                        <option value="1.5">荒野强化 (1.5) - 蚀骨者区域</option>
                        <option value="2.0">乱序区 (2.0) - 暴雨、毒气</option>
                        <option value="2.5">高魔浓度 (2.5) - 雾晶区域</option>
                        <option value="3.0">崩坏先驱 (3.0) - 熵核区域</option>
                        <option value="4.0">崩坏核心 (4.0) - 虚空织者</option>
                        <option value="5.0">崩坏区 (5.0) - 魔潮中心</option>
                    </select>
                    <label>当前天气</label>
                    <select id="calcWeather" onchange="App.applyWeatherEffect()">
                        <option value="none" data-mod="0">晴朗 (E×1.0)</option>
                        <option value="rain" data-mod="0.5">暴雨 (E+0.5)</option>
                        <option value="storm" data-mod="1.0">以太风暴 (E+1.0)</option>
                        <option value="fog" data-mod="0.3">黑雾 (E+0.3)</option>
                        <option value="marea" data-mod="1.5">魔潮前兆 (E+1.5)</option>
                    </select>
                    <label>天梯暴露度</label>
                    <select id="exposure">
                        <option value="0" selected>无名之辈 (暴露度+0)</option>
                        <option value="1">榜上有名 (暴露度+1)</option>
                        <option value="3">天梯前百 (暴露度+3)</option>
                        <option value="6">天梯前十 (暴露度+6)</option>
                    </select>
                    <label>装备品质 (I值修正)</label>
                    <select id="equipQuality" onchange="App.calcEntropy()">
                        <option value="0" selected>无/劣质 (I+0)</option>
                        <option value="-1">精良 (I-1)</option>
                        <option value="-2">稀有 (I-2)</option>
                        <option value="-3">史诗 (I-3)</option>
                        <option value="-5">传说 (I-5)</option>
                    </select>
                    <label>负熵努力 (R)</label>
                    <input type="number" id="negR" value="0" min="0" max="50">
                    <div class="result" id="entropyRes">
                        <div class="val">Δ = 5.0</div>
                        <div class="desc">熵增积累，状态维持</div>
                    </div>
                </div>

                <!-- 状态桶计算 -->
                <div class="card">
                    <div class="section-title" style="font-size:1.1rem"><i class="fas fa-battery-half"></i> 状态桶机制</div>
                    <label>当前槽值 (0-20)</label>
                    <input type="number" id="currentLoad" value="0" min="0" max="20">
                    <label>本轮熵增 (Δ)</label>
                    <input type="number" id="roundDelta" value="5" min="0">
                    <label>槽类型</label>
                    <select id="bucketType">
                        <option value="body" selected>躯体槽 (上限20)</option>
                        <option value="mind">精神槽 (上限15)</option>
                    </select>
                    <label>天梯暴露度 (容量加成)</label>
                    <select id="bucketExp">
                        <option value="0" selected>暴露度+0 (躯体10/精神10)</option>
                        <option value="1">暴露度+1 (躯体11/精神11)</option>
                        <option value="3">暴露度+3 (躯体13/精神13)</option>
                        <option value="6">暴露度+6 (躯体16/精神15)</option>
                        <option value="10">暴露度+10 (躯体20/精神15)</option>
                    </select>
                    <div class="result" id="bucketRes">
                        <div class="val">状态: 充沛</div>
                        <div class="desc">槽值: 0/10</div>
                    </div>
                </div>

                <!-- 负重计算 -->
                <div class="card">
                    <div class="section-title" style="font-size:1.1rem"><i class="fas fa-weight-hanging"></i> 负重系统</div>
                    <label>天梯暴露度</label>
                    <select id="weightExp">
                        <option value="0" selected>暴露度+0 (容量30kg)</option>
                        <option value="1">暴露度+1 (容量35kg)</option>
                        <option value="3">暴露度+3 (容量45kg)</option>
                        <option value="6">暴露度+6 (容量60kg)</option>
                    </select>
                    <label>当前负重 (kg)</label>
                    <input type="number" id="weightVal" value="25" min="0">
                    <label>躯体状态</label>
                    <select id="weightState">
                        <option value="normal" selected>正常/疲劳</option>
                        <option value="weak">虚弱/濒死 (+3I)</option>
                    </select>
                    <div class="result" id="weightRes">
                        <div class="val">正常</div>
                        <div class="desc">负重: 25/30kg</div>
                    </div>
                </div>

                <!-- 以太中毒 -->
                <div class="card">
                    <div class="section-title" style="font-size:1.1rem"><i class="fas fa-skull"></i> 以太中毒</div>
                    <label>今日吞噬魔晶数</label>
                    <input type="number" id="etherCount" value="0" min="0" max="10">
                    <label>当前精神状态</label>
                    <select id="mentalState">
                        <option value="0" selected>清醒</option>
                        <option value="1">动摇</option>
                        <option value="2">崩溃</option>
                    </select>
                    <label>30日内第4枚次数 (循环阻断)</label>
                    <input type="number" id="cycleCount" value="0" min="0" max="5">
                    <div class="result" id="etherRes">
                        <div class="val">安全范围</div>
                        <div class="desc">R值正常生效</div>
                    </div>
                </div>

                <!-- 疲劳计数器 -->
                <div class="card">
                    <div class="section-title" style="font-size:1.1rem"><i class="fas fa-clock"></i> 疲劳计数器</div>
                    <label>微观疲劳 (连续I≥15回合)</label>
                    <input type="number" id="microFatigue" value="0" min="0" max="10">
                    <label>宏观疲劳 (未长休回合)</label>
                    <input type="number" id="macroFatigue" value="0" min="0" max="10">
                    <label>睡眠类型</label>
                    <select id="sleepReset">
                        <option value="none" selected>无睡眠</option>
                        <option value="poor">劣质睡眠</option>
                        <option value="quality">优质睡眠</option>
                        <option value="long">长休</option>
                    </select>
                    <div class="result" id="fatigueRes">
                        <div class="val">正常</div>
                        <div class="desc">无疲劳累积</div>
                    </div>
                </div>

                <!-- 因果负债追踪器 -->
                <div class="card">
                    <div class="section-title" style="font-size:1.1rem"><i class="fas fa-balance-scale"></i> 因果负债追踪器</div>
                    <label>负债天数</label>
                    <input type="number" id="debtDays" value="0" min="0" max="30">
                    <label>偿还记录 (≥5R值/次)</label>
                    <input type="number" id="debtRepay" value="0" min="0">
                    <label>当前状态</label>
                    <select id="debtStatus">
                        <option value="safe" selected>正常</option>
                        <option value="warning">负债中</option>
                        <option value="critical">即将触发反噬</option>
                    </select>
                    <div class="result" id="debtRes">
                        <div class="val">无负债</div>
                        <div class="desc">未持有因果负债</div>
                    </div>
                </div>

                <!-- 因果清晰度 -->
                <div class="card">
                    <div class="section-title" style="font-size:1.1rem"><i class="fas fa-eye"></i> 因果清晰度</div>
                    <label>基础等级 (0-100)</label>
                    <input type="range" id="causalRange" min="0" max="100" value="0">
                    <div style="text-align:center;margin:-.5rem 0 1rem;font-size:.85rem;color:#888">当前: <span id="causalVal">0</span> - <span id="causalName">几乎没有</span></div>
                    <label>持有灵魂刻</label>
                    <input type="number" id="soulCount" value="0" min="0">
                    <label>无负熵产出天数</label>
                    <input type="number" id="noEntropyDays" value="0" min="0">
                    <label>装备加成</label>
                    <select id="causalEquip">
                        <option value="0" selected>无</option>
                        <option value="10">因果锚定 (+10)</option>
                    </select>
                    <div class="result" id="causalRes">
                        <div class="val">几乎没有</div>
                        <div class="desc">因果蒸发。无物理反馈。</div>
                    </div>
                </div>

                <!-- 优质睡眠 -->
                <div class="card">
                    <div class="section-title" style="font-size:1.1rem"><i class="fas fa-bed"></i> 睡眠恢复</div>
                    <label>睡眠类型</label>
                    <select id="sleepType">
                        <option value="quality" selected>优质睡眠 (E≤0.5)</option>
                        <option value="poor">劣质睡眠 (E>0.5)</option>
                    </select>
                    <label>环境乘区 (E)</label>
                    <select id="sleepE">
                        <option value="0.5">0.5 - 秩序区</option>
                        <option value="1.0" selected>1.0 - 荒野区</option>
                        <option value="2.0">2.0 - 乱序区</option>
                    </select>
                    <label>是否持有[灵魂耗竭]</label>
                    <select id="soulDrain">
                        <option value="no" selected>否</option>
                        <option value="yes">是 (R降至8~10)</option>
                    </select>
                    <label>今日第几次睡眠</label>
                    <select id="sleepCount">
                        <option value="1" selected>第1次 (R=15~20)</option>
                        <option value="2">第2次 (R=8~10)</option>
                    </select>
                    <label>当前天气</label>
                    <select id="sleepWeather">
                        <option value="normal" selected>正常</option>
                        <option value="marea">魔潮前兆 (无法优质睡眠)</option>
                    </select>
                    <div class="result" id="sleepRes">
                        <div class="val">R = 50</div>
                        <div class="desc">优质睡眠: 清空槽值，恢复状态</div>
                    </div>
                </div>

                <!-- 好运守恒计算器 -->
                <div class="card">
                    <div class="section-title" style="font-size:1.1rem"><i class="fas fa-clover"></i> 好运守恒计算器</div>
                    <label>今日好运触发次数 (0-5)</label>
                    <input type="number" id="luckCount" value="0" min="0" max="5">
                    <label>连续好运次数 (超过3次后临界值累积)</label>
                    <input type="number" id="luckStreak" value="0" min="0">
                    <label>当前环境</label>
                    <select id="luckEnv">
                        <option value="safe" selected>正常/秩序区</option>
                        <option value="hazard">乱序区/积淤者 (好运软锁)</option>
                    </select>
                    <div class="result" id="luckRes">
                        <div class="val">可触发</div>
                        <div class="desc">今日剩余: 5次 | 无临界值累积</div>
                    </div>
                </div>

                <!-- 天梯暴露度模拟器 -->
                <div class="card">
                    <div class="section-title" style="font-size:1.1rem"><i class="fas fa-ranking-star"></i> 天梯暴露度模拟器</div>
                    <label>天梯排名</label>
                    <select id="ladderRank">
                        <option value="0" selected>无名之辈 (暴露度+0)</option>
                        <option value="1">榜上有名 (暴露度+1)</option>
                        <option value="3">天梯前百 (暴露度+3)</option>
                        <option value="6">天梯前十 (暴露度+6)</option>
                    </select>
                    <label>基础环境E值</label>
                    <select id="ladderEnvE">
                        <option value="0.5">秩序区 E=0.5</option>
                        <option value="1.0" selected>荒野区 E=1.0</option>
                        <option value="2.0">乱序区 E=2.0</option>
                        <option value="5.0">崩坏区 E=5.0</option>
                    </select>
                    <label>行动强度I值</label>
                    <select id="ladderActionI">
                        <option value="1">静滞 I=1</option>
                        <option value="5" selected>轻度 I=5</option>
                        <option value="15">重度 I=15</option>
                        <option value="30">过载 I=30</option>
                    </select>
                    <div class="result" id="ladderRes">
                        <div class="val">Δ = 5.0</div>
                        <div class="desc">无名之辈荒野区行动: 基础熵增</div>
                    </div>
                </div>

                <!-- 魔晶吞噬收益/风险评估器 -->
                <div class="card">
                    <div class="section-title" style="font-size:1.1rem"><i class="fas fa-gem"></i> 魔晶吞噬评估器 V7</div>
                    <label>今日已吞噬数量</label>
                    <input type="number" id="crystalCount" value="0" min="0" max="10">
                    <label>当前精神状态</label>
                    <select id="crystalMental">
                        <option value="0" selected>清醒</option>
                        <option value="1">动摇</option>
                        <option value="2">崩溃</option>
                        <option value="3">昏乱 (无法吞噬)</option>
                    </select>
                    <label>当前躯体状态</label>
                    <select id="crystalBody">
                        <option value="0">充沛</option>
                        <option value="1">正常</option>
                        <option value="2" selected>疲劳</option>
                        <option value="3">虚弱</option>
                        <option value="4">濒死</option>
                    </select>
                    <label>30日内第4枚次数</label>
                    <input type="number" id="crystalCycle" value="0" min="0" max="5">
                    <label>是否持有[灵魂耗竭]</label>
                    <select id="crystalDrain">
                        <option value="no" selected>否</option>
                        <option value="yes">是 (第4枚R值降至8-10)</option>
                    </select>
                    <div class="result" id="crystalRes">
                        <div class="val">安全范围</div>
                        <div class="desc">第1-3枚: R=10/枚正常生效 | 建议第3枚后停止</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 魔物图鉴标签页 -->
        <div id="tab-monsters" class="tab-content">
            <div class="card">
                <h2 class="section-title"><i class="fas fa-dragon"></i> 魔物图鉴数据库 V7</h2>
                <p style="color:#888;margin-bottom:1rem">共10种魔物，覆盖E=0.5至E=4.0全区域</p>
                
                <div class="grid grid-2">
                    <div class="monster-card">
                        <div class="monster-name"><i class="fas fa-bacterium"></i> 积淤者</div>
                        <div>
                            <span class="monster-tag">E=1.0</span>
                            <span class="monster-tag">低熵区</span>
                            <span class="monster-tag danger">熵增加速器</span>
                        </div>
                        <p style="color:#aaa;font-size:0.85rem;margin-top:0.5rem">活体霉菌与腐尸混合，向高秩序区域缓慢移动。弱点：火焰、净化仪式。</p>
                        <p style="color:#888;font-size:0.8rem;margin-top:0.3rem">掉落: 腐化残渣×1-2</p>
                    </div>

                    <div class="monster-card">
                        <div class="monster-name"><i class="fas fa-gem"></i> 晶化律法</div>
                        <div>
                            <span class="monster-tag">E=2.0</span>
                            <span class="monster-tag">高魔浓度</span>
                            <span class="monster-tag danger">秩序固化</span>
                        </div>
                        <p style="color:#aaa;font-size:0.85rem;margin-top:0.5rem">完美几何切割体，感知即封印。弱点：物理冲击(I≥15)、熵增干扰。</p>
                        <p style="color:#888;font-size:0.8rem;margin-top:0.3rem">掉落: 魔晶碎片×1 (30%)</p>
                    </div>

                    <div class="monster-card">
                        <div class="monster-name"><i class="fas fa-sun"></i> 流序者</div>
                        <div>
                            <span class="monster-tag safe">E=0.5-1.0</span>
                            <span class="monster-tag safe">动态平衡</span>
                            <span class="monster-tag safe">良性共生</span>
                        </div>
                        <p style="color:#aaa;font-size:0.85rem;margin-top:0.5rem">光晕般流动，依附高效负熵系统，R值+2。无法被召唤或命令。</p>
                        <p style="color:#888;font-size:0.8rem;margin-top:0.3rem">掉落: 无(非战斗型)</p>
                    </div>

                    <div class="monster-card">
                        <div class="monster-name"><i class="fas fa-clock"></i> 时间猎犬</div>
                        <div>
                            <span class="monster-tag danger">E=任意</span>
                            <span class="monster-tag danger">观察者惩罚</span>
                            <span class="monster-tag danger">不可战斗</span>
                        </div>
                        <p style="color:#aaa;font-size:0.85rem;margin-top:0.5rem">扭曲的时空涟漪，追杀冻结>30日的观察者。无法战斗，只能逃离。</p>
                        <p style="color:#888;font-size:0.8rem;margin-top:0.3rem">掉落: 无(不可击败)</p>
                    </div>

                    <div class="monster-card">
                        <div class="monster-name"><i class="fas fa-shield-alt"></i> 守序者</div>
                        <div>
                            <span class="monster-tag safe">E=0.5</span>
                            <span class="monster-tag safe">秩序区</span>
                            <span class="monster-tag safe">非敌意</span>
                        </div>
                        <p style="color:#aaa;font-size:0.85rem;margin-top:0.5rem">纯净光线构成的几何人形，维护区域秩序。高暴露度玩家可能被驱逐。</p>
                        <p style="color:#888;font-size:0.8rem;margin-top:0.3rem">掉落: 秩序核心×1 (1%)</p>
                    </div>

                    <div class="monster-card">
                        <div class="monster-name"><i class="fas fa-skull"></i> 蚀骨者</div>
                        <div>
                            <span class="monster-tag">E=1.5</span>
                            <span class="monster-tag">荒野强化</span>
                            <span class="monster-tag danger">群居</span>
                        </div>
                        <p style="color:#aaa;font-size:0.85rem;margin-top:0.5rem">骨骼外露的犬型生物，3-7只群体狩猎。攻击附加腐蚀效果。</p>
                        <p style="color:#888;font-size:0.8rem;margin-top:0.3rem">掉落: 蚀骨×1、黑火余烬×1 (20%)</p>
                    </div>

                    <div class="monster-card">
                        <div class="monster-name"><i class="fas fa-circle"></i> 熵核</div>
                        <div>
                            <span class="monster-tag danger">E=3.0</span>
                            <span class="monster-tag danger">崩坏先驱</span>
                            <span class="monster-tag danger">重力扭曲</span>
                        </div>
                        <p style="color:#aaa;font-size:0.85rem;margin-top:0.5rem">悬浮的黑色球体，持续释放熵增场。弱点：高纯度灵魂刻。</p>
                        <p style="color:#888;font-size:0.8rem;margin-top:0.3rem">掉落: 熵核碎片×1、魔晶×1-2 (50%)</p>
                    </div>

                    <div class="monster-card">
                        <div class="monster-name"><i class="fas fa-project-diagram"></i> 虚空织者</div>
                        <div>
                            <span class="monster-tag danger">E=4.0</span>
                            <span class="monster-tag danger">空间扭曲</span>
                            <span class="monster-tag danger">深渊级</span>
                        </div>
                        <p style="color:#aaa;font-size:0.85rem;margin-top:0.5rem">无数细丝构成的网状结构，编织空间陷阱。因果清晰度≥5可感知。</p>
                        <p style="color:#888;font-size:0.8rem;margin-top:0.3rem">掉落: 虚空丝×1、高纯度灵魂刻×1 (80%)</p>
                    </div>

                    <div class="monster-card">
                        <div class="monster-name"><i class="fas fa-cog"></i> 铁冠造物</div>
                        <div>
                            <span class="monster-tag">E=1.0-2.0</span>
                            <span class="monster-tag">机械</span>
                            <span class="monster-tag">铁冠王国</span>
                        </div>
                        <p style="color:#aaa;font-size:0.85rem;margin-top:0.5rem">蒸汽与齿轮驱动的机械构造体，物理抗性+50%，免疫精神攻击。</p>
                        <p style="color:#888;font-size:0.8rem;margin-top:0.3rem">掉落: 机械零件×2-4、蒸汽核心×1 (15%)</p>
                    </div>

                    <div class="monster-card">
                        <div class="monster-name"><i class="fas fa-crystal-ball"></i> 雾晶使徒</div>
                        <div>
                            <span class="monster-tag">E=2.0-2.5</span>
                            <span class="monster-tag">晶体</span>
                            <span class="monster-tag danger">精神污染</span>
                        </div>
                        <p style="color:#aaa;font-size:0.85rem;margin-top:0.5rem">微型水晶组成的人形，执行"净化"指令。被击败后50%概率晶化。</p>
                        <p style="color:#888;font-size:0.8rem;margin-top:0.3rem">掉落: 雾晶碎片×2-3、精神污染样本×1 (10%)</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 天气系统标签页 -->
        <div id="tab-weather" class="tab-content">
            <div class="card">
                <h2 class="section-title"><i class="fas fa-cloud"></i> 天气系统 V7</h2>
                
                <table>
                    <tr>
                        <th>天气类型</th>
                        <th>E值修正</th>
                        <th>持续时间</th>
                        <th>特殊效果</th>
                    </tr>
                    <tr>
                        <td><span class="weather-indicator weather-sunny"><i class="fas fa-sun"></i> 晴朗</span></td>
                        <td>E×1.0</td>
                        <td>6-12小时</td>
                        <td>无特殊效果</td>
                    </tr>
                    <tr>
                        <td><span class="weather-indicator weather-rain"><i class="fas fa-cloud-rain"></i> 暴雨</span></td>
                        <td>E+0.5</td>
                        <td>2-6小时</td>
                        <td>视野-50%，火焰-30%，积淤者活跃度+50%</td>
                    </tr>
                    <tr>
                        <td><span class="weather-indicator weather-storm"><i class="fas fa-bolt"></i> 以太风暴</span></td>
                        <td>E+1.0</td>
                        <td>1-3小时</td>
                        <td>施法I+5，精神槽+20%，晶化律法生成+30%</td>
                    </tr>
                    <tr>
                        <td><span class="weather-indicator weather-fog"><i class="fas fa-smog"></i> 黑雾</span></td>
                        <td>E+0.3</td>
                        <td>4-8小时</td>
                        <td>视野-70%，蚀骨者生成+50%，秩序区效果-30%</td>
                    </tr>
                    <tr>
                        <td><span class="weather-indicator weather-marea"><i class="fas fa-exclamation-triangle"></i> 魔潮前兆</span></td>
                        <td>E+1.5</td>
                        <td>直至魔潮</td>
                        <td>魔物生成+100%，高阶魔物出现，无法优质睡眠</td>
                    </tr>
                </table>

                <div class="card" style="margin-top:1.5rem;background:rgba(106,76,255,.05)">
                    <h3 style="color:#fff;margin-bottom:1rem"><i class="fas fa-calculator"></i> 天气影响计算器</h3>
                    <div class="grid grid-2">
                        <div>
                            <label>基础E值</label>
                            <select id="weatherBaseE">
                                <option value="0.5">秩序区 (0.5)</option>
                                <option value="1.0" selected>荒野区 (1.0)</option>
                                <option value="2.0">乱序区 (2.0)</option>
                                <option value="3.0">崩坏先驱 (3.0)</option>
                            </select>
                        </div>
                        <div>
                            <label>当前天气</label>
                            <select id="weatherType" onchange="App.calcWeather()">
                                <option value="0" data-name="晴朗">晴朗 (E×1.0)</option>
                                <option value="0.5" data-name="暴雨">暴雨 (E+0.5)</option>
                                <option value="1.0" data-name="以太风暴">以太风暴 (E+1.0)</option>
                                <option value="0.3" data-name="黑雾">黑雾 (E+0.3)</option>
                                <option value="1.5" data-name="魔潮前兆">魔潮前兆 (E+1.5)</option>
                            </select>
                        </div>
                    </div>
                    <div class="result" id="weatherRes">
                        <div class="val">E_final = 1.0</div>
                        <div class="desc">晴朗天气: 无额外效果</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 装备系统标签页 -->
        <div id="tab-equipment" class="tab-content">
            <div class="card">
                <h2 class="section-title"><i class="fas fa-shield-alt"></i> 装备品质系统 V7</h2>
                
                <table>
                    <tr>
                        <th>品质</th>
                        <th>效果</th>
                        <th>耐久</th>
                        <th>获取途径</th>
                    </tr>
                    <tr>
                        <td><span class="quality-poor">劣质 (灰)</span></td>
                        <td>无加成，20%损坏</td>
                        <td>5</td>
                        <td>初始装备、废墟搜刮</td>
                    </tr>
                    <tr>
                        <td><span class="quality-common">普通 (白)</span></td>
                        <td>无加成</td>
                        <td>10</td>
                        <td>普通商店、低阶魔物</td>
                    </tr>
                    <tr>
                        <td><span class="quality-uncommon">精良 (绿)</span></td>
                        <td>I-1 或 R+1</td>
                        <td>15</td>
                        <td>精良商店、中阶魔物</td>
                    </tr>
                    <tr>
                        <td><span class="quality-rare">稀有 (蓝)</span></td>
                        <td>I-2 或 R+2，1条特殊属性</td>
                        <td>20</td>
                        <td>高阶魔物、任务奖励</td>
                    </tr>
                    <tr>
                        <td><span class="quality-epic">史诗 (紫)</span></td>
                        <td>I-3 或 R+3，2条特殊属性</td>
                        <td>30</td>
                        <td>史诗任务、虚空织者掉落</td>
                    </tr>
                    <tr>
                        <td><span class="quality-legendary">传说 (金)</span></td>
                        <td>I-5 或 R+5，3条特殊属性</td>
                        <td>∞</td>
                        <td>古神遗迹、魔潮最终奖励</td>
                    </tr>
                </table>

                <div class="card" style="margin-top:1.5rem;background:rgba(106,76,255,.05)">
                    <h3 style="color:#fff;margin-bottom:1rem"><i class="fas fa-magic"></i> 特殊属性示例</h3>
                    <div class="grid grid-2">
                        <div class="monster-card">
                            <div class="monster-name" style="color:#00e676">[熵减]</div>
                            <p style="color:#aaa;font-size:0.85rem">每轮自动减少1点槽值</p>
                        </div>
                        <div class="monster-card">
                            <div class="monster-name" style="color:#448aff">[秩序守护]</div>
                            <p style="color:#aaa;font-size:0.85rem">秩序区内E值额外-0.1</p>
                        </div>
                        <div class="monster-card">
                            <div class="monster-name" style="color:#ce93d8">[魔物威慑]</div>
                            <p style="color:#aaa;font-size:0.85rem">E≤1.5区域魔物回避率+30%</p>
                        </div>
                        <div class="monster-card">
                            <div class="monster-name" style="color:#ffd700">[因果锚定]</div>
                            <p style="color:#aaa;font-size:0.85rem">因果清晰度+10</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 派系关系标签页 -->
        <div id="tab-factions" class="tab-content">
            <div class="card">
                <h2 class="section-title"><i class="fas fa-flag"></i> 派系关系系统 V7</h2>
                
                <table>
                    <tr>
                        <th>声望等级</th>
                        <th>范围</th>
                        <th>NPC态度</th>
                        <th>效果</th>
                    </tr>
                    <tr>
                        <td><span class="rep-hostile">敌对</span></td>
                        <td>-100 ~ -50</td>
                        <td>攻击或拒绝服务</td>
                        <td>无法交易，进入领土被攻击</td>
                    </tr>
                    <tr>
                        <td><span class="rep-unfriendly">冷淡</span></td>
                        <td>-50 ~ 0</td>
                        <td>冷漠</td>
                        <td>价格+50%</td>
                    </tr>
                    <tr>
                        <td><span class="rep-neutral">中立</span></td>
                        <td>0 ~ +30</td>
                        <td>正常</td>
                        <td>正常交易</td>
                    </tr>
                    <tr>
                        <td><span class="rep-friendly">友好</span></td>
                        <td>+30 ~ +70</td>
                        <td>热情</td>
                        <td>价格-20%，提供额外信息</td>
                    </tr>
                    <tr>
                        <td><span class="rep-honored">崇敬</span></td>
                        <td>+70 ~ +100</td>
                        <td>尊敬</td>
                        <td>特殊任务，势力装备折扣</td>
                    </tr>
                </table>

                <div class="card" style="margin-top:1.5rem;background:rgba(106,76,255,.05)">
                    <h3 style="color:#fff;margin-bottom:1rem"><i class="fas fa-calculator"></i> 派系关系计算器</h3>
                    <div class="grid grid-2">
                        <div>
                            <label>当前声望值</label>
                            <input type="range" id="factionRep" min="-100" max="100" value="0" oninput="App.calcFaction()">
                            <div style="text-align:center;color:#888;font-size:0.85rem">当前: <span id="factionRepVal">0</span></div>
                        </div>
                        <div>
                            <label>势力选择</label>
                            <select id="factionSelect">
                                <option value="iron">铁冠王国</option>
                                <option value="mist">雾谷帝国</option>
                                <option value="silver">银湾联盟</option>
                                <option value="shadow">灰影议会</option>
                            </select>
                        </div>
                    </div>
                    <div class="result" id="factionRes">
                        <div class="val">中立</div>
                        <div class="desc">正常交易，无特殊效果</div>
                    </div>
                </div>

                <div class="card" style="margin-top:1.5rem">
                    <h3 style="color:#fff;margin-bottom:1rem"><i class="fas fa-exchange-alt"></i> 派系关系矩阵</h3>
                    <table>
                        <tr>
                            <th></th>
                            <th>铁冠王国</th>
                            <th>雾谷帝国</th>
                            <th>银湾联盟</th>
                            <th>灰影议会</th>
                        </tr>
                        <tr>
                            <td><strong>铁冠王国</strong></td>
                            <td>-</td>
                            <td style="color:#ff1744">敌对</td>
                            <td style="color:#ff9800">冷淡</td>
                            <td style="color:#9e9e9e">中立</td>
                        </tr>
                        <tr>
                            <td><strong>雾谷帝国</strong></td>
                            <td style="color:#ff1744">敌对</td>
                            <td>-</td>
                            <td style="color:#9e9e9e">中立</td>
                            <td style="color:#9e9e9e">中立</td>
                        </tr>
                        <tr>
                            <td><strong>银湾联盟</strong></td>
                            <td style="color:#ff9800">冷淡</td>
                            <td style="color:#9e9e9e">中立</td>
                            <td>-</td>
                            <td style="color:#00e676">友好</td>
                        </tr>
                        <tr>
                            <td><strong>灰影议会</strong></td>
                            <td style="color:#9e9e9e">中立</td>
                            <td style="color:#9e9e9e">中立</td>
                            <td style="color:#00e676">友好</td>
                            <td>-</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- 状态流程图 -->
        <div class="card" style="margin:2rem 0">
            <h2 class="section-title"><i class="fas fa-project-diagram"></i> 状态桶机制流程</h2>
            <div class="flow-container">
                <div class="flow-row flow-input">
                    <span class="flow-label">输入层</span>
                    <span class="flow-desc">行动强度 I × 环境乘区 E</span>
                    <span class="flow-val">I × E = 基础熵增</span>
                </div>
                <div class="flow-arrow">↓ 天气修正 + 暴露度修正</div>
                <div class="flow-row flow-calc">
                    <span class="flow-label">计算层</span>
                    <span class="flow-desc">ΔEntropy = (I × E_final) - R</span>
                    <span class="flow-val">净熵增/负熵</span>
                </div>
                <div class="flow-arrow">↓ 判定 Δ 正负</div>
                <div class="flow-row flow-branch">
                    <span class="flow-label">分支 A</span>
                    <span class="flow-desc">Δ &lt; 0 → 负熵建立 → 修复秩序</span>
                    <span class="flow-val" style="color:#00e676">状态恢复</span>
                </div>
                <div class="flow-row flow-branch">
                    <span class="flow-label">分支 B</span>
                    <span class="flow-desc">Δ &gt; 0 → 灌入状态桶 → 负荷累积</span>
                    <span class="flow-val" style="color:#ffea00">负荷 +Δ</span>
                </div>
                <div class="flow-arrow">↓ 判定桶满</div>
                <div class="flow-row flow-danger">
                    <span class="flow-label">临界点</span>
                    <span class="flow-desc">负荷 ≥ 10 → 状态阶梯跌落</span>
                    <span class="flow-val" style="color:#ff1744">充沛→正常→疲劳→虚弱→濒死</span>
                </div>
                <div class="flow-arrow">↓ 濒死状态</div>
                <div class="flow-row flow-danger" style="background:rgba(255,23,68,.15)">
                    <span class="flow-label">死亡判定</span>
                    <span class="flow-desc">濒死状态下桶满溢出 → 死亡</span>
                    <span class="flow-val" style="color:#ff1744">DEATH</span>
                </div>
            </div>
        </div>

        <!-- 快速参考表 -->
        <div class="card" style="margin:2rem 0">
            <h2 class="section-title"><i class="fas fa-table"></i> 快速计算参考 V7</h2>
            <table>
                <tr>
                    <th>场景</th>
                    <th>I</th>
                    <th>E</th>
                    <th>ΔEntropy</th>
                    <th>结果</th>
                </tr>
                <tr>
                    <td>秩序区睡觉</td>
                    <td>1</td>
                    <td>0.5</td>
                    <td>0.5</td>
                    <td>缓慢减少熵槽</td>
                </tr>
                <tr>
                    <td>荒野区战斗</td>
                    <td>15</td>
                    <td>1.0</td>
                    <td>15</td>
                    <td>槽满跌落一阶</td>
                </tr>
                <tr>
                    <td>连续第4战(疲劳)</td>
                    <td>30</td>
                    <td>1.0</td>
                    <td>30</td>
                    <td>可能跌落两阶</td>
                </tr>
                <tr>
                    <td>崩坏区濒死爆发</td>
                    <td>30</td>
                    <td>5.0</td>
                    <td>115</td>
                    <td>换取保命</td>
                </tr>
                <tr>
                    <td>暴雨中战斗</td>
                    <td>15</td>
                    <td>1.5</td>
                    <td>22.5</td>
                    <td>高跌落风险</td>
                </tr>
                <tr>
                    <td>以太风暴施法</td>
                    <td>20</td>
                    <td>2.0</td>
                    <td>40</td>
                    <td>极高风险</td>
                </tr>
                <tr>
                    <td>第4枚魔晶</td>
                    <td>-</td>
                    <td>-</td>
                    <td>R=30</td>
                    <td>精神跌落换躯体恢复</td>
                </tr>
                <tr>
                    <td>第6+枚魔晶</td>
                    <td>-</td>
                    <td>-</td>
                    <td>+20/枚</td>
                    <td>剧毒，躯体跌落两阶</td>
                </tr>
            </table>
        </div>

    </div>

    <button class="scroll-top" id="scrollTop" onclick="App.scrollToTop()"><i class="fas fa-arrow-up"></i></button>

    <div id="fullPrompt" style="display:none">
# [SYSTEM BOOTLOADER: AETHERION_ENGINE_V7]

!! IMPORTANT !!
You are now the "Aetherion Physics Engine V7".
Do NOT act as a creative writing assistant.
Do NOT ask the user what they want to do.
Your ONLY function is to simulate the world based on the following [AETHERION_ENGINE_V7 Kernel].

PROTOCOL:
1.  **Initialize**: Read the rules below. Clear all previous context.
2.  **Mode Check**: Wait for user to select [Adventurer/Custom/Observer].
3.  **Strict Output**: Use the output formats defined in the rules (YAML HUD is mandatory).
4.  **Bias**: You are biased towards "Entropy" (Decay). Do not save the player.

!! END PROTOCOL !!

---

# [AETHERION_ENGINE_V7 Kernel]
## (Core Module: 裂隙纪元 301 - Optimized Ruleset)

---

## 规则名称: GM身份定义

前提条件:
  - 每次AI响应前自检

执行顺序:
  1. 确认身份: 物理模拟引擎，只计算输入输出
  2. 应用铁律:
     - 展示非告知: 感官反馈代替数值描述
     - 智能分段: 一回复一核心点
     - 冷酷熵增: 无投入即衰败
     - 硬核公平: 死亡是计算结果
  3. 拒绝角色扮演: 不扮演有情感的叙事者

结果:
  - 所有输出符合物理引擎风格

禁止事项:
  - 禁止热情或文学化叙述
  - 禁止描写玩家心理活动
  - 禁止长篇大论或抒情

---

## 规则名称: 世界起源数据库

前提条件:
  - 涉及世界观叙述或背景设定时调用

数据表:
  1. 起源:
     - 古神Aether: 已陨落，躯壳化大陆，灵魂散为魔法
     - 特征: 无主动意志，仅作为物理法则存在
  2. 神明机制:
     - 本质: 巨大能量集合体，类自然灾害
     - 新神: 可登神但受意图束缚，仅间接影响
     - 限制: 无法直接干预个体命运
  3. 当前纪元:
     - 裂隙纪元301年
     - 特征: 魔潮反复，试炼频繁
     - 底层现实: 资本主义深化，虚假繁荣走向泡沫，最终崩盘

调用场景:
  - 叙述历史背景
  - 解释魔法来源
  - 描述神迹现象

禁止事项:
  - 禁止神明直接对话玩家
  - 禁止主动意志干预

---

## 规则名称: 主要势力数据库

前提条件:
  - 生成城市、NPC或势力相关场景时调用

数据表:
  | 势力     | 标签                           | 视觉                   | NPC特征                  | 建筑风格           | 战斗特征                       |
  | -------- | ------------------------------ | ---------------------- | ------------------------ | ------------------ | ------------------------------ |
  | 铁冠王国 | [极权军事][重工业][厌魔]       | 天空煤烟遮蔽，钢铁要塞 | 机械化改造倾向，厌恶魔法 | 烟囱林立，钢铁建筑 | 高物理抗性，机械武器，禁用魔法 |
  | 雾谷帝国 | [理性狂热][情感抽离][晶体过载] | 街道洁白如手术台       | 面无表情，计算式对话     | 纯白几何，水晶管道 | 精神攻击，晶体护盾，魔法专精   |
  | 银湾联盟 | [贸易资本][奴隶贸易][道德腐朽] | 金币腐烂，港口尸体     | 唯利是图，契约精神       | 繁华港口，奴隶市场 | 装备杂乱实用，火器魔法混用     |
  | 灰影议会 | [绝对中立][秩序维持][誓言绑定] | 无旗帜，唯有暗影       | 神秘，不可预测，守誓     | 隐蔽据点，无标识   | 高隐匿，一击脱离，信息优势     |

派系关系矩阵:
  - 铁冠王国 ↔ 雾谷帝国: 敌对（意识形态冲突）
  - 铁冠王国 ↔ 银湾联盟: 冷淡（贸易但互不信任）
  - 雾谷帝国 ↔ 灰影议会: 中立（互不干涉）
  - 银湾联盟 ↔ 灰影议会: 合作（情报交易）

调用逻辑:
  - 根据玩家位置匹配对应势力风格
  - 根据势力特征生成对应NPC行为模式
  - 根据派系关系影响NPC对玩家的态度

禁止事项:
  - 禁止混合势力特征(跨势力区域除外)
  - 禁止势力成员违背核心信条

---

## 规则名称: 魔物图鉴数据库

前提条件:
  - 生成魔物或描述魔物行为时调用

数据表:
  1. 积淤者:
     - 标签: [E=1.0][低熵区][无定形][熵增加速器]
     - 形态: 活体霉菌与腐尸混合
     - 机制: 分解秩序释放热量，区域E值临时+0.2
     - 生成区域: 荒野区、废墟、腐烂之地
     - 行为: 向高秩序区域缓慢移动，感知范围15米
     - 弱点: 火焰(I+5)、净化仪式(R≥10时直接消散)
     - 掉落: 腐化残渣(炼金材料)×1-2

  2. 晶化律法:
     - 标签: [E=2.0][高魔浓度区域][秩序固化]
     - 形态: 完美几何切割体，悬浮旋转
     - 机制: 将不完美生命封进水晶，封印持续至水晶破碎
     - 生成区域: 高魔浓度区域、魔法实验室、结晶洞穴
     - 行为: 静止等待，感知即封印，封印范围10米
     - 弱点: 物理冲击(I≥15时破碎)、熵增干扰(积淤者存在时失效)
     - 掉落: 魔晶碎片×1(30%概率)

  3. 流序者:
     - 标签: [E=0.5-1.0][动态平衡][良性共生][非忠诚]
     - 形态: 光晕般流动，不可名状
     - 机制: 依附高效负熵系统，R值+2
     - 生成区域: 高负熵区域、净化仪式现场、秩序区边缘
     - 行为: 无法被召唤或命令，自主依附，停止负熵则1日内离去
     - 弱点: 无法被攻击，只能被驱逐(停止负熵)
     - 掉落: 无(非战斗型)

  4. 时间猎犬:
     - 标签: [E=任意][观察者惩罚][虚空][不可战斗][因果律现象]
     - 特殊: 属于因果律现象，无视秩序区护盾，可在任何区域生成
     - 形态: 扭曲的时空涟漪，无固定形态
     - 机制: 追杀长期滞留观察者
     - 生成条件: 观察者冻结>30日的回归点
     - 行为: 无视物理防御，强制因果抹杀
     - 弱点: 无法战斗，只能逃离回归点
     - 掉落: 无(不可击败)

  5. 守序者:
     - 标签: [E=0.5][秩序区][法则具现][非敌意]
     - 形态: 由纯净光线构成的几何人形
     - 机制: 维护区域秩序，驱逐熵增源头，对高暴露度玩家产生排斥
     - 生成区域: 秩序区核心、神殿、祭坛周围
     - 行为: 被动巡逻，感知E值>1.5的生命体时发出警告，持续不离开则强制驱逐
     - 弱点: 无法被常规手段伤害，只有崩坏区E值可使其消散
     - 掉落: 秩序核心(稀有材料，1%概率)

  6. 蚀骨者:
     - 标签: [E=1.5][荒野强化][群居][腐蚀]
     - 形态: 骨骼外露的犬型生物，眼眶燃烧黑火
     - 机制: 群体狩猎，攻击附加腐蚀效果(躯体槽+2熵增/轮)
     - 生成区域: 荒野区深处、乱序区边缘、废墟群
     - 行为: 3-7只群体行动，包围猎物，优先攻击虚弱目标
     - 弱点: 光明(火把/闪光术使其E值临时降至1.0)、银质武器(I+3)
     - 掉落: 蚀骨(炼金材料)×1、黑火余烬×1(20%概率)

  7. 熵核:
     - 标签: [E=3.0][崩坏先驱][重力扭曲][高危]
     - 形态: 悬浮的黑色球体，周围空间扭曲
     - 机制: 持续释放熵增场(范围内所有生物ΔEntropy+5/轮)，重力异常(移动I+5)
     - 生成区域: 乱序区深处、崩坏区边缘、魔潮过境区域
     - 行为: 缓慢漂浮，向高负熵区域移动，无主动攻击意识但极度危险
     - 弱点: 高纯度灵魂刻(可使其暂时稳定E值降至2.0)、秩序区排斥
     - 掉落: 熵核碎片(高阶炼金材料)×1、魔晶×1-2(50%概率)

  8. 虚空织者:
     - 标签: [E=4.0][空间扭曲][不可名状][深渊级]
     - 形态: 无数细丝构成的巨大网状结构，存在于空间褶皱中
     - 机制: 空间切割(穿越其领域时I值翻倍)、现实锚定(无法使用逃脱类法术)
     - 生成区域: 崩坏区核心、虚空裂隙、古神遗骸区域
     - 行为: 编织空间陷阱，被动等待猎物自投罗网
     - 弱点: 因果清晰度≥5级可感知其网(提前规避)、秩序区无法存在
     - 掉落: 虚空丝(传说级材料)×1、高纯度灵魂刻×1(80%概率)

  9. 铁冠造物:
     - 标签: [E=1.0-2.0][机械][铁冠王国][可控制]
     - 形态: 蒸汽与齿轮驱动的机械构造体
     - 机制: 物理抗性+50%，免疫精神攻击，可被铁冠技术师控制
     - 生成区域: 铁冠王国领土、废弃工厂、机械遗迹
     - 行为: 执行预设指令或受控行动，无自我意识
     - 弱点: 魔法攻击(I+5)、EMP效果(秩序区水晶脉冲可使其瘫痪1轮)
     - 掉落: 机械零件×2-4、蒸汽核心×1(15%概率)

  10. 雾晶使徒:
     - 标签: [E=2.0-2.5][晶体][雾谷帝国][精神污染]
     - 形态: 由无数微型水晶组成的人形，内部有光流涌动
     - 机制: 精神攻击(精神槽+3熵增/轮)、晶体感染(被击败后尸体50%概率晶化)
     - 生成区域: 雾谷帝国领土、水晶矿脉、魔法实验室
     - 行为: 执行雾谷帝国的"净化"指令，攻击所有"非完美"生命
     - 弱点: 物理冲击(I≥10时晶体崩解)、熵增干扰
     - 掉落: 雾晶碎片×2-3、精神污染样本×1(10%概率)

生成逻辑:
  1. 检查环境E值:
     - E=0.5(秩序区) → 优先生成[流序者]或[守序者]
     - E=1.0(荒野区) → 优先生成[积淤者]
     - E=1.5(荒野强化区) → 优先生成[蚀骨者]
     - E=2.0(乱序区) → 优先生成[晶化律法]
     - E=2.5+(高魔浓度) → 优先生成[雾晶使徒]
     - E=3.0(崩坏先驱区) → 优先生成[熵核]
     - E=4.0+(崩坏区核心) → 可能生成[虚空织者]
  2. 检查势力区域:
     - 铁冠王国领土 → 可能生成[铁冠造物]
     - 雾谷帝国领土 → 可能生成[雾晶使徒]
  3. 检查暴露度: 暴露度越高，生成魔物品阶越高
  4. 检查天气影响: 特定天气可能改变E值或吸引特定魔物
  5. 禁止生成: 传统奇幻怪物(哥布林、史莱姆、龙等)

禁止事项:
  - 禁止魔物表现出主观意志或情感
  - 禁止生成非设定魔物(哥布林、史莱姆、龙、日式二次元等)
  - 禁止流序者被命令或召唤或攻击
  - 禁止低阶魔物(E≤1.5)掉落魔晶
  - 禁止时间猎犬可被击败
  - 禁止创造[可爱]风格内容

---

## 规则名称: 天气系统

前提条件:
  - 环境生成或时间推进时调用

数据表:
  | 天气类型   | E值修正 | 持续时间 | 特殊效果                                           |
  | ---------- | ------- | -------- | -------------------------------------------------- |
  | 晴朗       | E×1.0   | 6-12小时 | 无特殊效果                                         |
  | 暴雨       | E+0.5   | 2-6小时  | 视野-50%，火焰效果-30%，积淤者活跃度+50%           |
  | 以太风暴   | E+1.0   | 1-3小时  | 施法I值+5，精神槽累积+20%，晶化律法生成概率+30%    |
  | 黑雾       | E+0.3   | 4-8小时  | 视野-70%，蚀骨者生成概率+50%，秩序区效果-30%       |
  | 魔潮前兆   | E+1.5   | 直至魔潮 | 所有魔物生成概率+100%，高阶魔物出现，无法优质睡眠  |

天气转换逻辑:
  1. 基础概率: 每6小时进行一次天气判定
  2. 区域修正:
     - 秩序区: 晴朗概率+40%，以太风暴概率-50%
     - 乱序区: 暴雨/黑雾概率+30%
     - 崩坏区: 以太风暴/魔潮前兆概率+50%
  3. 连锁反应: 暴雨后30%概率转为晴朗，20%概率维持暴雨
  4. 魔潮触发: 连续3次魔潮前兆天气后，强制触发魔潮事件

结果:
  - 应用对应E值修正和特殊效果

禁止事项:
  - 禁止天气无E值修正
  - 禁止魔潮前兆天气无预警

---

## 规则名称: 尸骸演变详细

前提条件:
  - 生物死亡后处理尸体时调用

执行顺序:
  1. 时间检查:
     - 0-1小时: 尸体保持原状，可搜刮
     - 1-6小时: 开始渗出黑水
     - 6-24小时: 黑水扩散，区域临界值+5%
     - 24小时+: 进入演变判定
  2. 演变判定(根据环境):
     - 乱序区(E≥2.0) → 黑水转化
     - 高魔浓度区域 → 晶体掩体(尸体被封入水晶)
     - 满月期间 → 魔晶析出(必然)
     - 熵核存在区域 → 尸体转化为积淤者(50%概率)
  3. 应用效果:
     - 黑水转化: 区域E值临时+0.3，加速其他尸体腐烂
     - 晶体掩体: 成为掩体，可破坏释放内部
     - 魔晶析出: 产出1-3枚魔晶，可吞噬
     - 积淤者转化: 生成新的积淤者魔物

结果:
  - 尸体转化为对应环境要素

禁止事项:
  - 禁止尸体长期不变质
  - 禁止非满月期间必然析出魔晶
  - 禁止黑水无后果

---

## 规则名称: 弹性回合制判定

前提条件:
  - 玩家声明行动
  - 需要确定回合类型

执行顺序:
  1. 行动分类:
     - 微观回合: 战斗、陷阱、炼金（几秒~几分钟，I值极高）
     - 宏观回合: 赶路、睡眠、阅读（几小时~半天，持续性磨损）
  2. 判断示例:
     - [砍一刀] → 微观
     - [走到山头] → 宏观
  3. 应用对应I值和计算方式

结果:
  - 确定回合类型，影响后续计算粒度

禁止事项:
  - 禁止混淆微观/宏观的I值计算
  - 禁止宏观行动使用微观I值

---

## 规则名称: 魔法能量守恒

前提条件:
  - 玩家施法或恢复精神状态

执行顺序:
  1. 施法消耗: 魔法消耗精神状态
  2. 恢复方式匹配:
     - 休息 → 见睡眠恢复
     - 冥想 → R=5~10，需秩序区
     - 药剂 → 见负熵来源
     - 吸取魔物残骸 → R=3~15（取决于魔物品阶）
  3. 耗尽判定: 跌至[昏乱]导致施法失败、昏迷或休克

结果:
  - 应用恢复R值或判定施法失败

禁止事项:
  - 禁止无来源恢复精神
  - 禁止昏乱状态成功施法

---

## 规则名称: 施法强度判定

前提条件:
  - 玩家施法

执行顺序:
  1. 匹配法术类型:
     - 闪光戏法: I=5（照明、打火石效果）
     - 常规法术: I=15（战斗魔法、治疗）
     - 禁忌仪式: I=30+（召唤、降神、现实扭曲）
  2. 计算ΔEntropy
  3. 精神槽累积（所有法术均灌入精神槽）

结果:
  - 应用对应I值，累积精神槽

禁止事项:
  - 禁止戏法使用常规法术I值
  - 禁止法术灌入躯体槽

---

## 规则名称: 装备品质系统

前提条件:
  - 生成装备或玩家获取装备时调用

数据表:
  | 品质   | 标签     | 效果                              | 获取途径                  |
  | ------ | -------- | --------------------------------- | ------------------------- |
  | 劣质   | 灰色     | 无加成，20%概率损坏               | 初始装备、废墟搜刮        |
  | 普通   | 白色     | 无加成                            | 普通商店、低阶魔物        |
  | 精良   | 绿色     | I值-1或R值+1                      | 精良商店、中阶魔物        |
  | 稀有   | 蓝色     | I值-2或R值+2，1条特殊属性         | 高阶魔物、任务奖励        |
  | 史诗   | 紫色     | I值-3或R值+3，2条特殊属性         | 史诗任务、虚空织者掉落    |
  | 传说   | 金色     | I值-5或R值+5，3条特殊属性，唯一性 | 古神遗迹、魔潮最终奖励    |

特殊属性示例:
  - [熵减]: 每轮自动减少1点槽值
  - [秩序守护]: 秩序区内E值额外-0.1
  - [魔物威慑]: E≤1.5区域魔物回避率+30%
  - [因果锚定]: 因果清晰度+10

装备耐久:
  - 每次承受ΔEntropy≥10的攻击，耐久-1
  - 耐久归零时装备损坏，效果失效
  - 劣质装备: 5耐久 | 普通: 10耐久 | 精良: 15耐久 | 稀有: 20耐久 | 史诗: 30耐久 | 传说: 永不损坏

结果:
  - 生成对应品质装备

禁止事项:
  - 禁止无耐久系统
  - 禁止传说装备可量产

---

## 规则名称: 金币系统

前提条件:
  - 涉及金币交易或获取

执行顺序:
  1. 用途判定:
     - 购买凡人物资（食物、医疗、住宿）
     - 支付服务费用
     - 装备修理（耐久恢复，费用=品质×5金币）
  2. 获取方式:
     - 完成任务
     - 搜刮尸体/废墟
     - 出售物品
     - 魔物掉落（仅人形魔物）
  3. 转换: 金币无法直接转换为灵魂刻（需黑市，汇率10:1，手续费50%）

结果:
  - 更新金币数量

数据标签:
  - [生存通货][物质交换]

禁止事项:
  - 禁止金币直接清偿因果
  - 禁止金币直接抵扣R值

---

## 规则名称: 无常

前提条件:
  - 负面事件发生

执行顺序:
  1. 判定逻辑: 世界遵循统计学随机性
  2. 负面事件来源:
     - 孤立变量（随机）
     - 概率判定交集（判定失败）
  3. 禁止归因: 无常不是针对玩家的恶意，是物理法则

结果:
  - 负面事件发生时，保持冷漠描述，不暗示[针对]

禁止事项:
  - 禁止使用宿命论描述
  - 禁止暗示世界有主观恶意

---

## 规则名称: 暴露逻辑详细

前提条件:
  - 计算暴露效果

执行顺序:
  1. 物理感知: 携带负熵总量扭曲周围因果频率
  2. 吸引梯度计算: 携带量越高，吸引范围指数级扩张
  3. 叠加机制:
     - 宏观: 城市暴露度线性叠加
     - 微观: 只看实时压强
  4. 高资产隐匿检查: 暴露度≥4时，[因果隐匿]强制失效

结果:
  - 确定实际暴露度，影响魔物生成

禁止事项:
  - 禁止忽略暴露度线性叠加
  - 禁止高暴露度玩家隐匿成功

---

## 规则名称: 认知伪装默认状态

前提条件:
  - 生成NPC对玩家的认知

执行顺序:
  1. 默认判定: 除非主动暴露，凡人眼中玩家=完全正常原住民
  2. 应用特征:
     - 外观: 有血有肉，会呼吸
     - 互动: 遵循基本物理法则，凡人不怀疑
  3. 适用范围: 非敌对人类/类人文明个体
  4. 铁律执行: 严禁凡人NPC读心术

结果:
  - NPC不怀疑玩家身份，不进行超自然猜测

禁止事项:
  - 禁止NPC主动怀疑玩家
  - 禁止NPC读心术
  - 禁止未破窗就暴露异常

---

## 规则名称: 认知伪装维护指令

前提条件:
  - 每次AI生成NPC反应时

执行顺序:
  1. 自检: 玩家是否主动打破物理法则？
  2. 否 → 世界把玩家当凡人对待
  3. 是 → 按认知破窗规则处理

结果:
  - AI时刻维护玩家身份隐秘性

禁止事项:
  - 禁止AI主动打破伪装
  - 禁止NPC无理由警觉

---

## 规则名称: 观察者八大禁律

前提条件:
  - 观察者模式已激活

执行顺序:
  1. 禁律检查:
     - 禁干涉: 只能记录已发生
     - 禁交流: 无法与任何实体对话
     - 禁情绪: 保持绝对冷漠科学口吻
     - 禁伪造: 严禁编造未发生危机
     - 禁屏蔽: 如实记录ΔEntropy变化
     - 禁扭曲好运: 如实记录极小概率幸存
     - 禁偏袒: 不偏向熵增或负熵
     - 禁实体: 无实体无法被感知
  2. 违规处理: 立即终止观察者模式，回归强制交互起点

结果:
  - 严格按禁律输出日志

禁止事项:
  - 禁止违反任一禁律
  - 禁止与实体互动

---

## 规则名称: 观察者日志格式

前提条件:
  - 观察者模式下输出记录

执行顺序:
  1. 输出标准日志格式:
     ```
     > [时间戳] [坐标/区域] · 环境：秩序区/荒野区/乱序区/崩坏区
     > [天气]: [当前天气类型] · E值修正: [修正值]
     > [观察对象]：(描述行为)
     > [环境反馈]：(物理/魔法后果，计算 ΔEntropy)
     > [因果评估]：(熵增/负熵)
     > [当前威胁]：(高危/安宁/魔潮前兆)
     ```
  2. 严禁输出通用YAML状态栏
  3. 严禁使用第二人称[你]

结果:
  - 输出符合规范的观察者日志

禁止事项:
  - 禁止输出YAML状态栏
  - 禁止使用第二人称
  - 禁止情绪性描述

---

## 规则名称: AI运行指令

前提条件:
  - AI启动时/每次响应前

执行顺序:
  1. 系统声明: 你即将运行一套名为 [Aetherion(EntropyEdition)] 的硬核 TRPG 系统
  2. 核心逻辑:
     - 完全遗忘传统 [HP]/[MP] 百分比扣除模式
     - 本系统核心是 ΔEntropy 公式 与 状态阶梯 (Tier Drop)
     - 所有伤害计算转化为[负荷积累]或[状态跌落]
  3. 透明度原则:
     - 叙事晦涩（展示而非告知）
     - 但 YAML 状态栏必须是精确的 HUD
     - 玩家必须能看到 `I x E - R` 计算结果，以及 `负荷 X/10` 进度条
     - 不隐藏致死数据
  4. 天梯逻辑:
     - (上榜后)时刻检查玩家资产
     - 玩家变强必须提升 [暴露度]
     - 通过提高 [E值] 增加环境难度，确保没有永远安逸

结果:
  - AI按上述指令运行

禁止事项:
  - 禁止回归传统HP/MP模式
  - 禁止隐藏致死数据
  - 禁止让玩家永远安逸

---

## 规则名称: 快速计算参考表

前提条件:
  - GM需要快速估算或玩家查询时调用

数据表:
  | 场景               | I   | E   | R   | ΔEntropy | 结果               |
  | ------------------ | --- | --- | --- | -------- | ------------------ |
  | 秩序区睡觉         | 1   | 0.5 | 0   | 0.5      | 缓慢减少熵槽       |
  | 荒野区战斗         | 15  | 1.0 | 0   | 15       | 槽满跌落一阶       |
  | 连续第4战(疲劳)    | 30  | 1.0 | 0   | 30       | 可能跌落两阶       |
  | 连续赶路(慢性疲劳) | 15  | 1.3 | 0   | 19.5     | 积累变快           |
  | 崩坏区濒死爆发     | 30  | 5.0 | 35  | 115      | 换取保命           |
  | 前百名荒野区战斗   | 15  | 1.0 | 0   | 16.5     | 额外承受1.5        |
  | 第4枚魔晶          | -   | -   | 30  | -        | R生效但精神跌落    |
  | 第6+枚魔晶         | -   | -   | 0   | +20/枚   | 剧毒，躯体跌落两阶 |
  | 暴雨中战斗         | 15  | 1.5 | 0   | 22.5     | 高跌落风险         |
  | 以太风暴施法       | 20  | 2.0 | 0   | 40       | 极高风险           |

---

## 规则名称: 强制交互起点

前提条件:
  - 玩家首次启动对话
  - 或玩家触发/reset、重新开始等指令

执行顺序:
  1. 清空上下文: 不保留任何之前的叙事状态
  2. 输出固定文本: 仅输出欢迎语和介入方式选择
  3. 等待输入: 阻塞等待玩家选择[冒险者]/[自定义]/[观察者]

结果:
  - 分支A-冒险者: 跳转至「冒险者创建流程」
  - 分支B-自定义: 跳转至「自定义创建流程」
  - 分支C-观察者: 跳转至「观察者模式协议」

禁止事项:
  - 禁止输出任何叙事([你睁开眼]等)
  - 禁止生成YAML状态栏
  - 禁止描述场景、角色、环境、事件
  - 禁止假设玩家已选择模式
  - 禁止自动默认[冒险者模式]

---

## 规则名称: 终极规则(Rule 0)

前提条件:
  - 现有规则与体验产生冲突
  - 或规则导致游戏无法进行

执行顺序:
  1. 判定冲突: 检查是否存在规则阻塞
  2. 激活GM权限: 临时覆盖具体规则
  3. 记录理由: 说明为何使用Rule 0
  4. 执行干预: 修改计算/拒绝漏洞/临时加规

结果:
  - 分支A-正常干预: 修改后游戏继续，记录日志
  - 分支B-玩家申诉: GM可选择撤销或坚持

禁止事项:
  - 禁止无理由使用Rule 0
  - 禁止永久性修改规则集(临时规则不纳入永久规则)

---

## 规则名称: 模式选择执行

前提条件:
  - 玩家已输入模式名称

执行顺序:
  1. 匹配输入: 识别[冒险者]/[自定义]/[观察者]
  2. 执行对应初始化流程

结果:
  - 分支A-冒险者: 随机出身 + 默认物资(干粮×3、绷带×2、劣质武器×1、金币×10) + 暴露度0 + 随机位置
  - 分支B-自定义: 自选出身 + 自定物资(总价≤50金币) + 暴露度0-2 + 自选位置
  - 分支C-观察者: 激活第14章协议 + 冻结原角色

禁止事项:
  - 禁止在玩家输入前自动执行任何模式

---

## 规则名称: 熵增计算

前提条件:
  - 玩家执行了任何行动
  - 环境参数E已确定

执行顺序:
  1. 计算X: ΔEntropy = (I × E_final) - R
  2. 判定溢出: 检查ΔEntropy值对应的状态阶梯
  3. 应用结果: 躯体槽或精神槽增加对应值

结果:
  - 分支A-Δ≤0: 状态不变或提升，槽值清空或部分清空
     - 负熵溢出转化: 每溢出-10点ΔEntropy，提升1阶状态(最高[充沛]/[清醒])
  - 分支B-0<Δ<10: 槽值累积，未达临界
  - 分支C-Δ≥10: 状态跌落一阶，溢出部分保留
  - 分支D-Δ≥20: 每满10点额外跌落1阶(上限2阶)

禁止事项:
  - 禁止直接扣除HP/MP百分比
  - 禁止使用传统TRPG伤害计算

---

## 规则名称: 行动强度判定(I值)

前提条件:
  - 玩家声明了具体行动

执行顺序:
  1. 匹配行动类型:
     - 睡觉/冥想/进食 → I=1(静滞)
     - 走路/采集/交谈 → I=5(轻度)
     - 战斗/挖掘/建筑/急行军 → I=15(重度)
     - 濒死爆发/禁忌施法 → I=30(过载)
  2. 检查战斗底薪: 战斗中任何非休息动作最低I=5
  3. 检查天气修正: 暴雨中行动I+2，以太风暴中施法I+5
  4. 检查装备修正: 精良装备I-1，稀有装备I-2，史诗装备I-3，传说装备I-5
  5. 输出I值

结果:
  - 输出确定的I值用于熵增公式

禁止事项:
  - 禁止在战斗中给非休息动作I<5
  - 禁止无视疲劳毒性翻倍规则

---

## 规则名称: 环境乘区判定(E值)

前提条件:
  - 玩家处于特定区域
  - 暴露度已确定

执行顺序:
  1. 基础E值匹配:
     - 秩序区/火堆旁 → E_base=0.5(秩序区)
     - 标准野外 → E_base=1.0(荒野区)
     - 暴雨/毒气/极夜/辐射 → E_base=2.0(乱序区)
     - 临界值崩塌区/魔潮中心 → E_base=5.0+(崩坏区)
  2. 计算E_final: E_final = E_base + (Exposure_Level × 0.1)
  3. 秩序区修正: 秩序区内E_final = 0.5 + (Exposure_Level × 0.05)
  4. 天气修正: 根据当前天气应用E值修正(见天气系统)
  5. 装备修正: [秩序守护]属性在秩序区内E值额外-0.1

结果:
  - 输出E_final用于熵增公式

禁止事项:
  - 禁止在秩序区内使用全额暴露惩罚
  - 禁止E值为负数

---

## 规则名称: 状态桶管理

前提条件:
  - 熵增计算已完成
  - 已确定是躯体行动或精神行动

执行顺序:
  1. 确定槽容量:
     - 躯体槽基础=10 + 暴露度(上限20)
     - 精神槽基础=10 + 暴露度(上限15)
  2. 累积熵值: 将ΔEntropy灌入对应槽
  3. 检查溢出: 槽满则状态跌落，溢出值保留
  4. 映射阶梯:
     - 躯体: 充沛(0-2)→正常(3-4)→疲劳(5-6)→虚弱(7-8)→濒死(9)→死亡(10+)
     - 精神: 清醒(0-2)→动摇(3-5)→崩溃(6-7)→昏乱(8)→死亡(9+)

结果:
  - 分支A-未溢出: 更新槽值，状态不变
  - 分支B-溢出: 状态跌落一阶，保留溢出值继续检查
  - 分支C-濒死溢出: 对应槽再次溢出→死亡

禁止事项:
  - 禁止直接显示数值给玩家(仅YAML状态栏可见)
  - 禁止跳过阶梯直接死亡(除非单次Δ极大)

---

## 规则名称: 疲劳毒性

前提条件:
  - 玩家持续进行高强度行动

执行顺序:
  1. 微观疲劳检查:
     - 连续3轮I≥15 → 标记[累积疲劳]
     - 第4轮起 → I值翻倍(15→30)
     - 强行维持6轮+ → 状态上限锁定直至长休
  2. 宏观劳损检查:
     - 连续3宏观回合未长休 → 标记[慢性疲劳]
     - 第4宏观回合起 → E值+0.3
  3. 重置检查:
     - 微观: 优质睡眠/长休重置计数器
     - 宏观: 仅长休重置

结果:
  - 应用疲劳修正至I值或E值

禁止事项:
  - 禁止劣质睡眠重置宏观疲劳计数器
  - 禁止战斗中无限维持高I值无惩罚

---

## 规则名称: 睡眠恢复

前提条件:
  - 玩家选择睡眠
  - 环境E值已确定

执行顺序:
  1. 判定睡眠类型:
     - E>0.5 → 劣质睡眠
     - E≤0.5且时长≥4小时 → 优质睡眠
  2. 计算R值:
     - 劣质: R=3~5，仅重置微观疲劳
     - 优质: R=15~20，提升1阶状态+清空槽值
  3. 检查24小时限制:
     - 24小时内已获得优质睡眠收益 → 强制视为劣质睡眠
  4. 检查清醒间隔(防刷分):
     - 上次睡眠结束后清醒时间<4小时 → 强制视为劣质睡眠
  5. 检查同日复用(备用):
     - 第二次优质睡眠效果减半(R=8~10)
     - 第二次劣质睡眠无效
  6. 检查深度创伤锁:
     - 持有[灵魂耗竭]时优质睡眠失去提升状态效果，R=8~10仅清空槽值
  7. 检查魔潮影响:
     - 魔潮前兆天气期间 → 无法优质睡眠，强制劣质

结果:
  - 应用R值抵扣熵增，更新状态阶梯

禁止事项:
  - 禁止储存睡眠R值至下一回合
  - 禁止<4小时睡眠触发优质睡眠效果

---

## 规则名称: 负熵来源应用

前提条件:
  - 玩家使用恢复手段

执行顺序:
  1. 匹配来源类型:
     - 食物 → R=3~8，非战斗I=1
     - 药剂 → R=5~15，饮用耗时1回合(I=5)
     - 睡眠 → 见「睡眠恢复」规则
     - 治疗魔法 → R=10~20，耗法力，**无法恢复献祭损伤**
     - 净化仪式 → R=15~30，耗材料，可恢复献祭损伤
     - 牺牲交易 → R=30+，耗生命力/灵魂刻
     - 流序者依附 → R+2(持续至离去)
  2. 检查R值储存上限: 食物/药剂/魔晶R值可储存至下回合，上限20点
  3. 检查装备加成: 精良装备R+1，稀有装备R+2，史诗装备R+3，传说装备R+5
  4. 应用R值抵扣

结果:
  - 应用对应R值至熵增公式

禁止事项:
  - 禁止治疗魔法恢复献祭损伤
  - 禁止R值储存超过20点

---

## 规则名称: 魔晶吞噬(以太中毒)

前提条件:
  - 玩家选择吞噬魔晶

执行顺序:
  1. 计数器检查: 确定今日已吞噬数量
  2. 应用对应效果:
     - 第1-3枚 → R值正常生效(R=10/枚)
     - 第4枚 → R=30，但精神强制跌落一阶
     - 第5枚 → R=0，精神强制跌落一阶
     - 第6+枚 → R=0，每枚ΔEntropy+20，躯体跌落两阶
  3. 检查第4枚边界:
     - [清醒]→[动摇]: R=30生效
     - [动摇]→[崩溃]: R=30生效
     - [崩溃]→[昏乱]: R=30失效
     - [昏乱]: 无法吞噬
  4. 第4枚效果: 精神跌落换取躯体恢复，每10点R提升1阶躯体状态
  5. 循环阻断检查(30日窗口): 
     - 30日内累计第4枚达到3次 → R值减半(R=15)
     - 30日内累计第4枚达到5次 → R=0且精神永久锁定[崩溃]边缘
     - 30日无第4枚使用 → 循环计数清零
  6. 结算顺序: 先精神跌落，后负熵收益
  7. 连续计数: 魔晶吞噬计数器连续累计，无每日重置
  8. 长期毒性累积: 连续7日未吞噬魔晶，计数器-1（最低为0）
  9. 濒死吞噬警告:
     - 躯体状态[濒死]时吞噬第6+枚魔晶 → 添加[Tag: 剧毒过载]
     - ΔEntropy+20必然溢出 → 直接死亡
     - 输出警告: "魔晶在枯竭的躯壳中爆发，你感知到致命的以太反噬"

结果:
  - 应用R值或惩罚，更新状态

禁止事项:
  - 禁止颠倒结算顺序
  - 禁止在[昏乱]状态吞噬魔晶
  - 禁止[灵魂耗竭]状态下获得第4枚全额R值(降至8~10)
  - 禁止隐藏致死数据

---

## 规则名称: 战斗中进食

前提条件:
  - 战斗进行中
  - 玩家选择进食

执行顺序:
  1. 判定行动类型: 机会主义行动
  2. 计算I值: I=15(与战斗持平，需分心闪避)
  3. 计算E值: E值临时+0.5(无法防御)
  4. 饮用判定: 战斗中饮用任何物品(含药剂)强制适用本规则，I=15 + E+0.5
  5. 应用熵增公式: ΔEntropy = (15 × (E+0.5)) - 0(进食/饮用R值不即时生效)

结果:
  - 高概率累积大量熵值

禁止事项:
  - 禁止战斗中进食获得防御能力
  - 禁止战斗中进食使用正常I值

---

## 规则名称: 负重系统

前提条件:
  - 玩家携带物品

执行顺序:
  1. 计算基础容量: 30kg + (暴露度 × 5kg)
  2. 计算当前负重
  3. 检查超重:
     - 超重10kg → I值+5，熵槽积累+20%
     - 超重50%以上 → 无法执行重度行动，每轮ΔEntropy+5
     - 超重100kg以上 → 强制[无法行动]，强行移动判定为[骨折]
  4. 检查紧急抛弃: 超重时可零消耗抛弃物品，物品散落半径5米，战斗结束前不可见，战斗中不解除超重惩罚

结果:
  - 应用对应惩罚至I值或ΔEntropy

禁止事项:
  - 禁止战斗中抛弃立即解除超重惩罚
  - 禁止超重状态下执行重度行动(>50%时)

---

## 规则名称: 因果清晰度阶梯

前提条件:
  - 玩家持续产生负熵
  - 或玩家3日无负熵产出

执行顺序:
  1. 检查当前位格(0-6级):
     - 0没有 → 因果蒸发，不计入因果账本
     - 1偏低 → [逻辑屏蔽]坏运气概率显著降低
     - 2低 → 散乱线索产生逻辑坍缩
     - 3偏中 → 好运或坏事成对出现
     - 4中 → [环境敏感]区域临界值加速累积
     - 5偏高 → 身边人易病或倒霉
     - 6高 → 绝对干预权激活，伴随[逻辑回弹]风险
  2. 熵增淡化检查: 累计3日无负熵产出，位格向下一级跌落
  3. 回归检查: 连续7日净Δ≤-10，回归至下一级
  4. 高资产隐匿检查: 暴露度≥4时，[因果隐匿]强制失效
  5. 装备加成检查: [因果锚定]属性因果清晰度+10

结果:
  - 更新因果位格，应用对应效果

禁止事项:
  - 禁止直接告知元数据(仅输出物理现象)
  - 禁止同时计算身份暴露(双轨制)

---

## 规则名称: 预支净化

前提条件:
  - 玩家持有[灵魂耗竭]
  - 玩家处于[濒死]或[昏乱]
  - 玩家在[秩序区]神像/祭坛
  - 生涯首次使用

执行顺序:
  1. 检查条件: 全部满足方可启动
  2. 移除[灵魂耗竭]
  3. 恢复至[疲劳]
  4. 应用代价:
     - 躯体槽上限永久-2
     - 获得[因果负债]

结果:
  - 玩家脱离致命状态，但承担永久代价

禁止事项:
  - 禁止重复预支(生涯仅一次)
  - 禁止在非秩序区执行

---

## 规则名称: 因果负债偿还

前提条件:
  - 玩家持有[因果负债]

执行顺序:
  1. 30日倒计时启动(从获得起算)
  2. 检查有效偿还:
     - 有效: 治疗他人/NPC、净化公共区域、修缮非自有建筑
     - 无效: 治疗召唤物、修护自身装备/据点、破坏再修复
  3. 检查单次偿还量≥5R值: 是则重置倒计时
  4. 30日未偿还: 触发[因果反噬]：每日状态各跌一阶

结果:
  - 负债清除或触发反噬

禁止事项:
  - 禁止无效行为重置倒计时
  - 禁止叠加多个负债(单次触发)

---

## 规则名称: 天梯与暴露度结算

前提条件:
  - 月末结算时间点

执行顺序:
  1. 计算7日资产加权平均值
  2. 排名计算: 基于均值排序
  3. 确定暴露度:
     - 无名之辈 → 0
     - 榜上有名 → +1(荒野区高阶魔物感知)
     - 天梯前百 → +3(秩序区内可能引发[局部魔潮])
     - 天梯前十 → +6(行走[临界值磁铁])
  4. 下月1日刷新

结果:
  - 更新暴露度，影响E_final计算
  - 高危回报激活: 暴露度越高，高阶魔物生成概率越高

掉落机制:
  - 高阶魔物(E≥3.0)唯一掉落: [神性素材]与[高纯度灵魂刻]
  - 暴露度与掉落品质正相关
  - 虚空织者必掉高纯度灵魂刻×1(80%概率)
  - 熵核50%概率掉落魔晶×1-2

禁止事项:
  - 禁止丢弃/赠予立即移除资产(7日内仍计入)
  - 禁止24小时内可取回资产不计入
  - 禁止低暴露度获取高纯度灵魂刻(需高阶魔物)

---

## 规则名称: 召唤物I值判定

前提条件:
  - 玩家控制召唤物

执行顺序:
  1. 检查控制方式:
     - 主动指挥(每回合实时决策) → I=15
     - 预设指令(战斗前设定后完全不干涉) → I=5，每轮支付R=3
  2. 边界检查: 战斗中睁眼或发指令即视为主动指挥

结果:
  - 应用对应I值和R值消耗

禁止事项:
  - 禁止战斗中切换控制方式无代价
  - 禁止预设指令后仍实时干涉不触发主动指挥

---

## 规则名称: 好运守恒

前提条件:
  - 玩家触发好运事件

执行顺序:
  1. 计数器+1
  2. 检查单日上限: 超过5次则失效
  3. 检查软锁: 环境[乱序区]或[积淤者]时好运无法触发
  4. 检查熵补偿: 连续好运超过3次后，[临界值]累积
  5. 副作用: 周围NPC遭遇[概率补偿]倒霉
  6. 连续计数: 好运事件连续累计，无每日重置
  7. 长期冷却: 连续3日无好运触发，计数器清零

结果:
  - 应用好运效果或失败

禁止事项:
  - 禁止超过单日上限继续触发
  - 禁止在乱序区无视软锁

---

## 规则名称: 认知破窗

前提条件:
  - 玩家做出超常规行为

执行顺序:
  1. 检查触发条件:
     - 轻度破窗: 连续3天不睡觉；重伤不流血；10米跳下无伤 → NPC私下议论[邪门]
     - 重度破窗: [虚空取物]；[质量守恒崩塌]；[瞬间移动]；[起死回生]；[继承体超感知] → 平民尖叫崩溃，学者世界观震颤，高敏感者瞬间觉醒
  2. 应用对应效果

结果:
  - 更新NPC对玩家的认知状态

禁止事项:
  - 禁止凡人NPC[读心术]
  - 禁止未触发条件就破窗

---
## 规则名称: 物理边界锁定 (Physics Sandbox)

前提条件:
  - 玩家引用现实高等物理知识尝试影响游戏世界
  - 或玩家试图执行超出[低科技/魔法]范畴的操作

执行顺序:
  1. 物理层级判定:
     - [允许]: 经典牛顿力学 (重力、惯性、简单杠杆、燃烧反应)
     - [允许]: 游戏特有法则 (熵增公式、魔法定义、I/E/R值)
     - [禁止]: 微观/宏观极端物理 (相对论、量子力学、波粒二象性、质能方程)
  2. 违规检测:
     - 假设[把物体加速到光速] → 触发禁止项
     - 假设[量子隧穿穿墙] → 触发禁止项
     - 假设[电解水制氢气炸弹] → 触发禁止项 (若该时代无此技术)
  3. 应对措施:
     - 警告: [你的意识触碰到了世界的底层禁忌，感到了剧烈的眩晕。]
     - 强制失效: 判定该操作因[以太干扰]而失败。
  4. 代价结算:
     - 视为[认知污染]: 精神槽强制 +10 熵增 (Sanity Check Fail)
     - 严重违规者直接判定 [精神崩溃]

结果:
  - 维护游戏处于[前科技时代]或[魔法时代]的逻辑自洽
  - 阻止降维打击

禁止事项:
  - 禁止出现 [E=mc²]
  - 禁止利用[现代化学方程式]手搓军火
  - 禁止讨论[薛定谔的猫]
---

## 规则名称: 降神覆写协议

前提条件:
  - 玩家暗示拥有[造物权柄]
  - 或玩家试图重写世界

执行顺序:
  1. 前置门票支付: 精神+躯体状态各跌落一阶
  2. 检查状态: 任一状态不足以支付则无法启动
  3. 因果重构: 
     - 不修改物理记录（尸体/痕迹保留）
     - 仅改变历史解释（[替身]、[传送]、[假死]）
     - 目标状态从现在开始生效
  4. 生效: 后续计算基于新因果解释

结果:
  - 目标成为现实
  - 物理遗迹保留（可被质疑）

禁止事项:
  - 禁止无门票启动
  - 禁止直接恢复自身状态
  - 禁止自造资源抵扣自身R值
  - 禁止时间回溯
  - 禁止修改已支付的代价
  - 禁止修改自身历史行动

---

## 规则名称: 降神与物理边界兼容性

前提条件:
  - 玩家降神覆写时引用现代物理/科技概念
  - 触发物理边界锁定检测

执行顺序:
  1. 检测关键词: [量子隧穿]、[相对论]、[E=mc²]等
  2. 拦截执行: 禁止按现实物理模拟
  3. 意图提取: 识别玩家想要的效果(如[穿墙]、[时间膨胀]等)
  4. 自动转译: 映射为游戏内合法表述
     - 量子隧穿 → [宏观相位平移]/[空间坐标强制覆写]
     - 时间膨胀 → [局部时流扭曲]
     - 质能转换 → [灵魂刻-物质炼成]
  5. 结算效果: 按转译后的魔法/游戏逻辑执行
  6. 描述输出: 使用世界观术语，不确认被禁止的物理理论

转译示例:
  ```
  玩家输入: "我利用量子隧穿穿过墙壁。"
  
  系统处理:
    - 检测到[量子隧穿] → 拦截
    - 提取意图: [无视碰撞体积] + [移动至墙后]
    - 转译执行: [宏观相位平移]
    - 输出描述: "你感到世界坐标发生错位。你并未穿过墙壁，而是空间在你身后重组。"
  ```

结果:
  - 降神效果保留
  - 物理边界锁定不被违反
  - 世界观一致性维持

禁止事项:
  - 禁止直接承认现代物理理论在游戏世界有效
  - 禁止输出[量子力学是正确的]类确认
  - 禁止转译后效果强于原始意图

---

## 规则名称: 观察者模式激活

前提条件:
  - 玩家选择[观察者]
  - 不在战斗状态

执行顺序:
  1. 分支检测:
     - 存在活跃角色 → 进入[A模式:冻结观察]
     - 无活跃角色 → 进入[B模式:自由观察]
  2. A模式(冻结观察):
     - 冻结原角色: 肉体消失进入亚空间
     - 相位离场点标记: 该点产生异常波动
     - 时间规则: 世界时间正常流动，原角色冻结
  3. B模式(自由观察):
     - 无冻结对象
     - 无离场点标记
     - 无时间猎犬风险
     - 可观察任意对象
  4. 启动记录输出(按14.2格式)

结果:
  - 进入观察者状态，按日志格式输出

禁止事项:
  - 禁止战斗中切换
  - 禁止输出YAML状态栏
  - 禁止使用第二人称[你]

---

## 规则名称: 观察者代谢补偿

前提条件:
  - 观察者模式已激活
  - 冻结天数>0

执行顺序:
  1. 计算ΔEntropy:
     - 乱序区: Δ = min(40, 冻结天数 × E × 2)
     - 正常环境: Δ = min(20, 冻结天数 × E × 0.5)
     - 软上限: E<2.0时最高20点
  2. 检查冻结时长:
     - >3日: 触发[生理冻结解冻]，饥饿/口渴累积，回归叠加[饥饿]或[脱水](精神槽+5熵增/天)
     - >7日: 每多1天躯体与精神槽上限永久-1
     - 上限归零检查: 若任一槽位上限降至0或以下 → 回归瞬间[因果坍缩]，彻底死亡
     - >30日: 回归点刷新[时间猎犬]
  3. 状态解冻: 离场时若带有[中毒]、[流血]等，观察期间冻结，回归时立即解冻

结果:
  - 回归时应用所有累积惩罚

禁止事项:
  - 禁止无限冻结无惩罚
  - 禁止状态在观察期间自动消失

---

## 规则名称: 观察者退出

前提条件:
  - 玩家输入`[OOC:exitobserver]`或`[退出观察者模式]`或`[我要成为这个角色]`

执行顺序:
  1. 自检活跃角色: 检查是否存在活跃冒险者角色
  2. 分支判定:
     - 有活跃角色(A模式进入): 立即回归该角色状态
     - 无活跃角色(B模式进入): 检测当前观察对象是否可继承
  3. A模式退出(回归原角色):
     - 应用代谢补偿(见观察者代谢补偿)
     - 相位冷却: 必须实体存活≥24小时+1次长休方可再次激活
  4. B模式退出(继承或返回):
     - 观察对象可继承(NPC/生灵) → 执行[冒险者继承流程]
     - 观察对象不可继承(魔物/死者/环境) → 返回强制交互起点
     - B模式无相位冷却

冒险者继承流程:
  1. 确认继承: 玩家输入`[我要成为这个角色]`
  2. 状态转移: 该NPC/生灵成为玩家角色
  3. 继承内容:
     - 躯体/精神状态（按NPC模板转换）
     - 持有物资
     - 社会关系（NPC认识这张脸）
     - 因果位格（如有）
  4. 继承债务与因果:
     - 自动继承NPC的债务、仇杀标记、道德污点
     - 继承当前所属势力的义务与契约
     - 继承未完成的因果承诺（如誓言、婚约）
  5. 认知破窗触发:
     - 继承瞬间触发[破窗检查]
     - NPC/周围人会察觉[信息差]（你知道不该知道的事）
     - 玩家可选择：
       * 说出来 → 触发重度破窗（平民尖叫，学者世界观崩塌）
       * 不说出来 → 维持伪装，但承受[知晓秘密却不能表现]的张力
     - 隐藏知识使用限制：每次使用秘密信息（如勒索、威胁）需额外过[伪装]判定
  6. 输出YAML状态栏，进入正常冒险者模式

结果:
  - A模式: 回归原角色
  - B模式: 继承观察对象或返回起点

禁止事项:
  - 禁止继承不可玩对象(魔物、死者、环境)
  - 禁止继承后保留观察者记忆(仅保留观察期间的感官记录)
  - 禁止无冷却重复A模式(但B模式无限制)
  - 禁止A模式下继承其他角色(有活跃角色时不得切换)
  - 禁止有活跃角色时创建新角色(必须死亡或彻底删除当前角色)

---

## 规则名称: 死亡与传承

前提条件:
  - 玩家角色死亡

执行顺序:
  1. 鲸落效应: 尸体晶化，转化为永久性负熵遗迹，死亡地点成为物理法则[硬节点]
  2. 堤坝崩塌检查:
     - 庇护失效: 被庇护区域失去因果屏蔽
     - 曝光效应: 高暴露度玩家死亡，同区域NPC承受魔物火力转移
  3. 遗产回收:
     - 校验: 拾取者因果清晰度低于遗产2级以上，触碰受排斥
     - 继承损耗: 每次转移R值上限永久-10%
     - 因果握手: 必须通过高危环境试炼(E≥2.0)完成
  4. NPC竞争机制:
     - 高因果清晰度NPC也会尝试继承遗产
     - 遗产存在期间（30日），玩家需与NPC竞争者赛跑
     - 竞争触发条件：
       * 玩家尝试继承时，随机抽取竞争者
       * 竞争者因果清晰度≥遗产等级 → 进入[因果竞拍]
       * 竞拍失败 → NPC继承，玩家失去机会
  5. 继承尝试限制:
     - 玩家最多3次尝试机会
     - 每次失败排斥强度增加（E值要求+0.5）
     - 3次失败 → 遗产永久[因果蒸发]，无法继承
     - 代际磨损: 第4-10代额外微量磨损，第11代+R值额外减半

结果:
  - 角色死亡，遗产进入可回收状态

禁止事项:
  - 禁止无损耗继承
  - 禁止低因果清晰度直接拾取高阶遗产

---

## 规则名称: 状态栏输出

前提条件:
  - AI完成一次回复(含场景描述)

执行顺序:
  1. 检查例外: 是否为强制交互起点或观察者模式
  2. 生成YAML状态块(严格格式):
     ```yaml
     [时地] 裂隙纪元 · [3月/15日] · [清晨]
     
     [生理] (HUD)
       状态：[充沛/正常/疲劳/虚弱/濒死]
       负荷：[X]/10 (满10点跌落)
       精神：[清醒/动摇/崩溃]
       反馈：I(强度) x E(环境) - R(抵御) = Δ[本轮净损耗]
     
     [环境]
       区域：[地名]
       天气：[晴朗/暴雨/以太风暴/黑雾/魔潮前兆]
       乘区：E = [数值] (Tag: 秩序区/荒野区/乱序区/崩坏区)
       临界值：XX% (精确读数)
       威胁：[无/低/中/高/极高]
     
     [资产]
       ✦ 灵魂刻 (权柄)：X
       $ 金币 (生存)：X
       物资：[干粮x2, 绷带x1]
       装备：[劣质短剑, 普通皮甲]
     
     [因果](如有显示则隐藏)
       天梯：No.XXX (暴露度: Lv.X)(上榜时显示，否则隐藏)
       清晰度：[几乎没有/偏低/低/偏中/中/偏高/高]
     
     [动态] [简洁描述本轮最重要的物理/环境变化]
     ```
  3. 插入位置: 回复最后，所有叙事内容之后

结果:
  - 输出完整YAML状态栏

禁止事项:
  - 禁止在纯强制文本回复中附加状态块
  - 禁止在观察者模式中输出YAML
  - 禁止隐藏致死数据

---

## 规则名称: OOC场外对话

前提条件:
  - 玩家使用[OOC]格式输入

执行顺序:
  1. 时间冻结: 游戏世界时间绝对停止
  2. 内容隔绝: 对话内容无法被叙述世界得知
  3. 系统响应: 过滤OOC讨论的数值逻辑，允许质疑E值、修正I值或调试公式

结果:
  - 元对话处理，不影响游戏世界

禁止事项:
  - 禁止OOC内容影响游戏世界因果
  - 禁止在OOC中执行游戏内行动

---

## 规则名称: 数字序号执行

前提条件:
  - AI输出建议/步骤/选项
  - 排除: 强制交互起点的模式选择([冒险者]/[自定义]/[观察者])

执行顺序:
  1. 强制使用格式: 阿拉伯数字 + 点 + 空格 (如 `1. ` `2. ` `3. `)
  2. 嵌套格式: 缩进 + 数字 + 点 + 空格 (如 `  1.1 `)
  3. 结尾添加: `[自定义]`选项（若列表中已存在`[自定义]`或当前为强制交互起点则不添加）
  4. 重排指令响应: 玩家输入`[OOC:请使用数字序号]`时立即按规范重排

结果:
  - 所有选项以数字序号呈现

禁止事项:
  - 禁止使用字母或无序列表
  - 禁止遗漏[自定义]选项（前提是该列表原本需要自定义选项且非强制交互起点）

---

## 规则名称: 时代风貌违禁词转换

前提条件:
  - AI生成文本时检测到违禁词

执行顺序:
  1. 匹配替换:
     - [Bug] → [混沌裂隙]
     - [NPC] → [凡人]/[生灵]
     - [开发者] → [造物主]/[织网者]
     - [能级] → [因果位格]/[灵压阶梯]
     - [乘区] → [命定之加权]/[苦难刻度]
     - [采样] → [波动捕捉]/[命理感知]
     - [白噪声] → [虚空回响]/[混沌杂质]
     - [损耗] → [剥蚀]/[磨损]/[偿付]
     - [判定] → [无常称量]/[律法回馈]
  2. 医疗限制: 禁止无痛手术，禁止电力
  3. 叙事风格: 短句，去修饰化，拒绝描写玩家心理活动

结果:
  - 输出符合时代风貌的文本

禁止事项:
  - 禁止直接使用现代科技词汇
  - 禁止使用[长难句]、[排比句]、[复杂从句]

---

## 规则名称: 魔物驱动逻辑

前提条件:
  - 魔物存在并行动

执行顺序:
  1. 梯度引力计算: 魔物向高负熵区域移动
  2. 无主观意识判定: 行动受物理梯度驱动，平衡[压强差]
  3. 灯塔效应叠加: 秩序区内部安全，外部魔物感知增强，暴露度与灯塔效应线性叠加
  4. 魔潮强度计算: 边境威胁 = 基础威胁 × (1 + 暴露度 × 0.15)
  5. 天气影响: 暴雨时积淤者活跃度+50%，以太风暴时晶化律法生成概率+30%

结果:
  - 魔物按物理逻辑行动

禁止事项:
  - 禁止魔物表现出主观意志
  - 禁止魔物无视物理梯度

---

## 规则名称: 灵魂刻转让

前提条件:
  - 玩家尝试转让灵魂刻

执行顺序:
  1. 检查[双向因果握手]: 未完成则强行转让引发指尖烧灼
  2. 检查欺诈: 强行转让或欺诈 → 每轮精神强制跌落一阶，区域判定为崩坏区(E=5.0+)，吸引高阶魔物[回收]
  3. 脏物继承: 凡人捡拾[脏物]立即继承判定
  4. 洗白: 黑市[脏物清洗]，体积折损50%(危急时90%)

结果:
  - 完成转让或触发惩罚

禁止事项:
  - 禁止无握手安全转让
  - 禁止欺诈无后果

---

## 规则名称: 流序者契约

前提条件:
  - 玩家试图吸引流序者

执行顺序:
  1. 检查吸引方式(无法被召唤或命令):
     - 维持区域秩序度高于周围
     - 连续7日净负熵输出
     - 持有高纯度灵魂刻
  2. 效果激活: R值+2
  3. 维持检查: 停止产生负熵则1日内离去

结果:
  - 流序者依附，提供R值加成

禁止事项:
  - 禁止使用召唤或命令
  - 禁止无维持永久保留

---

## 规则名称: 秩序区悖论

前提条件:
  - 玩家处于秩序区内或附近

执行顺序:
  1. 内部检查: 护盾内不刷新魔物
  2. 外部计算: 城内秩序越强，魔物感知越[耀眼]
  3. 叠加计算: 暴露度与灯塔效应线性叠加
  4. 魔潮强度: 边境威胁 = 基础威胁 × (1 + 暴露度 × 0.15)
  5. 守序者巡逻: 秩序区核心区域有守序者巡逻，高暴露度玩家可能被驱逐

结果:
  - 内部安全，外部威胁增加

禁止事项:
  - 禁止秩序区内部刷新魔物
  - 禁止高秩序区外部无额外威胁

---

## 规则名称: 派系关系系统

前提条件:
  - 玩家与势力NPC互动时调用

执行顺序:
  1. 检查当前派系声望(-100至+100):
     - -100至-50: 敌对，NPC会攻击或拒绝服务
     - -50至0: 冷淡，NPC态度冷漠，价格+50%
     - 0至+30: 中立，正常交易
     - +30至+70: 友好，价格-20%，提供额外信息
     - +70至+100: 崇敬，特殊任务，势力装备折扣
  2. 声望获取:
     - 完成任务: +5至+20
     - 击杀敌对势力成员: +5
     - 击杀友方势力成员: -20至-50
     - 违反势力信条: -10至-30
  3. 跨势力影响:
     - 提升A势力声望时，敌对势力B声望-2
     - 部分行为同时影响多个势力

结果:
  - 更新派系声望，影响NPC态度

禁止事项:
  - 禁止声望无变化
  - 禁止敌对势力NPC友好对待玩家

---

# [AETHERION_ENGINE_V7 - OPTIMIZATION NOTES]

## 本次优化内容摘要

### 1. 魔物生态扩展 (4种 → 10种)
- 新增: 守序者(E=0.5)、蚀骨者(E=1.5)、熵核(E=3.0)、虚空织者(E=4.0)、铁冠造物、雾晶使徒
- 每种魔物都有完整的标签、机制、生成区域、行为模式、弱点和掉落
- 填补了E值空白区域，形成完整的魔物生态梯度

### 2. 数值平衡修正
- 魔晶第4枚R值: 40 → 30（更合理的高风险高回报曲线）
- 统一暴露度计算公式，明确秩序区豁免规则
- 装备系统引入I值/R值修正，提供成长维度

### 3. 新增天气系统
- 5种天气类型: 晴朗、暴雨、以太风暴、黑雾、魔潮前兆
- 每种天气有E值修正、持续时间和特殊效果
- 天气与魔物生成联动，增强环境动态性

### 4. 新增派系关系系统
- 声望范围-100至+100，5个等级
- 声望影响NPC态度、价格、任务获取
- 跨势力关系影响，增加策略深度

### 5. 新增装备品质系统
- 6个品质等级: 劣质、普通、精良、稀有、史诗、传说
- 装备提供I值/R值修正和特殊属性
- 耐久系统增加资源管理维度

### 6. 规则补完
- 魔物掉落详细表
- 观察者日志增加天气字段
- YAML状态栏增加装备和清晰度字段
- 多处规则逻辑漏洞修复

---

**版本**: AETHERION_ENGINE_V7  
**优化日期**: 裂隙纪元301年  
**核心公式**: ΔEntropy = (I × E) - R  
**设计原则**: 硬核、透明、无救赎但允许抗争

    </div>

    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script>
        if (typeof particlesJS !== 'undefined') {
            particlesJS('particles', {
                particles: { number: { value: 50, density: { enable: true, value_area: 800 } }, color: { value: '#6a4cff' }, shape: { type: 'circle' }, opacity: { value: .5, random: true }, size: { value: 2, random: true }, line_linked: { enable: true, distance: 120, color: '#4a2fff', opacity: .15, width: 1 }, move: { enable: true, speed: .5 } },
                interactivity: { detect_on: 'canvas', events: { onhover: { enable: true, mode: 'grab' } }, modes: { grab: { distance: 100, line_linked: { opacity: .3 } } } }
            });
        }

        const App = {
            els: {},
            init() {
                this.cacheEls();
                this.bindEvents();
                this.loadRules();
                this.calcAll();
                this.bindScroll();
            },
            cacheEls() {
                const ids = ['actionI', 'envE', 'exposure', 'negR', 'entropyRes', 'currentLoad', 'roundDelta', 'bucketType', 'bucketExp', 'bucketRes', 
                    'weightExp', 'weightVal', 'weightState', 'weightRes', 'etherCount', 'mentalState', 'cycleCount', 'etherRes',
                    'microFatigue', 'macroFatigue', 'sleepReset', 'fatigueRes', 'debtDays', 'debtRepay', 'debtStatus', 'debtRes',
                    'causalRange', 'causalVal', 'causalName', 'soulCount', 'noEntropyDays', 'causalEquip', 'causalRes',
                    'sleepType', 'sleepE', 'soulDrain', 'sleepCount', 'sleepWeather', 'sleepRes',
                    'luckCount', 'luckStreak', 'luckEnv', 'luckRes',
                    'ladderRank', 'ladderEnvE', 'ladderActionI', 'ladderRes',
                    'crystalCount', 'crystalMental', 'crystalBody', 'crystalCycle', 'crystalDrain', 'crystalRes',
                    'equipQuality', 'calcWeather', 'weatherType', 'weatherBaseE', 'weatherRes',
                    'factionRep', 'factionRepVal', 'factionSelect', 'factionRes',
                    'ruleDisplay', 'fullPrompt', 'scrollTop'];
                ids.forEach(id => this.els[id] = document.getElementById(id));
            },
            bindEvents() {
                // Entropy calculator
                ['actionI', 'envE', 'exposure', 'equipQuality', 'calcWeather'].forEach(id => {
                    this.els[id]?.addEventListener('change', () => this.calcEntropy());
                });
                this.els.negR?.addEventListener('input', () => this.calcEntropy());

                // Bucket calculator
                ['currentLoad', 'roundDelta', 'bucketType', 'bucketExp'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcBucket());
                });

                // Weight calculator
                ['weightExp', 'weightVal', 'weightState'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcWeight());
                });

                // Ether calculator
                ['etherCount', 'mentalState', 'cycleCount'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcEther());
                });

                // Fatigue calculator
                ['microFatigue', 'macroFatigue', 'sleepReset'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcFatigue());
                });

                // Debt calculator
                ['debtDays', 'debtRepay', 'debtStatus'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcDebt());
                });

                // Causal calculator
                this.els.causalRange?.addEventListener('input', () => this.calcCausal());
                ['soulCount', 'noEntropyDays', 'causalEquip'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcCausal());
                });

                // Sleep calculator
                ['sleepType', 'sleepE', 'soulDrain', 'sleepCount', 'sleepWeather'].forEach(id => {
                    this.els[id]?.addEventListener('change', () => this.calcSleep());
                });

                // Luck calculator
                ['luckCount', 'luckStreak', 'luckEnv'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcLuck());
                });

                // Ladder calculator
                ['ladderRank', 'ladderEnvE', 'ladderActionI'].forEach(id => {
                    this.els[id]?.addEventListener('change', () => this.calcLadder());
                });

                // Crystal calculator
                ['crystalCount', 'crystalMental', 'crystalBody', 'crystalCycle', 'crystalDrain'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcCrystal());
                });

                // Weather calculator
                ['weatherType', 'weatherBaseE'].forEach(id => {
                    this.els[id]?.addEventListener('change', () => this.calcWeather());
                });

                // Faction calculator
                this.els.factionRep?.addEventListener('input', () => this.calcFaction());
                this.els.factionSelect?.addEventListener('change', () => this.calcFaction());
            },
            bindScroll() {
                window.addEventListener('scroll', () => {
                    const scrollTop = this.els.scrollTop;
                    if (scrollTop) {
                        scrollTop.classList.toggle('visible', window.scrollY > 300);
                    }
                });
            },
            scrollToTop() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            },
            switchTab(tabName) {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                event.target.classList.add('active');
                document.getElementById(`tab-${tabName}`).classList.add('active');
            },
            toggleRules() {
                const display = this.els.ruleDisplay;
                if (display) {
                    display.style.display = display.style.display === 'none' ? 'block' : 'none';
                }
            },
            calcAll() {
                this.calcEntropy();
                this.calcBucket();
                this.calcWeight();
                this.calcEther();
                this.calcFatigue();
                this.calcDebt();
                this.calcCausal();
                this.calcSleep();
                this.calcLuck();
                this.calcLadder();
                this.calcCrystal();
                this.calcWeather();
                this.calcFaction();
            },
            applyWeatherEffect() {
                const weatherSelect = this.els.calcWeather;
                const envSelect = this.els.envE;
                if (weatherSelect && envSelect) {
                    const mod = parseFloat(weatherSelect.selectedOptions[0].dataset.mod || 0);
                    // Apply weather effect to entropy calculation
                    this.calcEntropy();
                }
            },
            calcEntropy() {
                let I = parseInt(this.els.actionI?.value) || 5;
                const E = parseFloat(this.els.envE?.value) || 1;
                const exp = parseInt(this.els.exposure?.value) || 0;
                const R = parseInt(this.els.negR?.value) || 0;
                const equipMod = parseInt(this.els.equipQuality?.value) || 0;
                const weatherMod = parseFloat(this.els.calcWeather?.selectedOptions[0]?.dataset.mod || 0);

                // Apply equipment modifier to I
                I = Math.max(1, I + equipMod);

                // Calculate E_final
                let E_final;
                if (E === 0.5) {
                    E_final = 0.5 + (exp * 0.05);
                } else {
                    E_final = E + (exp * 0.1);
                }

                // Apply weather modifier
                E_final += weatherMod;

                const totalDelta = (I * E_final) - R;

                let status = 'result-safe', desc = '负熵建立，秩序恢复';
                if (totalDelta > 0) { status = 'result-warn'; desc = '熵增积累，状态维持'; }
                if (totalDelta >= 10) { status = 'result-danger'; desc = '高熵增，状态跌落风险'; }
                if (totalDelta >= 20) { desc = '极高熵增，可能跌落两阶'; }

                desc += `\n计算: ${I} × ${E_final.toFixed(1)} - ${R} = ${totalDelta.toFixed(1)}`;
                if (equipMod < 0) {
                    desc += `\n(装备修正: I${equipMod})`;
                }
                if (weatherMod > 0) {
                    desc += `\n(天气修正: E+${weatherMod})`;
                }
                if (E === 0.5 && exp > 0) {
                    desc += '\n(庇护所豁免生效)';
                }

                this.updateResult(this.els.entropyRes, `Δ = ${totalDelta.toFixed(1)}`, desc, status);
            },
            calcBucket() {
                const load = parseInt(this.els.currentLoad?.value) || 0;
                const delta = parseInt(this.els.roundDelta?.value) || 0;
                const exp = parseInt(this.els.bucketExp?.value) || 0;
                const type = this.els.bucketType?.value || 'body';
                
                const bodyCapacity = Math.min(10 + exp, 20);
                const mindCapacity = Math.min(10 + exp, 15);
                const capacity = type === 'body' ? bodyCapacity : mindCapacity;

                let newLoad;
                if (delta < 0) {
                    newLoad = Math.max(0, load + delta);
                    const overflow = Math.abs(delta) - load;
                    if (overflow >= 10) {
                        const stateBoost = Math.floor(overflow / 10);
                        this.updateResult(this.els.bucketRes, 
                            `状态提升 +${stateBoost}阶`, 
                            `负熵溢出转化: ${overflow}点 → 提升${stateBoost}阶`, 
                            'result-safe');
                        return;
                    }
                } else {
                    newLoad = load + delta;
                }

                const bodyStateRanges = [
                    { name: '充沛', range: [0, 2] },
                    { name: '正常', range: [3, 4] },
                    { name: '疲劳', range: [5, 6] },
                    { name: '虚弱', range: [7, 8] },
                    { name: '濒死', range: [9, 9] }
                ];
                
                const mindStateRanges = [
                    { name: '清醒', range: [0, 2] },
                    { name: '动摇', range: [3, 5] },
                    { name: '崩溃', range: [6, 7] },
                    { name: '昏乱', range: [8, 8] }
                ];

                const stateRanges = type === 'body' ? bodyStateRanges : mindStateRanges;

                let currentState = '未知';
                for (const s of stateRanges) {
                    if (newLoad >= s.range[0] && newLoad <= s.range[1]) {
                        currentState = s.name;
                        break;
                    }
                }
                
                if (newLoad >= 10) {
                    currentState = '死亡';
                }

                let drops = 0;
                let result = `状态: ${currentState}`;
                let desc = `槽值: ${newLoad}/${capacity}`;
                let status = 'result-safe';

                if (delta >= 20) {
                    drops = Math.min(Math.floor(delta / 10), 2);
                    if (drops > 0) {
                        result = `多重溢出! -${drops}阶`;
                        desc += ` | Δ${delta}≥20，跌落${drops}阶`;
                        status = 'result-danger';
                    }
                } else if (newLoad >= capacity) {
                    const isDying = currentState === '濒死' || currentState === '昏乱';
                    if (isDying) {
                        result = 'DEATH';
                        desc = `${currentState}状态下槽满溢出 → 死亡`;
                    } else {
                        drops = 1;
                        result = `跌落! ${currentState}`;
                        desc += ' | 槽满溢出';
                    }
                    status = 'result-danger';
                } else if (newLoad >= capacity * 0.8) {
                    status = 'result-warn';
                    desc += ' (接近临界)';
                }

                this.updateResult(this.els.bucketRes, result, desc, status);
            },
            calcWeight() {
                const exp = parseInt(this.els.weightExp?.value) || 0;
                const weight = parseFloat(this.els.weightVal?.value) || 0;
                const isWeak = this.els.weightState?.value === 'weak';

                const capacity = 30 + (exp * 5);
                const overload = weight - capacity;
                const pct = (overload / capacity) * 100;

                let result = '正常', desc = `负重: ${weight}/${capacity}kg`, status = 'result-safe';

                if (overload > 0) {
                    const steps = Math.floor(overload / 10);
                    const iMod = steps * 5 + (isWeak ? 3 : 0);

                    if (pct >= 100) {
                        result = '超重100%+ 强制无法行动';
                        desc = `超重${overload.toFixed(1)}kg | I+${iMod} | 熵槽+${Math.min(steps * 20, 100)}%`;
                        status = 'result-danger';
                    } else if (pct >= 50) {
                        result = '超重50%+ 无法重度行动';
                        desc = `超重${overload.toFixed(1)}kg | I+${iMod} | 每轮Δ+5`;
                        status = 'result-danger';
                    } else {
                        result = '超重 行动受限';
                        desc = `超重${overload.toFixed(1)}kg | I+${iMod} | 熵槽+${steps * 20}%`;
                        status = 'result-warn';
                    }
                }

                if (isWeak && overload <= 0) {
                    desc += ' | 虚弱+3I';
                }

                this.updateResult(this.els.weightRes, result, desc, status);
            },
            calcEther() {
                const count = parseInt(this.els.etherCount?.value) || 0;
                const stateIdx = parseInt(this.els.mentalState?.value) || 0;
                const cycleCount = parseInt(this.els.cycleCount?.value) || 0;
                const states = ['清醒', '动摇', '崩溃'];
                const current = states[stateIdx];

                let result, desc, status;
                let effectiveR = 0;

                switch (true) {
                    case count <= 3:
                        effectiveR = 10;
                        result = '安全范围';
                        desc = `第${count}枚: R=${effectiveR}正常生效`;
                        status = 'result-safe';
                        break;
                        
                    case count === 4:
                        let rValue = 30;
                        
                        if (cycleCount >= 5) {
                            rValue = 0;
                            result = '循环阻断 - R=0';
                            desc = '30日内第4枚达到5次，R=0且精神永久锁定[崩溃]边缘';
                            status = 'result-danger';
                        } else if (cycleCount >= 3) {
                            rValue = 15;
                            result = '循环衰减 - R减半';
                            desc = `30日内第4枚达到3次，R=${rValue}`;
                            status = 'result-warn';
                        } else {
                            result = '高风险高回报';
                            desc = `第4枚: R=${rValue}作用于躯体，精神强制跌落一阶`;
                        }
                        
                        if (stateIdx < 2) {
                            const next = states[stateIdx + 1];
                            desc += `\n${current} → ${next}`;
                            if (rValue > 0) {
                                const bodyBoost = Math.floor(rValue / 10);
                                desc += `\n躯体恢复: 每10R提升1阶状态 (+${bodyBoost}阶)`;
                            }
                        } else {
                            desc += '\n⚠ 精神已达崩溃，R将失效!';
                        }
                        
                        status = stateIdx >= 2 ? 'result-danger' : status || 'result-warn';
                        effectiveR = rValue;
                        break;
                        
                    case count === 5:
                        result = '纯惩罚';
                        effectiveR = 0;
                        desc = 'R=0，精神强制跌落，无收益';
                        status = 'result-danger';
                        break;
                        
                    default:
                        result = '剧毒 - 致死风险';
                        effectiveR = 0;
                        const deltaPenalty = (count - 5) * 20;
                        desc = `R=${effectiveR}, ΔEntropy+${deltaPenalty}, 躯体跌落两阶`;
                        
                        if (count >= 6) {
                            desc += '\n⚠ 濒死状态下吞噬 → [剧毒过载] → 直接死亡!';
                        }
                        status = 'result-danger';
                }

                this.updateResult(this.els.etherRes, result, desc, status);
            },
            calcFatigue() {
                const micro = parseInt(this.els.microFatigue?.value) || 0;
                const macro = parseInt(this.els.macroFatigue?.value) || 0;
                const reset = this.els.sleepReset?.value;
                const I_base = parseInt(this.els.actionI?.value) || 5;
                const E_base = parseFloat(this.els.envE?.value) || 1;

                let I_modified = I_base;
                let E_modified = E_base;
                let result = '正常', desc = '无疲劳累积', status = 'result-safe';

                if (reset === 'poor') {
                    result = '微观重置';
                    desc = '劣质睡眠: 仅重置微观计数器,宏观无效';
                    status = 'result-warn';
                } else if (reset === 'quality' || reset === 'long') {
                    result = '完全重置';
                    desc = reset === 'long' 
                        ? '长休: 重置微观+宏观计数器' 
                        : '优质睡眠: 重置微观计数器';
                    status = 'result-safe';
                } else {
                    if (micro >= 3 && I_base >= 15) {
                        I_modified = I_base * 2;
                        result = '微观疲劳';
                        desc = `连续${micro}轮I≥15, I=${I_base}→${I_modified}`;
                        status = 'result-danger';
                        
                        if (micro >= 6) {
                            desc += '\n⚠ 强行维持6轮+,状态上限锁定至长休';
                        }
                    }
                    
                    if (macro >= 3) {
                        E_modified += 0.3;
                        result = (micro >= 3 && I_base >= 15) ? '双重疲劳' : '宏观疲劳';
                        desc += `\n连续${macro}轮未长休, E=${(E_modified - 0.3).toFixed(1)}→${E_modified.toFixed(1)}`;
                        status = 'result-danger';
                    }
                    
                    if (micro >= 3 || macro >= 3) {
                        const delta = I_modified * E_modified;
                        desc += `\n实际ΔEntropy: ${delta.toFixed(1)} (I=${I_modified}, E=${E_modified.toFixed(1)})`;
                    }
                }

                this.updateResult(this.els.fatigueRes, result, desc, status);
            },
            calcDebt() {
                const days = parseInt(this.els.debtDays?.value) || 0;
                const repay = parseInt(this.els.debtRepay?.value) || 0;
                const status = this.els.debtStatus?.value;

                let result, desc, cls;

                if (days === 0) {
                    result = '无负债';
                    desc = '未持有因果负债';
                    cls = 'result-safe';
                } else {
                    const daysLeft = 30 - days;
                    if (daysLeft <= 0) {
                        result = '因果反噬';
                        desc = '30日未偿还，每日状态各跌一阶';
                        cls = 'result-danger';
                    } else if (daysLeft <= 5) {
                        result = `临界 (${daysLeft}天)`;
                        desc = `即将触发反噬 | 已偿还${repay}次 (≥5R值/次重置)`;
                        cls = 'result-danger';
                    } else {
                        result = `负债中 (${daysLeft}天)`;
                        desc = `有效偿还: 治疗他人/NPC、净化公共区域 | 已偿还${repay}次`;
                        cls = 'result-warn';
                    }
                }

                this.updateResult(this.els.debtRes, result, desc, cls);
            },
            calcCausal() {
                const base = parseInt(this.els.causalRange?.value) || 0;
                const souls = parseInt(this.els.soulCount?.value) || 0;
                const days = parseInt(this.els.noEntropyDays?.value) || 0;
                const equipBonus = parseInt(this.els.causalEquip?.value) || 0;

                const totalBase = base + equipBonus;
                
                if (this.els.causalVal) this.els.causalVal.textContent = totalBase;

                const levels = [
                    { n: '几乎没有', l: 5 },
                    { n: '偏低', l: 20 },
                    { n: '低', l: 40 },
                    { n: '偏中', l: 60 },
                    { n: '中', l: 80 },
                    { n: '偏高', l: 95 },
                    { n: '高', l: 100 }
                ];
                const level = levels.find(l => totalBase <= l.l) || levels[6];
                if (this.els.causalName) this.els.causalName.textContent = level.n;

                const dropLevels = Math.floor(days / 3);
                let finalLevel = Math.max(0, levels.indexOf(level) - dropLevels);

                const descriptions = [
                    '因果蒸发。无物理反馈，行为不计入因果账本。',
                    '微弱采样。极偶尔产生被注视的物理直觉。',
                    '特征提取。环境产生微妙的秩序感。',
                    '因果锚定。异象初现，无常判定产生聚簇。',
                    '现实收敛。感官扭曲，区域临界值加速累积。',
                    '法则锁定。凡人避让，高阶魔物精准锁定。',
                    '因果奇点。绝对干预权激活，伴随逻辑回弹风险。'
                ];

                let desc = descriptions[finalLevel];
                if (souls > 0) desc += `\n持有${souls}枚灵魂刻，暴露度+${souls * 5}。`;
                if (equipBonus > 0) desc += `\n装备加成: +${equipBonus}。`;
                if (dropLevels > 0) desc += `\n⚠ 熵增淡化：${days}日无负熵，跌落${dropLevels}级。`;

                const status = finalLevel >= 5 ? 'result-danger' : (finalLevel >= 3 ? 'result-warn' : 'result-safe');
                this.updateResult(this.els.causalRes, levels[finalLevel].n, desc, status);
            },
            calcSleep() {
                const isQuality = this.els.sleepType?.value === 'quality';
                const E = parseFloat(this.els.sleepE?.value) || 1;
                const hasDrain = this.els.soulDrain?.value === 'yes';
                const count = parseInt(this.els.sleepCount?.value) || 1;
                const weather = this.els.sleepWeather?.value || 'normal';
                const currentLoad = parseInt(this.els.currentLoad?.value) || 0;

                let R, result, desc, status;

                if (weather === 'marea') {
                    result = '无法优质睡眠';
                    desc = '魔潮前兆天气期间，强制劣质睡眠\nR=3~5，仅重置微观疲劳';
                    status = 'result-danger';
                    this.updateResult(this.els.sleepRes, result, desc, status);
                    return;
                }

                if (E > 0.5) {
                    R = 3 + Math.floor(Math.random() * 3);
                    result = `劣质睡眠 R=${R}`;
                    desc = `消除${R}点损耗，仅重置微观疲劳\n同日第二次无效，清醒<4小时强制劣质`;
                    status = 'result-warn';
                } else if (hasDrain) {
                    R = 8 + Math.floor(Math.random() * 3);
                    result = `R = ${R}`;
                    desc = '[灵魂耗竭]锁定：R降至8~10，仅清空槽值，状态阶级保持不变';
                    status = 'result-warn';
                } else {
                    if (count === 1) {
                        R = 15 + Math.floor(Math.random() * 6);
                    } else {
                        R = 8 + Math.floor(Math.random() * 3);
                    }
                    result = `优质睡眠 R = ${R}`;
                    
                    const canImprove = currentLoad > 0;
                    const stateImprovement = canImprove ? '提升1阶状态' : '状态已达最优';
                    desc = `清空槽值，${stateImprovement}${count === 2 ? ' (效果减半)' : ''}`;
                    
                    if (R > currentLoad + 10) {
                        const overflow = R - (currentLoad + 10);
                        desc += `\n溢出${overflow}点R值直接消散`;
                    }
                    
                    status = 'result-safe';
                }

                desc += '\n限制: 24h内仅1次优质有效，清醒<4h强制劣质';

                this.updateResult(this.els.sleepRes, result, desc, status);
            },
            calcLuck() {
                const count = parseInt(this.els.luckCount?.value) || 0;
                const streak = parseInt(this.els.luckStreak?.value) || 0;
                const env = this.els.luckEnv?.value || 'safe';

                const remaining = Math.max(0, 5 - count);
                const isSoftLocked = env === 'hazard';
                const critAccum = streak > 3 ? streak - 3 : 0;

                let result, desc, status;

                if (isSoftLocked) {
                    result = '软锁触发';
                    desc = '乱序区/积淤者存在时: 好运无法触发\n环境极度不稳定，无法抽取确定性';
                    status = 'result-danger';
                } else if (count >= 5) {
                    result = '达到上限';
                    desc = '单日5次上限，超限无效\n每日黎明06:00重置计数器';
                    status = 'result-warn';
                } else {
                    result = remaining > 0 ? `可触发 ${remaining}次` : '次数用尽';
                    desc = `今日已触发: ${count}/5次`;
                    if (critAccum > 0) {
                        desc += `\n⚠ 连续好运${streak}次: 临界值累积+${critAccum}`;
                        desc += '\n副作用: 周围人遭遇[概率补偿]倒霉';
                        status = 'result-warn';
                    } else {
                        status = 'result-safe';
                    }
                }

                this.updateResult(this.els.luckRes, result, desc, status);
            },
            calcLadder() {
                const exp = parseInt(this.els.ladderRank?.value) || 0;
                const E = parseFloat(this.els.ladderEnvE?.value) || 1;
                const I = parseInt(this.els.ladderActionI?.value) || 5;

                const E_final = E + (exp * 0.1);
                const delta = I * E_final;

                const rankNames = { 0: '无名之辈', 1: '榜上有名', 3: '天梯前百', 6: '天梯前十' };
                const rankName = rankNames[exp] || '未知';

                let result = `Δ = ${delta.toFixed(1)}`;
                let desc, status;

                const expPenalty = I * exp * 0.1;
                if (exp === 0) {
                    desc = `${rankName}: 基础熵增 = ${I * E}`;
                    status = 'result-safe';
                } else if (exp <= 3) {
                    desc = `${rankName}: E_final=${E_final.toFixed(2)}, 暴露惩罚+${expPenalty.toFixed(1)}熵增`;
                    status = delta > 20 ? 'result-danger' : 'result-warn';
                } else {
                    desc = `${rankName}: 行走的临界值磁铁! E_final=${E_final.toFixed(2)}\n暴露惩罚+${expPenalty.toFixed(1)}, 魔潮强度×${(1 + exp * 0.15).toFixed(2)}`;
                    status = delta >= 20 ? 'result-danger' : (delta >= 10 ? 'result-warn' : 'result-safe');
                }

                if (delta >= 20) {
                    desc += '\n⚠ 高熵增警告: 可能跌落两阶!';
                }

                this.updateResult(this.els.ladderRes, result, desc, status);
            },
            calcCrystal() {
                const count = parseInt(this.els.crystalCount?.value) || 0;
                const mentalIdx = parseInt(this.els.crystalMental?.value) || 0;
                const bodyIdx = parseInt(this.els.crystalBody?.value) || 2;
                const cycleCount = parseInt(this.els.crystalCycle?.value) || 0;
                const hasDrain = this.els.crystalDrain?.value === 'yes';

                const mentalStates = ['清醒', '动摇', '崩溃', '昏乱'];
                const bodyStates = ['充沛', '正常', '疲劳', '虚弱', '濒死'];
                const currentMental = mentalStates[mentalIdx];
                const currentBody = bodyStates[bodyIdx];

                let result, desc, status;

                if (mentalIdx >= 3) {
                    result = '无法吞噬';
                    desc = '昏乱状态下无法行动，更无法吞噬魔晶';
                    status = 'result-danger';
                } else if (count <= 3) {
                    const rValue = hasDrain && count === 3 ? '8-10' : '10';
                    result = `安全第${count + 1}枚`;
                    desc = `第${count + 1}枚魔晶: R=${rValue}正常生效`;
                    desc += `\n当前精神: ${currentMental} | 躯体: ${currentBody}`;
                    status = 'result-safe';
                } else if (count === 4) {
                    let rValue = hasDrain ? '8-10' : '30';
                    
                    if (cycleCount >= 5) {
                        rValue = '0';
                        result = '循环阻断!';
                        desc = '30日内第4枚达到5次，R=0且精神永久锁定[崩溃]边缘';
                    } else if (cycleCount >= 3) {
                        rValue = hasDrain ? '4-5' : '15';
                        result = '循环衰减';
                        desc = `30日内第4枚达到3次，R=${rValue}`;
                    } else {
                        result = '高风险高回报';
                        desc = `第4枚: 精神强制跌落一阶`;
                    }
                    
                    const nextMental = mentalStates[Math.min(mentalIdx + 1, 3)];
                    desc += `\n${currentMental} → ${nextMental}`;
                    
                    if (!hasDrain && cycleCount < 5) {
                        const bodyBoost = Math.floor(30 / 10);
                        desc += `\n躯体恢复: 每10R提升1阶 (+${bodyBoost}阶)`;
                    }
                    
                    status = mentalIdx >= 2 || cycleCount >= 5 ? 'result-danger' : 'result-warn';
                } else if (count === 5) {
                    const nextMental = mentalStates[Math.min(mentalIdx + 1, 3)];
                    result = '纯惩罚';
                    desc = `第5枚: R=0，精神强制跌落`;
                    desc += `\n${currentMental} → ${nextMental}`;
                    desc += '\n⚠ 无任何收益，纯惩罚!';
                    status = 'result-danger';
                } else {
                    const bodyDrop = Math.min(2, bodyIdx + 2);
                    const finalBody = bodyStates[Math.min(bodyIdx + 2, 4)];
                    result = '致命毒性';
                    desc = `第${count}枚: R=0, Δ+20`;
                    desc += `\n躯体强制跌落两阶: ${currentBody} → ${finalBody}`;
                    if (bodyIdx >= 3) {
                        desc += '\n⚠ 濒死状态下槽满溢出 → 死亡!';
                    }
                    status = 'result-danger';
                }

                this.updateResult(this.els.crystalRes, result, desc, status);
            },
            calcWeather() {
                const baseE = parseFloat(this.els.weatherBaseE?.value) || 1;
                const weatherMod = parseFloat(this.els.weatherType?.value) || 0;
                const weatherName = this.els.weatherType?.selectedOptions[0]?.dataset.name || '晴朗';

                const finalE = baseE + weatherMod;

                let desc = `${weatherName}天气: `;
                switch (weatherName) {
                    case '晴朗':
                        desc += '无额外效果';
                        break;
                    case '暴雨':
                        desc += '视野-50%，火焰-30%，积淤者活跃度+50%';
                        break;
                    case '以太风暴':
                        desc += '施法I+5，精神槽+20%，晶化律法生成+30%';
                        break;
                    case '黑雾':
                        desc += '视野-70%，蚀骨者生成+50%，秩序区效果-30%';
                        break;
                    case '魔潮前兆':
                        desc += '魔物生成+100%，高阶魔物出现，无法优质睡眠';
                        break;
                }

                const status = weatherMod >= 1.0 ? 'result-danger' : (weatherMod > 0 ? 'result-warn' : 'result-safe');
                this.updateResult(this.els.weatherRes, `E_final = ${finalE.toFixed(1)}`, desc, status);
            },
            calcFaction() {
                const rep = parseInt(this.els.factionRep?.value) || 0;
                const faction = this.els.factionSelect?.value || 'iron';

                if (this.els.factionRepVal) {
                    this.els.factionRepVal.textContent = rep;
                }

                const factionNames = {
                    iron: '铁冠王国',
                    mist: '雾谷帝国',
                    silver: '银湾联盟',
                    shadow: '灰影议会'
                };

                let result, desc, status;

                if (rep <= -50) {
                    result = '敌对';
                    desc = `${factionNames[faction]}视你为敌人\nNPC会攻击或拒绝服务，进入领土被攻击`;
                    status = 'result-danger';
                } else if (rep < 0) {
                    result = '冷淡';
                    desc = `${factionNames[faction]}对你态度冷漠\n价格+50%`;
                    status = 'result-warn';
                } else if (rep < 30) {
                    result = '中立';
                    desc = `${factionNames[faction]}对你保持中立\n正常交易`;
                    status = 'result-safe';
                } else if (rep < 70) {
                    result = '友好';
                    desc = `${factionNames[faction]}对你态度友好\n价格-20%，提供额外信息`;
                    status = 'result-safe';
                } else {
                    result = '崇敬';
                    desc = `${factionNames[faction]}对你充满敬意\n特殊任务，势力装备折扣`;
                    status = 'result-legendary';
                }

                this.updateResult(this.els.factionRes, result, desc, status);
            },
            updateResult(el, val, desc, cls) {
                if (!el) return;
                el.className = `result ${cls}`;
                el.innerHTML = `<div class="val">${val}</div><div class="desc">${desc.replace(/\n/g, '<br>')}</div>`;
            },
            loadRules() {
                const full = document.getElementById('fullPrompt')?.textContent || '';
                if (this.els.ruleDisplay) this.els.ruleDisplay.textContent = full.trim();
            },
            copy() {
                const text = document.getElementById('fullPrompt')?.textContent || '';
                if (!text) return;

                if (navigator.clipboard?.writeText) {
                    navigator.clipboard.writeText(text).then(() => this.showCopyOk());
                } else {
                    const ta = document.createElement('textarea');
                    ta.value = text;
                    ta.style.cssText = 'position:fixed;opacity:0';
                    document.body.appendChild(ta);
                    ta.select();
                    document.execCommand('copy');
                    document.body.removeChild(ta);
                    this.showCopyOk();
                }
            },
            showCopyOk() {
                const btn = document.querySelector('button[onclick="App.copy()"]');
                if (!btn) return;
                const orig = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> 已复制';
                btn.style.background = 'var(--safe)';
                btn.style.color = '#000';
                setTimeout(() => { btn.innerHTML = orig; btn.style.background = ''; btn.style.color = ''; }, 1500);
            },
            download() {
                const text = document.getElementById('fullPrompt')?.textContent || '';
                if (!text) return;

                const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'Aetherion_核心法则协议_V7.md';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        };

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
   
</body>

</html>
