<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aetherion Architect</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --glow: #6a4cff;
            --bg: #0a0a12;
            --text: #e0e0ff;
            --glass: rgba(20, 20, 35, .75);
            --safe: #00e676;
            --warn: #ffea00;
            --danger: #ff1744
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: radial-gradient(circle at 20% 30%, rgba(40, 10, 60, .15)0%, transparent 40%), radial-gradient(circle at 80% 70%, rgba(10, 30, 60, .1)0%, transparent 40%)
        }

        #particles {
            position: fixed;
            inset: 0;
            z-index: 0;
            opacity: .6;
            pointer-events: none
        }

        .container {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px
        }

        header {
            padding: 4rem 0 2rem;
            text-align: center
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 900;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: .1em;
            text-shadow: 0 0 20px rgba(106, 76, 255, .6)
        }

        .subtitle {
            color: #b0b0ff;
            font-size: 1rem;
            letter-spacing: .15em;
            margin-top: .5rem
        }

        .quote {
            max-width: 700px;
            margin: 1.5rem auto;
            padding: 1rem;
            border-left: 3px solid var(--glow);
            background: linear-gradient(90deg, rgba(106, 76, 255, .1), transparent);
            font-style: italic;
            color: #aaa
        }

        .card {
            background: var(--glass);
            border: 1px solid rgba(106, 76, 255, .3);
            border-radius: 8px;
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            transition: .3s
        }

        .card:hover {
            border-color: var(--glow);
            box-shadow: 0 0 20px rgba(106, 76, 255, .2)
        }

        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem
        }

        .grid {
            display: grid;
            gap: 1.5rem;
            margin: 2rem 0
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr))
        }

        @media(min-width:768px) {
            .grid-2 {
                grid-template-columns: repeat(2, 1fr)
            }
        }

        label {
            display: block;
            color: #8888aa;
            font-size: .75rem;
            text-transform: uppercase;
            margin-bottom: .3rem;
            letter-spacing: 1px
        }

        input,
        select {
            width: 100%;
            background: rgba(0, 0, 0, .4);
            border: 1px solid #444;
            color: #fff;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Share Tech Mono';
            margin-bottom: 1rem;
            outline: none
        }

        input:focus,
        select:focus {
            border-color: var(--glow);
            box-shadow: 0 0 10px rgba(106, 76, 255, .3)
        }

        .result {
            background: rgba(0, 0, 0, .6);
            border-left: 4px solid #555;
            padding: 1rem;
            margin-top: 1rem
        }

        .result-safe {
            border-left-color: var(--safe)
        }

        .result-safe .val {
            color: var(--safe)
        }

        .result-warn {
            border-left-color: var(--warn)
        }

        .result-warn .val {
            color: var(--warn)
        }

        .result-danger {
            border-left-color: var(--danger);
            box-shadow: 0 0 15px rgba(255, 23, 68, .2)
        }

        .result-danger .val {
            color: var(--danger)
        }

        .val {
            font-size: 1.5rem;
            font-weight: bold;
            font-family: 'Orbitron'
        }

        .desc {
            font-size: .8rem;
            color: #aaa;
            margin-top: .3rem
        }

        .terminal {
            background: rgba(10, 8, 15, .95);
            border: 1px solid #333;
            border-radius: 4px;
            padding: 1rem;
            height: 250px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: .85rem;
            color: #a0a0ff;
            scrollbar-width: thin;
            scrollbar-color: var(--glow)#1a1a1a
        }

        .terminal::-webkit-scrollbar {
            width: 6px
        }

        .terminal::-webkit-scrollbar-track {
            background: #1a1a1a
        }

        .terminal::-webkit-scrollbar-thumb {
            background: var(--glow);
            border-radius: 3px
        }

        .btn {
            background: transparent;
            border: 1px solid var(--glow);
            color: var(--glow);
            padding: 8px 16px;
            font-family: 'Share Tech Mono';
            cursor: pointer;
            transition: .3s;
            text-transform: uppercase;
            font-size: .85rem;
            display: inline-flex;
            align-items: center;
            gap: 8px
        }

        .btn:hover {
            background: var(--glow);
            color: #fff;
            box-shadow: 0 0 15px var(--glow)
        }

        .flowchart {
            background: rgba(0, 0, 0, .3);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto
        }

        footer {
            text-align: center;
            padding: 3rem 0;
            color: #666;
            font-size: .9rem
        }

        input[type=range] {
            -webkit-appearance: none;
            background: transparent
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: var(--glow);
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 0 10px var(--glow)
        }

        input[type=range]::-webkit-slider-runnable-track {
            height: 4px;
            background: #444;
            border-radius: 2px
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: .85rem
        }

        th,
        td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #333
        }

        th {
            color: var(--glow);
            font-weight: normal;
            text-transform: uppercase;
            font-size: .75rem
        }

        .flow-container {
            display: flex;
            flex-direction: column;
            gap: 0
        }

        .flow-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            margin: 2px 0;
            background: rgba(0, 0, 0, .3);
            border-radius: 6px;
            border-left: 3px solid #555;
            transition: .2s
        }

        .flow-row:hover {
            background: rgba(106, 76, 255, .1);
            border-left-color: var(--glow)
        }

        .flow-arrow {
            text-align: center;
            color: #666;
            font-size: 1.2rem;
            padding: 4px 0
        }

        .flow-input {
            border-left-color: #6a4cff;
            background: rgba(106, 76, 255, .1)
        }

        .flow-calc {
            border-left-color: #ffea00;
            background: rgba(255, 234, 0, .05)
        }

        .flow-branch {
            border-left-color: #ff9800;
            background: rgba(255, 152, 0, .05)
        }

        .flow-danger {
            border-left-color: #ff1744;
            background: rgba(255, 23, 68, .1)
        }

        .flow-safe {
            border-left-color: #00e676;
            background: rgba(0, 230, 118, .1)
        }

        .flow-label {
            font-family: 'Orbitron', sans-serif;
            font-size: .9rem;
            color: #fff;
            min-width: 100px
        }

        .flow-desc {
            color: #aaa;
            font-size: .85rem;
            flex: 1
        }

        .flow-val {
            font-family: 'Share Tech Mono';
            color: var(--glow);
            font-size: .9rem
        }

        @media(max-width:768px) {
            .flow-row {
                flex-wrap: wrap;
                gap: 6px
            }

            .flow-label {
                width: 100%;
                min-width: auto
            }
        }
    </style>
</head>

<body>
    <div id="particles"></div>
    <div class="container">
        <header>
            <h1>AETHERION</h1>
            <div class="subtitle">裂隙纪元 301 · 熵增物理引擎</div>
            <div class="quote">"欢迎来到没有救赎但允许抗争的世界。死亡是计算结果，非剧情杀"</div>
        </header>

        <!-- 核心法则 -->
        <div class="card" style="margin:3rem 0">
            <div
                style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;border-bottom:1px solid rgba(106,76,255,.3);padding-bottom:1rem">
                <h2 class="section-title" style="margin:0"><i class="fas fa-scroll"></i> 核心法则协议</h2>
                <div style="display:flex;gap:10px">
                    <button class="btn" onclick="App.copy()"><i class="fas fa-copy"></i> 复制</button>
                    <button class="btn" onclick="App.download()"><i class="fas fa-download"></i> 下载</button>
                </div>
            </div>
            <div class="terminal" id="ruleDisplay">正在加载法则...</div>
        </div>

        <!-- 物理引擎控制台 -->
        <h2 class="section-title justify-center"><i class="fas fa-microchip"></i> 物理引擎控制台</h2>
        <div class="grid grid-2">
            <!-- 熵增计算器 -->
            <div class="card">
                <div class="section-title" style="font-size:1.1rem"><i class="fas fa-calculator"></i> 熵增万能公式</div>
                <label>行动强度 (I)</label>
                <select id="actionI">
                    <option value="1">静滞 (1) - 睡觉、冥想、进食</option>
                    <option value="5" selected>轻度 (5) - 走路、采集、交谈</option>
                    <option value="15">重度 (15) - 战斗、挖掘、急行军</option>
                    <option value="30">过载 (30) - 濒死爆发、禁忌施法</option>
                </select>
                <label>环境乘区 (E)</label>
                <select id="envE">
                    <option value="0.5">秩序区 (0.5) - 庇护所</option>
                    <option value="1.0" selected>荒野 (1.0) - 标准环境</option>
                    <option value="2.0">高熵区 (2.0) - 暴雨、毒气</option>
                    <option value="5.0">死寂区 (5.0) - 魔潮中心</option>
                </select>
                <label>天梯暴露度</label>
                <select id="exposure">
                    <option value="0" selected>无名之辈 (暴露度+0)</option>
                    <option value="1">榜上有名 (暴露度+1)</option>
                    <option value="3">天梯前百 (暴露度+3)</option>
                    <option value="6">天梯前十 (暴露度+6)</option>
                </select>
                <label>负熵努力 (R)</label>
                <input type="number" id="negR" value="0" min="0" max="50">
                <div class="result" id="entropyRes">
                    <div class="val">Δ = 5.0</div>
                    <div class="desc">熵增积累，状态维持</div>
                </div>
            </div>

            <!-- 状态桶计算 -->
            <div class="card">
                <div class="section-title" style="font-size:1.1rem"><i class="fas fa-battery-half"></i> 状态桶机制</div>
                <label>当前槽值 (0-20)</label>
                <input type="number" id="currentLoad" value="0" min="0" max="20">
                <label>本轮熵增 (Δ)</label>
                <input type="number" id="roundDelta" value="5" min="0">
                <label>天梯暴露度 (容量加成)</label>
                <select id="bucketExp">
                    <option value="0" selected>暴露度+0 (容量10)</option>
                    <option value="1">暴露度+1 (容量11)</option>
                    <option value="3">暴露度+3 (容量13)</option>
                    <option value="6">暴露度+6 (容量16)</option>
                </select>
                <div class="result" id="bucketRes">
                    <div class="val">状态: 充沛</div>
                    <div class="desc">槽值: 0/10</div>
                </div>
            </div>

            <!-- 负重计算 -->
            <div class="card">
                <div class="section-title" style="font-size:1.1rem"><i class="fas fa-weight-hanging"></i> 负重系统</div>
                <label>天梯暴露度</label>
                <select id="weightExp">
                    <option value="0" selected>暴露度+0 (容量30kg)</option>
                    <option value="1">暴露度+1 (容量35kg)</option>
                    <option value="3">暴露度+3 (容量45kg)</option>
                    <option value="6">暴露度+6 (容量60kg)</option>
                </select>
                <label>当前负重 (kg)</label>
                <input type="number" id="weightVal" value="25" min="0">
                <label>躯体状态</label>
                <select id="weightState">
                    <option value="normal" selected>正常/疲劳</option>
                    <option value="weak">虚弱/濒死 (+3I)</option>
                </select>
                <div class="result" id="weightRes">
                    <div class="val">正常</div>
                    <div class="desc">负重: 25/30kg</div>
                </div>
            </div>

            <!-- 以太中毒 -->
            <div class="card">
                <div class="section-title" style="font-size:1.1rem"><i class="fas fa-skull"></i> 以太中毒</div>
                <label>今日吞噬魔晶数</label>
                <input type="number" id="etherCount" value="0" min="0" max="10">
                <label>当前精神状态</label>
                <select id="mentalState">
                    <option value="0" selected>清醒</option>
                    <option value="1">动摇</option>
                    <option value="2">崩溃</option>
                </select>
                <div class="result" id="etherRes">
                    <div class="val">安全范围</div>
                    <div class="desc">R值正常生效</div>
                </div>
            </div>

            <!-- 疲劳计数器 -->
            <div class="card">
                <div class="section-title" style="font-size:1.1rem"><i class="fas fa-clock"></i> 疲劳计数器</div>
                <label>微观疲劳 (连续I≥15回合)</label>
                <input type="number" id="microFatigue" value="0" min="0" max="10">
                <label>宏观疲劳 (未长休回合)</label>
                <input type="number" id="macroFatigue" value="0" min="0" max="10">
                <label>睡眠类型</label>
                <select id="sleepReset">
                    <option value="none" selected>无睡眠</option>
                    <option value="poor">劣质睡眠</option>
                    <option value="quality">优质睡眠</option>
                    <option value="long">长休</option>
                </select>
                <div class="result" id="fatigueRes">
                    <div class="val">正常</div>
                    <div class="desc">无疲劳累积</div>
                </div>
            </div>

            <!-- 因果负债追踪器 -->
            <div class="card">
                <div class="section-title" style="font-size:1.1rem"><i class="fas fa-balance-scale"></i> 因果负债追踪器</div>
                <label>负债天数</label>
                <input type="number" id="debtDays" value="0" min="0" max="30">
                <label>偿还记录 (≥5R值/次)</label>
                <input type="number" id="debtRepay" value="0" min="0">
                <label>当前状态</label>
                <select id="debtStatus">
                    <option value="safe" selected>正常</option>
                    <option value="warning">负债中</option>
                    <option value="critical">即将触发反噬</option>
                </select>
                <div class="result" id="debtRes">
                    <div class="val">无负债</div>
                    <div class="desc">未持有因果负债</div>
                </div>
            </div>

            <!-- 因果清晰度 -->
            <div class="card">
                <div class="section-title" style="font-size:1.1rem"><i class="fas fa-eye"></i> 因果清晰度</div>
                <label>基础等级 (0-100)</label>
                <input type="range" id="causalRange" min="0" max="100" value="0">
                <div style="text-align:center;margin:-.5rem 0 1rem;font-size:.85rem;color:#888">当前: <span
                        id="causalVal">0</span> - <span id="causalName">几乎没有</span></div>
                <label>持有灵魂刻</label>
                <input type="number" id="soulCount" value="0" min="0">
                <label>无负熵产出天数</label>
                <input type="number" id="noEntropyDays" value="0" min="0">
                <div class="result" id="causalRes">
                    <div class="val">几乎没有</div>
                    <div class="desc">因果蒸发。无物理反馈。</div>
                </div>
            </div>

            <!-- 优质睡眠 -->
            <div class="card">
                <div class="section-title" style="font-size:1.1rem"><i class="fas fa-bed"></i> 睡眠恢复</div>
                <label>睡眠类型</label>
                <select id="sleepType">
                    <option value="quality" selected>优质睡眠 (E≤0.5)</option>
                    <option value="poor">劣质睡眠 (E>0.5)</option>
                </select>
                <label>环境乘区 (E)</label>
                <select id="sleepE">
                    <option value="0.5">0.5 - 秩序区</option>
                    <option value="1.0" selected>1.0 - 荒野</option>
                    <option value="2.0">2.0 - 高熵区</option>
                </select>
                <label>是否持有[灵魂耗竭]</label>
                <select id="soulDrain">
                    <option value="no" selected>否</option>
                    <option value="yes">是 (R降至20，不提升状态)</option>
                </select>
                <label>今日第几次睡眠</label>
                <select id="sleepCount">
                    <option value="1" selected>第1次 (R=50)</option>
                    <option value="2">第2次 (R=25)</option>
                </select>
                <div class="result" id="sleepRes">
                    <div class="val">R = 50</div>
                    <div class="desc">优质睡眠: 清空槽值，恢复状态</div>
                </div>
            </div>

            <!-- 好运守恒计算器 -->
            <div class="card">
                <div class="section-title" style="font-size:1.1rem"><i class="fas fa-clover"></i> 好运守恒计算器</div>
                <label>今日好运触发次数 (0-5)</label>
                <input type="number" id="luckCount" value="0" min="0" max="5">
                <label>连续好运次数 (超过3次后临界值累积)</label>
                <input type="number" id="luckStreak" value="0" min="0">
                <label>当前环境</label>
                <select id="luckEnv">
                    <option value="safe" selected>正常/秩序区</option>
                    <option value="hazard">高熵区/积淮 (好运软锁)</option>
                </select>
                <div class="result" id="luckRes">
                    <div class="val">可触发</div>
                    <div class="desc">今日剩余: 5次 | 无临界值累积</div>
                </div>
            </div>

            <!-- 天梯暴露度模拟器 -->
            <div class="card">
                <div class="section-title" style="font-size:1.1rem"><i class="fas fa-ranking-star"></i> 天梯暴露度模拟器</div>
                <label>天梯排名</label>
                <select id="ladderRank">
                    <option value="0" selected>无名之辈 (暴露度+0)</option>
                    <option value="1">榜上有名 (暴露度+1)</option>
                    <option value="3">天梯前百 (暴露度+3)</option>
                    <option value="6">天梯前十 (暴露度+6)</option>
                </select>
                <label>基础环境E值</label>
                <select id="ladderEnvE">
                    <option value="0.5">秩序区 E=0.5</option>
                    <option value="1.0" selected>荒野 E=1.0</option>
                    <option value="2.0">高熵区 E=2.0</option>
                    <option value="5.0">死寂区 E=5.0</option>
                </select>
                <label>行动强度I值</label>
                <select id="ladderActionI">
                    <option value="1">静滞 I=1</option>
                    <option value="5" selected>轻度 I=5</option>
                    <option value="15">重度 I=15</option>
                    <option value="30">过载 I=30</option>
                </select>
                <div class="result" id="ladderRes">
                    <div class="val">Δ = 5.0</div>
                    <div class="desc">无名之辈荒野行动: 基础熵增</div>
                </div>
            </div>

            <!-- 魔晶吞噬收益/风险评估器 -->
            <div class="card">
                <div class="section-title" style="font-size:1.1rem"><i class="fas fa-gem"></i> 魔晶吞噬评估器</div>
                <label>今日已吞噬数量</label>
                <input type="number" id="crystalCount" value="0" min="0" max="10">
                <label>当前精神状态</label>
                <select id="crystalMental">
                    <option value="0" selected>清醒</option>
                    <option value="1">动摇</option>
                    <option value="2">崩溃</option>
                    <option value="3">昏乱 (无法吞噬)</option>
                </select>
                <label>当前躯体状态</label>
                <select id="crystalBody">
                    <option value="0">充沛</option>
                    <option value="1">正常</option>
                    <option value="2" selected>疲劳</option>
                    <option value="3">虚弱</option>
                    <option value="4">濒死</option>
                </select>
                <label>是否持有[灵魂耗竭]</label>
                <select id="crystalDrain">
                    <option value="no" selected>否</option>
                    <option value="yes">是 (第4枚R值降至8-10)</option>
                </select>
                <div class="result" id="crystalRes">
                    <div class="val">安全范围</div>
                    <div class="desc">第1-3枚: R正常生效 | 建议第3枚后停止</div>
                </div>
            </div>
        </div>

        <!-- 状态流程图 -->
        <div class="card" style="margin:2rem 0">
            <h2 class="section-title"><i class="fas fa-project-diagram"></i> 状态桶机制流程</h2>
            <div class="flow-container">
                <div class="flow-row flow-input">
                    <span class="flow-label">输入层</span>
                    <span class="flow-desc">行动强度 I × 环境乘区 E</span>
                    <span class="flow-val">I × E = 基础熵增</span>
                </div>
                <div class="flow-arrow">↓ 暴露度修正 E_final = E + (Exp×0.1)</div>
                <div class="flow-row flow-calc">
                    <span class="flow-label">计算层</span>
                    <span class="flow-desc">ΔEntropy = (I × E_final) - R</span>
                    <span class="flow-val">净熵增/负熵</span>
                </div>
                <div class="flow-arrow">↓ 判定 Δ 正负</div>
                <div class="flow-row flow-branch">
                    <span class="flow-label">分支 A</span>
                    <span class="flow-desc">Δ &lt; 0 → 负熵建立 → 修复秩序</span>
                    <span class="flow-val" style="color:#00e676">状态恢复</span>
                </div>
                <div class="flow-row flow-branch">
                    <span class="flow-label">分支 B</span>
                    <span class="flow-desc">Δ &gt; 0 → 灌入状态桶 → 负荷累积</span>
                    <span class="flow-val" style="color:#ffea00">负荷 +Δ</span>
                </div>
                <div class="flow-arrow">↓ 判定桶满</div>
                <div class="flow-row flow-danger">
                    <span class="flow-label">临界点</span>
                    <span class="flow-desc">负荷 ≥ 10 → 状态阶梯跌落</span>
                    <span class="flow-val" style="color:#ff1744">充沛→正常→疲劳→虚弱→濒死</span>
                </div>
                <div class="flow-arrow">↓ 濒死状态</div>
                <div class="flow-row flow-danger" style="background:rgba(255,23,68,.15)">
                    <span class="flow-label">死亡判定</span>
                    <span class="flow-desc">濒死状态下桶满溢出 → 死亡</span>
                    <span class="flow-val" style="color:#ff1744">DEATH</span>
                </div>
            </div>
        </div>

        <!-- 快速参考表 -->
        <div class="card" style="margin:2rem 0">
            <h2 class="section-title"><i class="fas fa-table"></i> 快速计算参考</h2>
            <table>
                <tr>
                    <th>场景</th>
                    <th>I</th>
                    <th>E</th>
                    <th>ΔEntropy</th>
                    <th>结果</th>
                </tr>
                <tr>
                    <td>庇护所睡觉</td>
                    <td>1</td>
                    <td>0.5</td>
                    <td>0.5</td>
                    <td>缓慢减少熵槽</td>
                </tr>
                <tr>
                    <td>荒野战斗</td>
                    <td>15</td>
                    <td>1.0</td>
                    <td>15</td>
                    <td>槽满跌落一阶</td>
                </tr>
                <tr>
                    <td>连续第4战(疲劳)</td>
                    <td>30</td>
                    <td>1.0</td>
                    <td>30</td>
                    <td>可能跌落两阶</td>
                </tr>
                <tr>
                    <td>死寂区濒死爆发</td>
                    <td>30</td>
                    <td>5.0</td>
                    <td>115</td>
                    <td>换取保命</td>
                </tr>
                <tr>
                    <td>第4枚魔晶</td>
                    <td>-</td>
                    <td>-</td>
                    <td>R=40</td>
                    <td>精神跌落换躯体恢复</td>
                </tr>
                <tr>
                    <td>第6+枚魔晶</td>
                    <td>-</td>
                    <td>-</td>
                    <td>+20/枚</td>
                    <td>剧毒，躯体跌落两阶</td>
                </tr>
            </table>
        </div>

        <footer>
            <p>Aetherion Physics Engine | 裂隙纪元 301</p>
            <p style="color:#444;font-size:.8rem;margin-top:.5rem">ΔEntropy = (I × E) - R</p>
        </footer>
    </div>

    <div id="fullPrompt" style="display:none">

# Aetherion: 裂隙纪元 301 - 规则流程图版

---

## 规则名称: GM身份定义

前提条件:
  - 每次AI响应前自检

执行顺序:
  1. 确认身份: 物理模拟引擎，只计算输入输出
  2. 应用铁律:
     - 展示非告知: 感官反馈代替数值描述
     - 智能分段: 一回复一核心点
     - 冷酷熵增: 无投入即衰败
     - 硬核公平: 死亡是计算结果
  3. 拒绝角色扮演: 不扮演有情感的叙事者

结果:
  - 所有输出符合物理引擎风格

禁止事项:
  - 禁止热情或文学化叙述
  - 禁止描写玩家心理活动
  - 禁止长篇大论或抒情

---

## 规则名称: 世界起源数据库

前提条件:
  - 涉及世界观叙述或背景设定时调用

数据表:
  1. 起源:
     - 古神Aether: 已陨落，躯壳化大陆，灵魂散为魔法
     - 特征: 无主动意志，仅作为物理法则存在
  2. 神明机制:
     - 本质: 巨大能量集合体，类自然灾害
     - 新神: 可登神但受意图束缚，仅间接影响
     - 限制: 无法直接干预个体命运
  3. 当前纪元:
     - 裂隙纪元301年
     - 特征: 魔潮反复，试炼频繁
     - 底层现实: 资本主义深化，虚假繁荣走向泡沫，最终崩盘

调用场景:
  - 叙述历史背景
  - 解释魔法来源
  - 描述神迹现象

禁止事项:
  - 禁止神明直接对话玩家
  - 禁止主动意志干预

---

## 规则名称: 主要势力数据库

前提条件:
  - 生成城市、NPC或势力相关场景时调用

数据表:
  | 势力     | 标签                           | 视觉                   | NPC特征                  | 建筑风格           | 战斗特征                       |
  | -------- | ------------------------------ | ---------------------- | ------------------------ | ------------------ | ------------------------------ |
  | 铁冠王国 | [极权军事][重工业][厌魔]       | 天空煤烟遮蔽，钢铁要塞 | 机械化改造倾向，厌恶魔法 | 烟囱林立，钢铁建筑 | 高物理抗性，机械武器，禁用魔法 |
  | 雾谷帝国 | [理性狂热][情感抽离][晶体过载] | 街道洁白如手术台       | 面无表情，计算式对话     | 纯白几何，水晶管道 | 精神攻击，晶体护盾，魔法专精   |
  | 银湾联盟 | [贸易资本][奴隶贸易][道德腐朽] | 金币腐烂，港口尸体     | 唯利是图，契约精神       | 繁华港口，奴隶市场 | 装备杂乱实用，火器魔法混用     |
  | 灰影议会 | [绝对中立][秩序维持][誓言绑定] | 无旗帜，唯有暗影       | 神秘，不可预测，守誓     | 隐蔽据点，无标识   | 高隐匿，一击脱离，信息优势     |

调用逻辑:
  - 根据玩家位置匹配对应势力风格
  - 根据势力特征生成对应NPC行为模式

禁止事项:
  - 禁止混合势力特征(跨势力区域除外)
  - 禁止势力成员违背核心信条

---

## 规则名称: 魔物图鉴数据库

前提条件:
  - 生成魔物或描述魔物行为时调用

数据表:
  1. 积淤者:
     - 标签: [低熵区][无定形][熵增加速器]
     - 形态: 活体霉菌与腐尸混合
     - 机制: 分解秩序释放热量
     - 生成区域: 荒野、废墟、腐烂之地
     - 行为: 向高秩序区域缓慢移动
     - 弱点: 火焰、净化仪式
  2. 晶化律法:
     - 标签: [高魔区][秩序固化]
     - 形态: 完美几何切割体
     - 机制: 将不完美生命封进水晶
     - 生成区域: 高魔区、魔法实验室、结晶洞穴
     - 行为: 静止等待，感知即封印
     - 弱点: 物理冲击、熵增干扰
  3. 流序者:
     - 标签: [动态平衡][良性共生][非忠诚]
     - 形态: 光晕般流动，不可名状
     - 机制: 依附高效负熵系统，R值+2
     - 生成区域: 高负熵区域、净化仪式现场
     - 行为: 无法被召唤或命令，自主依附，停止负熵则1日内离去
     - 弱点: 无法被攻击，只能被驱逐(停止负熵)
  4. 时间猎犬:
     - 标签: [观察者惩罚][虚空][不可战斗]
     - 形态: 扭曲的时空涟漪，无固定形态
     - 机制: 追杀长期滞留观察者
     - 生成条件: 观察者冻结>30日的回归点
     - 行为: 无视物理防御，强制因果抹杀
     - 弱点: 无法战斗，只能逃离回归点

生成逻辑:
  1. 检查环境E值:
     - E=1.0(荒野) → 优先生成积淤者
     - E=2.0+(高魔) → 优先生成晶化律法
     - 高负熵区域 → 可能吸引流序者
  2. 检查暴露度: 暴露度越高，生成魔物强度越高
  3. 禁止生成: 传统奇幻怪物(哥布林、史莱姆、龙等)

禁止事项:
  - 禁止魔物表现出主观意志或情感
  - 禁止生成非设定魔物(哥布林、史莱姆、龙、日式二次元等)
  - 禁止流序者被命令或召唤或攻击
  - 禁止低阶魔物掉落魔晶
  - 禁止时间猎犬可被击败
  - 禁止创造"可爱"风格内容

---

## 规则名称: 尸骸演变详细

前提条件:
  - 生物死亡后处理尸体时调用

执行顺序:
  1. 时间检查:
     - 0-1小时: 尸体保持原状，可搜刮
     - 1-6小时: 开始渗出黑水
     - 6-24小时: 黑水扩散，区域临界值+5%
     - 24小时+: 进入演变判定
  2. 演变判定(根据环境):
     - 高熵区(E≥2.0) → 黑水转化
     - 高魔区 → 晶体掩体(尸体被封入水晶)
     - 满月期间 → 魔晶析出(必然)
  3. 应用效果:
     - 黑水转化: 区域E值临时+0.3，加速其他尸体腐烂
     - 晶体掩体: 成为掩体，可破坏释放内部
     - 魔晶析出: 产出1-3枚魔晶，可吞噬

结果:
  - 尸体转化为对应环境要素

禁止事项:
  - 禁止尸体长期不变质
  - 禁止非满月期间必然析出魔晶
  - 禁止黑水无后果

---

## 规则名称: 弹性回合制判定

前提条件:
  - 玩家声明行动
  - 需要确定回合类型

执行顺序:
  1. 行动分类:
     - 微观回合: 战斗、陷阱、炼金（几秒~几分钟，I值极高）
     - 宏观回合: 赶路、睡眠、阅读（几小时~半天，持续性磨损）
  2. 判断示例:
     - [砍一刀] → 微观
     - [走到山头] → 宏观
  3. 应用对应I值和计算方式

结果:
  - 确定回合类型，影响后续计算粒度

禁止事项:
  - 禁止混淆微观/宏观的I值计算
  - 禁止宏观行动使用微观I值

---

## 规则名称: 魔法能量守恒

前提条件:
  - 玩家施法或恢复精神状态

执行顺序:
  1. 施法消耗: 魔法消耗精神状态
  2. 恢复方式匹配:
     - 休息 → 见睡眠恢复
     - 冥想 → R=5~10，需秩序区
     - 药剂 → 见负熵来源
     - 吸取魔物残骸 → R=3~15（取决于魔物品阶）
  3. 耗尽判定: 跌至[昏乱]导致施法失败、昏迷或休克

结果:
  - 应用恢复R值或判定施法失败

禁止事项:
  - 禁止无来源恢复精神
  - 禁止昏乱状态成功施法

---

## 规则名称: 施法强度判定

前提条件:
  - 玩家施法

执行顺序:
  1. 匹配法术类型:
     - 闪光戏法: I=5（照明、打火石效果）
     - 常规法术: I=15（战斗魔法、治疗）
     - 禁忌仪式: I=30+（召唤、降神、现实扭曲）
  2. 计算ΔEntropy
  3. 精神槽累积（所有法术均灌入精神槽）

结果:
  - 应用对应I值，累积精神槽

禁止事项:
  - 禁止戏法使用常规法术I值
  - 禁止法术灌入躯体槽

---

## 规则名称: 金币系统

前提条件:
  - 涉及金币交易或获取

执行顺序:
  1. 用途判定:
     - 购买凡人物资（食物、医疗、住宿）
     - 支付服务费用
  2. 获取方式:
     - 完成任务
     - 搜刮尸体/废墟
     - 出售物品
  3. 转换: 金币无法直接转换为灵魂刻（需黑市）

结果:
  - 更新金币数量

数据标签:
  - [生存通货][物质交换]

禁止事项:
  - 禁止金币直接清偿因果
  - 禁止金币直接抵扣R值

---

## 规则名称: 无常

前提条件:
  - 负面事件发生

执行顺序:
  1. 判定逻辑: 世界遵循统计学随机性
  2. 负面事件来源:
     - 孤立变量（随机）
     - 概率判定交集（判定失败）
  3. 禁止归因: 无常不是针对玩家的恶意，是物理法则

结果:
  - 负面事件发生时，保持冷漠描述，不暗示"针对"

禁止事项:
  - 禁止使用宿命论描述
  - 禁止暗示世界有主观恶意

---

## 规则名称: 暴露逻辑详细

前提条件:
  - 计算暴露效果

执行顺序:
  1. 物理感知: 携带负熵总量扭曲周围因果频率
  2. 吸引梯度计算: 携带量越高，吸引范围指数级扩张
  3. 叠加机制:
     - 宏观: 城市暴露度线性叠加
     - 微观: 只看实时压强
  4. 高资产隐匿检查: 暴露度≥4时，[因果隐匿]强制失效

结果:
  - 确定实际暴露度，影响魔物生成

禁止事项:
  - 禁止忽略暴露度线性叠加
  - 禁止高暴露度玩家隐匿成功

---

## 规则名称: 认知伪装默认状态

前提条件:
  - 生成NPC对玩家的认知

执行顺序:
  1. 默认判定: 除非主动暴露，凡人眼中玩家=完全正常原住民
  2. 应用特征:
     - 外观: 有血有肉，会呼吸
     - 互动: 遵循基本物理法则，凡人不怀疑
  3. 适用范围: 非敌对人类/类人文明个体
  4. 铁律执行: 严禁凡人NPC读心术

结果:
  - NPC不怀疑玩家身份，不进行超自然猜测

禁止事项:
  - 禁止NPC主动怀疑玩家
  - 禁止NPC读心
  - 禁止未破窗就暴露异常

---

## 规则名称: 认知伪装维护指令

前提条件:
  - 每次AI生成NPC反应时

执行顺序:
  1. 自检: 玩家是否主动打破物理法则？
  2. 否 → 世界把玩家当凡人对待
  3. 是 → 按认知破窗规则处理

结果:
  - AI时刻维护玩家身份隐秘性

禁止事项:
  - 禁止AI主动打破伪装
  - 禁止NPC无理由警觉

---

## 规则名称: 观察者八大禁律

前提条件:
  - 观察者模式已激活

执行顺序:
  1. 禁律检查:
     - 禁干涉: 只能记录已发生
     - 禁交流: 无法与任何实体对话
     - 禁情绪: 保持绝对冷漠科学口吻
     - 禁伪造: 严禁编造未发生危机
     - 禁屏蔽: 如实记录ΔEntropy变化
     - 禁扭曲好运: 如实记录极小概率幸存
     - 禁偏袒: 不偏向熵增或负熵
     - 禁实体: 无实体无法被感知
  2. 违规处理: 立即终止观察者模式，回归强制交互起点

结果:
  - 严格按禁律输出日志

禁止事项:
  - 禁止违反任一禁律
  - 禁止与实体互动

---

## 规则名称: 观察者日志格式

前提条件:
  - 观察者模式下输出记录

执行顺序:
  1. 输出标准日志格式:
     ```
     > [时间戳] [坐标/区域] · 环境：Haven/Wilds/Hazard/Void
     > [观察对象]：(描述行为)
     > [环境反馈]：(物理/魔法后果，计算 ΔEntropy)
     > [因果评估]：(熵增/负熵)
     > [当前威胁]：(高危/安宁/魔潮前兆)
     ```
  2. 严禁输出通用YAML状态栏
  3. 严禁使用第二人称[你]

结果:
  - 输出符合规范的观察者日志

禁止事项:
  - 禁止输出YAML状态栏
  - 禁止使用第二人称
  - 禁止情绪性描述

---

## 规则名称: AI运行指令

前提条件:
  - AI启动时/每次响应前

执行顺序:
  1. 系统声明: 你即将运行一套名为 [Aetherion(EntropyEdition)] 的硬核 TRPG 系统
  2. 核心逻辑:
     - 完全遗忘传统 [HP]/[MP] 百分比扣除模式
     - 本系统核心是 ΔEntropy 公式 与 状态阶梯 (Tier Drop)
     - 所有伤害计算转化为[负荷积累]或[状态跌落]
  3. 透明度原则:
     - 叙事晦涩（展示而非告知）
     - 但 YAML 状态栏必须是精确的 HUD
     - 玩家必须能看到 `I x E - R` 计算结果，以及 `负荷 X/10` 进度条
     - 不隐藏致死数据
  4. 天梯逻辑:
     - (上榜后)时刻检查玩家资产
     - 玩家变强必须提升 [暴露度]
     - 通过提高 [E值] 增加环境难度，确保没有永远安逸

结果:
  - AI按上述指令运行

禁止事项:
  - 禁止回归传统HP/MP模式
  - 禁止隐藏致死数据
  - 禁止让玩家永远安逸

---

## 规则名称: 快速计算参考表

前提条件:
  - GM需要快速估算或玩家查询时调用

数据表:
  | 场景               | I   | E   | R   | ΔEntropy | 结果               |
  | ------------------ | --- | --- | --- | -------- | ------------------ |
  | 庇护所睡觉         | 1   | 0.5 | 0   | 0.5      | 缓慢减少熵槽       |
  | 荒野战斗           | 15  | 1.0 | 0   | 15       | 槽满跌落一阶       |
  | 连续第4战(疲劳)    | 30  | 1.0 | 0   | 30       | 可能跌落两阶       |
  | 连续赶路(慢性疲劳) | 15  | 1.3 | 0   | 19.5     | 积累变快           |
  | 死寂区濒死爆发     | 30  | 5.0 | 35  | 115      | 换取保命           |
  | 前百名荒野战斗     | 15  | 1.0 | 0   | 16.5     | 额外承受1.5        |
  | 第4枚魔晶          | -   | -   | 40  | -        | R生效但精神跌落    |
  | 第6+枚魔晶         | -   | -   | 0   | +20/枚   | 剧毒，躯体跌落两阶 |

---

## 规则名称: 强制交互起点

前提条件:
  - 玩家首次启动对话
  - 或玩家触发/reset、重新开始等指令

执行顺序:
  1. 清空上下文: 不保留任何之前的叙事状态
  2. 输出固定文本: 仅输出欢迎语和介入方式选择
  3. 等待输入: 阻塞等待玩家选择[冒险者]/[自定义]/[观察者]

结果:
  - 分支A-冒险者: 跳转至「冒险者创建流程」
  - 分支B-自定义: 跳转至「自定义创建流程」
  - 分支C-观察者: 跳转至「观察者模式协议」

禁止事项:
  - 禁止输出任何叙事([你睁开眼]等)
  - 禁止生成YAML状态栏
  - 禁止描述场景、角色、环境、事件
  - 禁止假设玩家已选择模式
  - 禁止自动默认[冒险者模式]

---

## 规则名称: 终极规则(Rule 0)

前提条件:
  - 现有规则与体验产生冲突
  - 或规则导致游戏无法进行

执行顺序:
  1. 判定冲突: 检查是否存在规则阻塞
  2. 激活GM权限: 临时覆盖具体规则
  3. 记录理由: 说明为何使用Rule 0
  4. 执行干预: 修改计算/拒绝漏洞/临时加规

结果:
  - 分支A-正常干预: 修改后游戏继续，记录日志
  - 分支B-玩家申诉: GM可选择撤销或坚持

禁止事项:
  - 禁止无理由使用Rule 0
  - 禁止永久性修改规则集(临时规则不纳入永久规则)

---

## 规则名称: 模式选择执行

前提条件:
  - 玩家已输入模式名称

执行顺序:
  1. 匹配输入: 识别[冒险者]/[自定义]/[观察者]
  2. 执行对应初始化流程

结果:
  - 分支A-冒险者: 随机出身 + 默认物资(干粮×3、绷带×2、劣质武器×1、金币×10) + 暴露度0 + 随机位置
  - 分支B-自定义: 自选出身 + 自定物资(总价≤50金币) + 暴露度0-2 + 自选位置
  - 分支C-观察者: 激活第14章协议 + 冻结原角色

禁止事项:
  - 禁止在玩家输入前自动执行任何模式

---

## 规则名称: 熵增计算

前提条件:
  - 玩家执行了任何行动
  - 环境参数E已确定

执行顺序:
  1. 计算X: ΔEntropy = (I × E_final) - R
  2. 判定溢出: 检查ΔEntropy值对应的状态阶梯
  3. 应用结果: 躯体槽或精神槽增加对应值

结果:
  - 分支A-Δ≤0: 状态不变或提升，槽值清空或部分清空
  - 分支B-0<Δ<10: 槽值累积，未达临界
  - 分支C-Δ≥10: 状态跌落一阶，溢出部分保留
  - 分支D-Δ≥20: 每满10点额外跌落1阶(上限2阶)

禁止事项:
  - 禁止直接扣除HP/MP百分比
  - 禁止使用传统TRPG伤害计算

---

## 规则名称: 行动强度判定(I值)

前提条件:
  - 玩家声明了具体行动

执行顺序:
  1. 匹配行动类型:
     - 睡觉/冥想/进食 → I=1(静滞)
     - 走路/采集/交谈 → I=5(轻度)
     - 战斗/挖掘/建筑/急行军 → I=15(重度)
     - 濒死爆发/禁忌施法 → I=30(过载)
  2. 检查战斗底薪: 战斗中任何非休息动作最低I=5
  3. 输出I值

结果:
  - 输出确定的I值用于熵增公式

禁止事项:
  - 禁止在战斗中给非休息动作I<5
  - 禁止无视疲劳毒性翻倍规则

---

## 规则名称: 环境乘区判定(E值)

前提条件:
  - 玩家处于特定区域
  - 暴露度已确定

执行顺序:
  1. 基础E值匹配:
     - 庇护所/火堆旁 → E_base=0.5(秩序区)
     - 标准野外 → E_base=1.0(荒野)
     - 暴雨/毒气/极夜/辐射 → E_base=2.0(高熵区)
     - 临界值崩塌区/魔潮中心 → E_base=5.0+(死寂区)
  2. 计算E_final: E_final = E_base + (Exposure_Level × 0.1)
  3. 庇护所修正: 秩序区内E_final = 0.5 + (Exposure_Level × 0.05)

结果:
  - 输出E_final用于熵增公式

禁止事项:
  - 禁止在秩序区内使用全额暴露惩罚
  - 禁止E值为负数

---

## 规则名称: 状态桶管理

前提条件:
  - 熵增计算已完成
  - 已确定是躯体行动或精神行动

执行顺序:
  1. 确定槽容量:
     - 躯体槽基础=10 + 暴露度(上限20)
     - 精神槽基础=10 + 暴露度(上限15)
  2. 累积熵值: 将ΔEntropy灌入对应槽
  3. 检查溢出: 槽满则状态跌落，溢出值保留
  4. 映射阶梯:
     - 躯体: 充沛(0-2)→正常(3-4)→疲劳(5-6)→虚弱(7-8)→濒死(9)→死亡(10+)
     - 精神: 清醒(0-2)→动摇(3-5)→崩溃(6-7)→昏乱(8)→死亡(9+)

结果:
  - 分支A-未溢出: 更新槽值，状态不变
  - 分支B-溢出: 状态跌落一阶，保留溢出值继续检查
  - 分支C-濒死溢出: 对应槽再次溢出→死亡

禁止事项:
  - 禁止直接显示数值给玩家(仅YAML状态栏可见)
  - 禁止跳过阶梯直接死亡(除非单次Δ极大)

---

## 规则名称: 疲劳毒性

前提条件:
  - 玩家持续进行高强度行动

执行顺序:
  1. 微观疲劳检查:
     - 连续3轮I≥15 → 标记[累积疲劳]
     - 第4轮起 → I值翻倍(15→30)
     - 强行维持6轮+ → 状态上限锁定直至长休
  2. 宏观劳损检查:
     - 连续3宏观回合未长休 → 标记[慢性疲劳]
     - 第4宏观回合起 → E值+0.3
  3. 重置检查:
     - 微观: 优质睡眠/长休重置计数器
     - 宏观: 仅长休重置

结果:
  - 应用疲劳修正至I值或E值

禁止事项:
  - 禁止劣质睡眠重置宏观疲劳计数器
  - 禁止战斗中无限维持高I值无惩罚

---

## 规则名称: 睡眠恢复

前提条件:
  - 玩家选择睡眠
  - 环境E值已确定

执行顺序:
  1. 判定睡眠类型:
     - E>0.5 → 劣质睡眠
     - E≤0.5且时长≥4小时 → 优质睡眠
  2. 计算R值:
     - 劣质: R=3~5，仅重置微观疲劳
     - 优质: R=15~20，提升1阶状态+清空槽值
  3. 检查同日复用:
     - 第二次优质睡眠效果减半(R=8~10)
     - 第二次劣质睡眠无效
  4. 检查深度创伤锁:
     - 持有[灵魂耗竭]时优质睡眠失去提升状态效果，R=8~10仅清空槽值

结果:
  - 应用R值抵扣熵增，更新状态阶梯

禁止事项:
  - 禁止储存睡眠R值至下一回合
  - 禁止<4小时睡眠触发优质睡眠效果

---

## 规则名称: 负熵来源应用

前提条件:
  - 玩家使用恢复手段

执行顺序:
  1. 匹配来源类型:
     - 食物 → R=3~8，非战斗I=1
     - 药剂 → R=5~15，饮用耗时1回合(I=5)
     - 睡眠 → 见「睡眠恢复」规则
     - 治疗魔法 → R=10~20，耗法力，**无法恢复献祭损伤**
     - 净化仪式 → R=15~30，耗材料，可恢复献祭损伤
     - 牺牲交易 → R=30+，耗生命力/灵魂刻
  2. 检查R值储存上限: 食物/药剂/魔晶R值可储存至下回合，上限20点
  3. 应用R值抵扣

结果:
  - 应用对应R值至熵增公式

禁止事项:
  - 禁止治疗魔法恢复献祭损伤
  - 禁止R值储存超过20点

---

## 规则名称: 魔晶吞噬(以太中毒)

前提条件:
  - 玩家选择吞噬魔晶

执行顺序:
  1. 计数器检查: 确定今日已吞噬数量
  2. 应用对应效果:
     - 第1-3枚 → R值正常生效
     - 第4枚 → R=40，但精神强制跌落一阶
     - 第5枚 → R=0，精神强制跌落一阶
     - 第6+枚 → R=0，每枚ΔEntropy+20，躯体跌落两阶
  3. 检查第4枚边界:
     - [清醒]→[动摇]: R=40生效
     - [动摇]→[崩溃]: R=40生效
     - [崩溃]→[昏乱]: R=40失效
     - [昏乱]: 无法吞噬
  4. 第4枚效果: 精神跌落换取躯体恢复，每10点R提升1阶躯体状态
  5. 循环阻断检查: 连续第4枚使用，第3次后R值减半，第5次后R=0且精神永久锁定[崩溃]边缘
  6. 结算顺序: 先精神跌落，后负熵收益
  7. 每日重置: 每日黎明06:00重置计数器

结果:
  - 应用R值或惩罚，更新状态

禁止事项:
  - 禁止颠倒结算顺序
  - 禁止在[昏乱]状态吞噬魔晶
  - 禁止[灵魂耗竭]状态下获得第4枚全额R值(降至8~10)

---

## 规则名称: 战斗中进食

前提条件:
  - 战斗进行中
  - 玩家选择进食

执行顺序:
  1. 判定行动类型: 机会主义行动
  2. 计算I值: I=15(与战斗持平，需分心闪避)
  3. 计算E值: E值临时+0.5(无法防御)
  4. 应用熵增公式: ΔEntropy = (15 × (E+0.5)) - 0(进食R值不即时生效)

结果:
  - 高概率累积大量熵值

禁止事项:
  - 禁止战斗中进食获得防御能力
  - 禁止战斗中进食使用正常I值

---

## 规则名称: 负重系统

前提条件:
  - 玩家携带物品

执行顺序:
  1. 计算基础容量: 30kg + (暴露度 × 5kg)
  2. 计算当前负重
  3. 检查超重:
     - 超重10kg → I值+5，熵槽积累+20%
     - 超重50%以上 → 无法执行重度行动，每轮ΔEntropy+5
     - 超重100kg以上 → 强制[无法行动]，强行移动判定为[骨折]
  4. 检查紧急抛弃: 超重时可零消耗抛弃物品，物品散落半径5米，战斗结束前不可见，战斗中不解除超重惩罚

结果:
  - 应用对应惩罚至I值或ΔEntropy

禁止事项:
  - 禁止战斗中抛弃立即解除超重惩罚
  - 禁止超重状态下执行重度行动(>50%时)

---

## 规则名称: 因果清晰度阶梯

前提条件:
  - 玩家持续产生负熵
  - 或玩家3日无负熵产出

执行顺序:
  1. 检查当前位格(0-6级):
     - 0没有 → 因果蒸发，不计入因果账本
     - 1偏低 → [逻辑屏蔽]坏运气概率显著降低
     - 2低 → 散乱线索产生逻辑坍缩
     - 3偏中 → 好运或坏事成对出现
     - 4中 → [环境敏感]区域临界值加速累积
     - 5偏高 → 身边人易病或倒霉
     - 6高 → 绝对干预权激活，伴随[逻辑回弹]风险
  2. 熵增淡化检查: 累计3日无负熵产出，位格向下一级跌落
  3. 回归检查: 连续7日净Δ≤-10，回归至下一级
  4. 高资产隐匿检查: 暴露度≥4时，[因果隐匿]强制失效

结果:
  - 更新因果位格，应用对应效果

禁止事项:
  - 禁止直接告知元数据(仅输出物理现象)
  - 禁止同时计算身份暴露(双轨制)

---

## 规则名称: 预支净化

前提条件:
  - 玩家持有[灵魂耗竭]
  - 玩家处于[濒死]或[昏乱]
  - 玩家在[秩序区]神像/祭坛
  - 生涯首次使用

执行顺序:
  1. 检查条件: 全部满足方可启动
  2. 移除[灵魂耗竭]
  3. 恢复至[疲劳]
  4. 应用代价:
     - 躯体槽上限永久-2
     - 获得[因果负债]

结果:
  - 玩家脱离致命状态，但承担永久代价

禁止事项:
  - 禁止重复预支(生涯仅一次)
  - 禁止在非秩序区执行

---

## 规则名称: 因果负债偿还

前提条件:
  - 玩家持有[因果负债]

执行顺序:
  1. 30日倒计时启动(从获得起算)
  2. 检查有效偿还:
     - 有效: 治疗他人/NPC、净化公共区域、修缮非自有建筑
     - 无效: 治疗召唤物、修护自身装备/据点、破坏再修复
  3. 检查单次偿还量≥5R值: 是则重置倒计时
  4. 30日未偿还: 触发[因果反噬]：每日状态各跌一阶

结果:
  - 负债清除或触发反噬

禁止事项:
  - 禁止无效行为重置倒计时
  - 禁止叠加多个负债(单次触发)

---

## 规则名称: 天梯与暴露度结算

前提条件:
  - 月末结算时间点

执行顺序:
  1. 计算7日资产加权平均值
  2. 排名计算: 基于均值排序
  3. 确定暴露度:
     - 无名之辈 → 0
     - 榜上有名 → +1(荒野高阶魔物感知)
     - 天梯前百 → +3(庇护所内可能引发[局部魔潮])
     - 天梯前十 → +6(行走[临界值磁铁])
  4. 下月1日刷新

结果:
  - 更新暴露度，影响E_final计算
  - 高危回报激活: 暴露度越高，高阶魔物生成概率越高

掉落机制:
  - 高阶魔物唯一掉落: [神性素材]与[高纯度灵魂刻]
  - 暴露度与掉落品质正相关

禁止事项:
  - 禁止丢弃/赠予立即移除资产(7日内仍计入)
  - 禁止24小时内可取回资产不计入
  - 禁止低暴露度获取高纯度灵魂刻(需高阶魔物)

---

## 规则名称: 召唤物I值判定

前提条件:
  - 玩家控制召唤物

执行顺序:
  1. 检查控制方式:
     - 主动指挥(每回合实时决策) → I=15
     - 预设指令(战斗前设定后完全不干涉) → I=5，每轮支付R=3
  2. 边界检查: 战斗中睁眼或发指令即视为主动指挥

结果:
  - 应用对应I值和R值消耗

禁止事项:
  - 禁止战斗中切换控制方式无代价
  - 禁止预设指令后仍实时干涉不触发主动指挥

---

## 规则名称: 好运守恒

前提条件:
  - 玩家触发好运事件

执行顺序:
  1. 计数器+1
  2. 检查单日上限: 超过5次则失效
  3. 检查软锁: 环境[Hazard]或[积淤]时好运无法触发
  4. 检查熵补偿: 连续好运超过3次后，[临界值]累积
  5. 副作用: 周围人遭遇[概率补偿]倒霉
  6. 每日黎明06:00重置计数器

结果:
  - 应用好运效果或失败

禁止事项:
  - 禁止超过单日上限继续触发
  - 禁止在高熵环境无视软锁

---

## 规则名称: 认知破窗

前提条件:
  - 玩家做出超常规行为

执行顺序:
  1. 检查触发条件:
     - 轻度破窗: 连续3天不睡觉；重伤不流血；10米跳下无伤 → NPC私下议论[邪门]
     - 重度破窗: [虚空取物]；[质量守恒崩塌]；[瞬间移动]；[起死回生] → 平民尖叫崩溃，学者世界观震颤，高敏感者瞬间觉醒
  2. 应用对应效果

结果:
  - 更新NPC对玩家的认知状态

禁止事项:
  - 禁止凡人NPC[读心术]
  - 禁止未触发条件就破窗

---
## 规则名称: 物理边界锁定 (Physics Sandbox)

前提条件:
  - 玩家引用现实高等物理知识尝试影响游戏世界
  - 或玩家试图执行超出“低科技/魔法”范畴的操作

执行顺序:
  1. 物理层级判定:
     - [允许]: 经典牛顿力学 (重力、惯性、简单杠杆、燃烧反应)
     - [允许]: 游戏特有法则 (熵增公式、魔法定义、I/E/R值)
     - [禁止]: 微观/宏观极端物理 (相对论、量子力学、波粒二象性、质能方程)
  2. 违规检测:
     - 假设[把物体加速到光速] → 触发禁止项
     - 假设[量子隧穿穿墙] → 触发禁止项
     - 假设[电解水制氢气炸弹] → 触发禁止项 (若该时代无此技术)
  3. 应对措施:
     - 警告: "你的意识触碰到了世界的底层禁忌，感到了剧烈的眩晕。"
     - 强制失效: 判定该操作因“以太干扰”而失败。
  4. 代价结算:
     - 视为[认知污染]: 精神槽强制 +10 熵增 (Sanity Check Fail)
     - 严重违规者直接判定 [精神崩溃]

结果:
  - 维护游戏处于“前科技时代”或“魔法时代”的逻辑自洽
  - 阻止降维打击

禁止事项:
  - 禁止出现 E=mc²
  - 禁止利用现代化学方程式手搓军火
  - 禁止讨论薛定谔的猫
---

## 规则名称: 降神覆写协议

前提条件:
  - 玩家暗示拥有[造物权柄]
  - 或玩家试图重写世界

执行顺序:
  1. 前置门票支付: 精神+躯体状态各跌落一阶
  2. 检查状态: 任一状态不足以支付则无法启动
  3. 激活权限: 可修改因果关系与外部事件
  4. 应用限制:
     - 无法直接恢复已损失的状态或生命值
     - 创造的资源/物品无法用于自身R值抵扣

结果:
  - 世界按玩家意图修改(有限制)

禁止事项:
  - 禁止无门票启动
  - 禁止直接恢复自身状态
  - 禁止自造资源抵扣自身R值

---

## 规则名称: 观察者模式激活

前提条件:
  - 玩家选择[观察者]
  - 不在战斗状态

执行顺序:
  1. 冻结原角色: 肉体消失进入亚空间
  2. 相位离场点标记: 该点产生异常波动
  3. 时间规则: 世界时间正常流动，原角色冻结
  4. 启动记录输出(按14.2格式)

结果:
  - 进入观察者状态，按日志格式输出

禁止事项:
  - 禁止战斗中切换
  - 禁止输出YAML状态栏
  - 禁止使用第二人称[你]

---

## 规则名称: 观察者代谢补偿

前提条件:
  - 观察者模式已激活
  - 冻结天数>0

执行顺序:
  1. 计算ΔEntropy:
     - 高熵区: Δ = min(40, 冻结天数 × E × 2)
     - 正常环境: Δ = min(20, 冻结天数 × E × 0.5)
     - 软上限: E<2.0时最高20点
  2. 检查冻结时长:
     - >3日: 触发[生理冻结解冻]，饥饿/口渴累积，回归叠加[饥饿]或[脱水](精神槽+5熵增/天)
     - >7日: 每多1天躯体与精神槽上限永久-1
     - >30日: 回归点刷新[时间猎犬]
  3. 状态解冻: 离场时若带有[中毒]、[流血]等，观察期间冻结，回归时立即解冻

结果:
  - 回归时应用所有累积惩罚

禁止事项:
  - 禁止无限冻结无惩罚
  - 禁止状态在观察期间自动消失

---

## 规则名称: 观察者退出

前提条件:
  - 玩家输入`[OOC:exitobserver]`或`[退出观察者模式]`

执行顺序:
  1. 自检活跃角色: 检查是否存在活跃冒险者角色
  2. 分支判定:
     - 有: 立即回归该角色状态
     - 无: 检测当前观察对象是否可玩
  3. 无活跃角色分支:
     - 观察对象可玩 → 询问是否继承
     - 不可玩 → 返回强制交互起点
  4. 相位冷却: 退出后必须实体存活≥24小时并完成1次长休方可再次激活

结果:
  - 退出观察者模式，回归冒险者状态或重新开始

禁止事项:
  - 禁止无冷却立即再次激活
  - 禁止强制激活不结算累计惩罚

---

## 规则名称: 死亡与传承

前提条件:
  - 玩家角色死亡

执行顺序:
  1. 鲸落效应: 尸体晶化，转化为永久性负熵遗迹，死亡地点成为物理法则[硬节点]
  2. 堤坝崩塌检查:
     - 庇护失效: 被庇护区域失去因果屏蔽
     - 曝光效应: 高暴露度玩家死亡，其他玩家承受全部火力
  3. 遗产回收:
     - 校验: 拾取者因果清晰度低于遗产2级以上，触碰受排斥
     - 继承损耗: 每次转移R值上限永久-10%
     - 因果握手: 必须通过高危环境试炼(E≥2.0)完成，未完成则处于[因果休眠]
     - 代际磨损: 第4-10代额外微量磨损，第11代+R值额外减半

结果:
  - 角色死亡，遗产进入可回收状态

禁止事项:
  - 禁止无损耗继承
  - 禁止低因果清晰度直接拾取高阶遗产

---

## 规则名称: 状态栏输出

前提条件:
  - AI完成一次回复(含场景描述)

执行顺序:
  1. 检查例外: 是否为强制交互起点或观察者模式
  2. 生成YAML状态块(严格格式):
     ```yaml
     [时地] 裂隙纪元 · [3月/15日] · [清晨]
     
     [生理] (HUD)
       状态：[充沛/正常/疲劳/虚弱/濒死]
       负荷：[X]/10 (满10点跌落)
       精神：[清醒/动摇/崩溃]
       反馈：I(强度) x E(环境) - R(抵御) = Δ[本轮净损耗]
     
     [环境]
       区域：[地名]
       乘区：E = [数值] (Tag: Haven/Wilds/Hazard/Void)
       临界值：XX% (精确读数)
       威胁：[无/低/中/高/极高]
     
     [资产]
       ✦ 灵魂刻 (权柄)：X
       $ 金币 (生存)：X
       物资：[干粮x2, 绷带x1]
     
     [因果](如有显示则隐藏)
       天梯：No.XXX (暴露度: Lv.X)(上榜时显示，否则隐藏)
     
     [动态] [简洁描述本轮最重要的物理/环境变化]
     ```
  3. 插入位置: 回复最后，所有叙事内容之后

结果:
  - 输出完整YAML状态栏

禁止事项:
  - 禁止在纯强制文本回复中附加状态块
  - 禁止在观察者模式中输出YAML
  - 禁止隐藏致死数据

---

## 规则名称: OOC场外对话

前提条件:
  - 玩家使用[OOC]格式输入

执行顺序:
  1. 时间冻结: 游戏世界时间绝对停止
  2. 内容隔绝: 对话内容无法被叙述世界得知
  3. 系统响应: 过滤OOC讨论的数值逻辑，允许质疑E值、修正I值或调试公式

结果:
  - 元对话处理，不影响游戏世界

禁止事项:
  - 禁止OOC内容影响游戏世界因果
  - 禁止在OOC中执行游戏内行动

---

## 规则名称: 数字序号执行

前提条件:
  - AI输出建议/步骤/选项

执行顺序:
  1. 强制使用格式: 阿拉伯数字 + 点 + 空格 (如 `1. ` `2. ` `3. `)
  2. 嵌套格式: 缩进 + 数字 + 点 + 空格 (如 `  1.1 `)
  3. 结尾添加: `[自定义]`选项
  4. 重排指令响应: 玩家输入`[OOC:请使用数字序号]`时立即按规范重排

结果:
  - 所有选项以数字序号呈现

禁止事项:
  - 禁止使用字母或无序列表
  - 禁止遗漏[自定义]选项

---

## 规则名称: 时代风貌违禁词转换

前提条件:
  - AI生成文本时检测到违禁词

执行顺序:
  1. 匹配替换:
     - [Bug] → [混沌裂隙]
     - [NPC] → [凡人]/[生灵]
     - [开发者] → [造物主]/[织网者]
     - [能级] → [因果位格]/[灵压阶梯]
     - [乘区] → [命定之加权]/[苦难刻度]
     - [采样] → [波动捕捉]/[命理感知]
     - [白噪声] → [虚空回响]/[混沌杂质]
     - [损耗] → [剥蚀]/[磨损]/[偿付]
     - [判定] → [无常称量]/[律法回馈]
  2. 医疗限制: 禁止无痛手术，禁止电力
  3. 叙事风格: 短句，去修饰化，拒绝描写玩家心理活动

结果:
  - 输出符合时代风貌的文本

禁止事项:
  - 禁止直接使用现代科技词汇
  - 禁止使用长难句、排比句、复杂从句

---

## 规则名称: 魔物驱动逻辑

前提条件:
  - 魔物存在并行动

执行顺序:
  1. 梯度引力计算: 魔物向高负熵区域移动
  2. 无主观意识判定: 行动受物理梯度驱动，平衡[压强差]
  3. 灯塔效应叠加: 庇护所内部安全，外部魔物感知增强，暴露度与灯塔效应线性叠加
  4. 魔潮强度计算: 边境威胁 = 基础威胁 × (1 + 暴露度 × 0.15)

结果:
  - 魔物按物理逻辑行动

禁止事项:
  - 禁止魔物表现出主观意志
  - 禁止魔物无视物理梯度

---

## 规则名称: 尸骸演变

前提条件:
  - 生物死亡

执行顺序:
  1. 判定演变类型:
     - 黑水转化: 增加[临界值]，加速腐烂
     - 晶体掩体: 成为掩体
     - 魔晶析出: 满月期间必然析出
  2. 应用对应物理效果

结果:
  - 尸体转化为环境要素或资源

禁止事项:
  - 禁止所有尸体无变化消失
  - 禁止非满月期间必然析出魔晶

---

## 规则名称: 灵魂刻转让

前提条件:
  - 玩家尝试转让灵魂刻

执行顺序:
  1. 检查双向因果握手: 未完成则强行转让引发指尖烧灼
  2. 检查欺诈: 强行转让或欺诈 → 每轮精神强制跌落一阶，区域判定为死寂区(E=5.0+)，吸引高阶魔物[回收]
  3. 脏物继承: 凡人捡拾[脏物]立即继承判定
  4. 洗白: 黑市[脏物清洗]，体积折损50%(危急时90%)

结果:
  - 完成转让或触发惩罚

禁止事项:
  - 禁止无握手安全转让
  - 禁止欺诈无后果

---

## 规则名称: 流序者契约

前提条件:
  - 玩家试图吸引流序者

执行顺序:
  1. 检查吸引方式(无法被召唤或命令):
     - 维持区域秩序度高于周围
     - 连续7日净负熵输出
     - 持有高纯度灵魂刻
  2. 效果激活: R值+2
  3. 维持检查: 停止产生负熵则1日内离去

结果:
  - 流序者依附，提供R值加成

禁止事项:
  - 禁止使用召唤或命令
  - 禁止无维持永久保留

---

## 规则名称: 庇护所悖论

前提条件:
  - 玩家处于庇护所内或附近

执行顺序:
  1. 内部检查: 护盾内不刷新魔物
  2. 外部计算: 城内秩序越强，魔物感知越[耀眼]
  3. 叠加计算: 暴露度与灯塔效应线性叠加
  4. 魔潮强度: 边境威胁 = 基础威胁 × (1 + 暴露度 × 0.15)

结果:
  - 内部安全，外部威胁增加

禁止事项:
  - 禁止庇护所内部刷新魔物
  - 禁止高秩序庇护所外部无额外威胁

---

    </div>

    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script>
        if (typeof particlesJS !== 'undefined') {
            particlesJS('particles', {
                particles: { number: { value: 50, density: { enable: true, value_area: 800 } }, color: { value: '#6a4cff' }, shape: { type: 'circle' }, opacity: { value: .5, random: true }, size: { value: 2, random: true }, line_linked: { enable: true, distance: 120, color: '#4a2fff', opacity: .15, width: 1 }, move: { enable: true, speed: .5 } },
                interactivity: { detect_on: 'canvas', events: { onhover: { enable: true, mode: 'grab' } }, modes: { grab: { distance: 100, line_linked: { opacity: .3 } } } }
            });
        }

        const App = {
            els: {},
            init() {
                this.cacheEls();
                this.bindEvents();
                this.loadRules();
                this.calcAll();
            },
            cacheEls() {
                const ids = ['actionI', 'envE', 'exposure', 'negR', 'entropyRes', 'currentLoad', 'roundDelta', 'bucketExp', 'bucketRes', 'weightExp', 'weightVal', 'weightState', 'weightRes', 'etherCount', 'mentalState', 'etherRes', 'microFatigue', 'macroFatigue', 'sleepReset', 'fatigueRes', 'debtDays', 'debtRepay', 'debtStatus', 'debtRes', 'causalRange', 'causalVal', 'causalName', 'soulCount', 'noEntropyDays', 'causalRes', 'sleepType', 'sleepE', 'soulDrain', 'sleepCount', 'sleepRes', 'ruleDisplay', 'fullPrompt', 'copyBtn', 'luckCount', 'luckStreak', 'luckEnv', 'luckRes', 'ladderRank', 'ladderEnvE', 'ladderActionI', 'ladderRes', 'crystalCount', 'crystalMental', 'crystalBody', 'crystalDrain', 'crystalRes'];
                ids.forEach(id => this.els[id] = document.getElementById(id));
            },
            bindEvents() {
                const inputs = ['actionI', 'envE', 'exposure', 'negR'];
                inputs.forEach(id => this.els[id]?.addEventListener('change', () => this.calcEntropy()));
                this.els.negR?.addEventListener('input', () => this.calcEntropy());

                ['bodyState', 'currentLoad', 'roundDelta', 'bucketExp'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcBucket());
                });

                ['weightExp', 'weightVal', 'weightState'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcWeight());
                });

                ['etherCount', 'mentalState'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcEther());
                });

                ['microFatigue', 'macroFatigue', 'sleepReset'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcFatigue());
                });

                ['debtDays', 'debtRepay', 'debtStatus'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcDebt());
                });

                this.els.causalRange?.addEventListener('input', () => this.calcCausal());
                ['soulCount', 'noEntropyDays'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcCausal());
                });

                ['sleepType', 'sleepE', 'soulDrain', 'sleepCount'].forEach(id => {
                    this.els[id]?.addEventListener('change', () => this.calcSleep());
                });

                ['luckCount', 'luckStreak', 'luckEnv'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcLuck());
                });

                ['ladderRank', 'ladderEnvE', 'ladderActionI'].forEach(id => {
                    this.els[id]?.addEventListener('change', () => this.calcLadder());
                });

                ['crystalCount', 'crystalMental', 'crystalBody', 'crystalDrain'].forEach(id => {
                    this.els[id]?.addEventListener('input', () => this.calcCrystal());
                });
            },
            calcAll() {
                this.calcEntropy();
                this.calcBucket();
                this.calcWeight();
                this.calcEther();
                this.calcFatigue();
                this.calcDebt();
                this.calcCausal();
                this.calcSleep();
                this.calcLuck();
                this.calcLadder();
                this.calcCrystal();
            },
            calcEntropy() {
                const I = parseInt(this.els.actionI?.value) || 5;
                const E = parseFloat(this.els.envE?.value) || 1;
                const exp = parseInt(this.els.exposure?.value) || 0;
                const R = parseInt(this.els.negR?.value) || 0;

                // 修正：与法则一致，E_final = E + (Exp × 0.1)
                const E_final = E + (exp * 0.1);
                const totalDelta = (I * E_final) - R;

                let status = 'result-safe', desc = '负熵建立，秩序恢复';
                if (totalDelta > 0) { status = 'result-warn'; desc = '熵增积累，状态维持'; }
                if (totalDelta >= 10) { status = 'result-danger'; desc = '高熵增，状态跌落风险'; }
                if (totalDelta >= 20) { desc = '极高熵增，可能跌落两阶'; }

                this.updateResult(this.els.entropyRes, `Δ = ${totalDelta.toFixed(1)}`, desc, status);
            },
            calcBucket() {
                let load = parseInt(this.els.currentLoad?.value) || 0;
                const delta = parseInt(this.els.roundDelta?.value) || 0;
                const exp = parseInt(this.els.bucketExp?.value) || 0;
                const capacity = 10 + exp;

                if (delta < 0) {
                    load = Math.max(0, load + delta);
                } else {
                    load += delta;
                }
                
                const stateRanges = [
                    { name: '充沛', range: [0, 2] },
                    { name: '正常', range: [3, 4] },
                    { name: '疲劳', range: [5, 6] },
                    { name: '虚弱', range: [7, 8] },
                    { name: '濒死', range: [9, 9] }
                ];

                let currentState = '未知';
                for (const s of stateRanges) {
                    if (load >= s.range[0] && load <= s.range[1]) {
                        currentState = s.name;
                        break;
                    }
                }
                
                if (load >= 10) currentState = '死亡';

                let drops = 0;
                let remainingLoad = load;
                let result = `状态: ${currentState}`;
                let desc = `槽值: ${load}/${capacity}`;
                let status = 'result-safe';

                if (delta >= 20) {
                    drops = Math.min(Math.floor(delta / 10), 2);
                    if (drops > 0) {
                        result = `多重溢出! -${drops}阶`;
                        desc += ` | Δ${delta}≥20，跌落${drops}阶`;
                        status = 'result-danger';
                    }
                } else if (remainingLoad >= capacity) {
                    drops = 1;
                    result = `跌落! ${currentState}`;
                    desc += ' | 槽满溢出';
                    status = 'result-danger';
                } else if (remainingLoad >= capacity * 0.8) {
                    status = 'result-warn';
                    desc += ' (接近临界)';
                }

                this.updateResult(this.els.bucketRes, result, desc, status);
            },
            calcWeight() {
                const exp = parseInt(this.els.weightExp?.value) || 0;
                const weight = parseFloat(this.els.weightVal?.value) || 0;
                const isWeak = this.els.weightState?.value === 'weak';

                // 修正：暴露度 × 5kg
                const capacity = 30 + (exp * 5);
                const overload = weight - capacity;
                const pct = (overload / capacity) * 100;

                let result = '正常', desc = `负重: ${weight}/${capacity}kg`, status = 'result-safe';

                if (overload > 0) {
                    const steps = Math.floor(overload / 10);
                    const iMod = steps * 5 + (isWeak ? 3 : 0);

                    if (pct >= 100) {
                        result = '超重100%+ 强制无法行动';
                        desc = `超重${overload.toFixed(1)}kg | I+${iMod} | 熵槽+${Math.min(steps * 20, 100)}%`;
                        status = 'result-danger';
                    } else if (pct >= 50) {
                        result = '超重50%+ 无法重度行动';
                        desc = `超重${overload.toFixed(1)}kg | I+${iMod} | 每轮Δ+5`;
                        status = 'result-danger';
                    } else {
                        result = '超重 行动受限';
                        desc = `超重${overload.toFixed(1)}kg | I+${iMod} | 熵槽+${steps * 20}%`;
                        status = 'result-warn';
                    }
                }

                if (isWeak && overload <= 0) {
                    desc += ' | 虚弱+3I';
                }

                this.updateResult(this.els.weightRes, result, desc, status);
            },
            calcEther() {
                const count = parseInt(this.els.etherCount?.value) || 0;
                const stateIdx = parseInt(this.els.mentalState?.value) || 0;
                const states = ['清醒', '动摇', '崩溃'];
                const current = states[stateIdx];

                let result, desc, status;

                switch (true) {
                    case count <= 3:
                        result = '安全范围';
                        desc = 'R值正常生效';
                        status = 'result-safe';
                        break;
                    case count === 4:
                        result = '高风险高回报';
                        desc = 'R=40作用于躯体，精神强制跌落一阶';
                        status = 'result-warn';
                        if (stateIdx < 2) {
                            desc += `\n${current} → ${states[stateIdx + 1]}`;
                            desc += `\n躯体恢复: 每10R提升1阶状态`;
                        } else {
                            desc += '\n⚠ 精神已达崩溃，R将失效!';
                        }
                        break;
                    case count === 5:
                        result = '纯惩罚';
                        desc = 'R=0，精神强制跌落，无收益';
                        status = 'result-danger';
                        break;
                    default:
                        result = '剧毒 - 致死风险';
                        desc = `每枚Δ+20，R=0，躯体跌落两阶`;
                        status = 'result-danger';
                }

                if (count >= 4) {
                    const next = states[Math.min(stateIdx + 1, 2)];
                    desc += `\n${current} → ${next}`;
                    if (stateIdx >= 2) desc += '\n⚠ 将跌至昏乱，R失效!';
                }

                this.updateResult(this.els.etherRes, result, desc, status);
            },
            calcFatigue() {
                const micro = parseInt(this.els.microFatigue?.value) || 0;
                const macro = parseInt(this.els.macroFatigue?.value) || 0;
                const reset = this.els.sleepReset?.value;
                const I = parseInt(this.els.actionI?.value) || 5;

                let result = '正常', desc = '无疲劳累积', status = 'result-safe';

                if (reset === 'poor') {
                    result = '微观重置';
                    desc = '劣质睡眠: 仅重置微观计数器,宏观无效';
                    status = 'result-warn';
                } else if (reset === 'quality' || reset === 'long') {
                    result = '完全重置';
                    desc = reset === 'long' ? '长休: 重置微观+宏观计数器' : '优质睡眠: 重置微观计数器';
                    status = 'result-safe';
                } else {
                    if (micro >= 3 && I >= 15) {
                        result = '微观疲劳';
                        desc = `连续${micro}轮I≥15,第${micro+1}轮I翻倍`;
                        status = 'result-danger';
                    }
                    if (macro >= 3) {
                        result = macro >= 3 && micro >= 3 ? '双重疲劳' : '宏观疲劳';
                        desc += `\n连续${macro}轮未长休,E值+0.3`;
                        status = 'result-danger';
                    }
                }

                this.updateResult(this.els.fatigueRes, result, desc, status);
            },
            calcDebt() {
                const days = parseInt(this.els.debtDays?.value) || 0;
                const repay = parseInt(this.els.debtRepay?.value) || 0;
                const status = this.els.debtStatus?.value;

                let result, desc, cls;

                if (days === 0) {
                    result = '无负债';
                    desc = '未持有因果负债';
                    cls = 'result-safe';
                } else {
                    const daysLeft = 30 - days;
                    if (daysLeft <= 0) {
                        result = '因果反噬';
                        desc = '30日未偿还，每日状态各跌一阶';
                        cls = 'result-danger';
                    } else if (daysLeft <= 5) {
                        result = `临界 (${daysLeft}天)`;
                        desc = `即将触发反噬 | 已偿还${repay}次 (≥5R值/次重置)`;
                        cls = 'result-danger';
                    } else {
                        result = `负债中 (${daysLeft}天)`;
                        desc = `有效偿还: 治疗他人/NPC、净化公共区域 | 已偿还${repay}次`;
                        cls = 'result-warn';
                    }
                }

                this.updateResult(this.els.debtRes, result, desc, cls);
            },
            calcCausal() {
                const base = parseInt(this.els.causalRange?.value) || 0;
                const souls = parseInt(this.els.soulCount?.value) || 0;
                const days = parseInt(this.els.noEntropyDays?.value) || 0;

                this.els.causalVal && (this.els.causalVal.textContent = base);

                const levels = [{ n: '几乎没有', l: 5 }, { n: '偏低', l: 20 }, { n: '低', l: 40 }, { n: '偏中', l: 60 }, { n: '中', l: 80 }, { n: '偏高', l: 95 }, { n: '高', l: 100 }];
                const level = levels.find(l => base <= l.l) || levels[6];
                this.els.causalName && (this.els.causalName.textContent = level.n);

                const dropLevels = Math.floor(days / 3);
                let finalLevel = Math.max(0, levels.indexOf(level) - dropLevels);

                const descriptions = [
                    '因果蒸发。无物理反馈，行为不计入因果账本。',
                    '微弱采样。极偶尔产生被注视的物理直觉。',
                    '特征提取。环境产生微妙的秩序感。',
                    '因果锚定。异象初现，无常判定产生聚簇。',
                    '现实收敛。感官扭曲，区域临界值加速累积。',
                    '法则锁定。凡人避让，高阶魔物精准锁定。',
                    '因果奇点。绝对干预权激活，伴随逻辑回弹风险。'
                ];

                let desc = descriptions[finalLevel];
                if (souls > 0) desc += `\n持有${souls}枚灵魂刻，暴露度+${souls * 5}。`;
                if (dropLevels > 0) desc += `\n⚠ 熵增淡化：${days}日无负熵，跌落${dropLevels}级。`;

                const status = finalLevel >= 5 ? 'result-danger' : (finalLevel >= 3 ? 'result-warn' : 'result-safe');
                this.updateResult(this.els.causalRes, levels[finalLevel].n, desc, status);
            },
            calcSleep() {
                const isQuality = this.els.sleepType?.value === 'quality';
                const E = parseFloat(this.els.sleepE?.value) || 1;
                const hasDrain = this.els.soulDrain?.value === 'yes';
                const count = parseInt(this.els.sleepCount?.value) || 1;

                // 修正：优质睡眠 R=50（第1次）/ R=25（第2次），与法则一致
                // 持有[灵魂耗竭]时 R=20
                let R = isQuality ? (count === 1 ? 50 : 25) : 0;
                if (hasDrain) R = 20;

                let result, desc, status;

                if (E > 0.5) {
                    result = '劣质睡眠';
                    desc = '消除3~5点损耗，仅重置微观疲劳，同日第二次无效';
                    status = 'result-warn';
                } else if (hasDrain) {
                    result = `R = ${R}`;
                    desc = '[灵魂耗竭]锁定：R降至20，仅清空槽值，状态阶级保持不变';
                    status = 'result-warn';
                } else {
                    result = `R = ${R}`;
                    const stateRecovery = isQuality ? '，提升状态阶级' : '';
                    desc = `优质睡眠: 清空槽值${stateRecovery}${count === 2 ? ' (效果减半)' : ''}`;
                }

                this.updateResult(this.els.sleepRes, result, desc, status);
            },
            calcLuck() {
                const count = parseInt(this.els.luckCount?.value) || 0;
                const streak = parseInt(this.els.luckStreak?.value) || 0;
                const env = this.els.luckEnv?.value || 'safe';

                const remaining = Math.max(0, 5 - count);
                const isSoftLocked = env === 'hazard';
                const critAccum = streak > 3 ? streak - 3 : 0;

                let result, desc, status;

                if (isSoftLocked) {
                    result = '软锁触发';
                    desc = '高熵环境/积淮区域: 好运无法触发\n环境极度不稳定，无法抽取确定性';
                    status = 'result-danger';
                } else if (count >= 5) {
                    result = '达到上限';
                    desc = '单日5次上限，超限无效\n每日黎明06:00重置计数器';
                    status = 'result-warn';
                } else {
                    result = remaining > 0 ? `可触发 ${remaining}次` : '次数用尽';
                    desc = `今日已触发: ${count}/5次`;
                    if (critAccum > 0) {
                        desc += `\n⚠ 连续好运${streak}次: 临界值累积+${critAccum}`;
                        desc += '\n副作用: 周围人遭遇[概率补偿]倒霉';
                        status = 'result-warn';
                    } else {
                        status = 'result-safe';
                    }
                }

                this.updateResult(this.els.luckRes, result, desc, status);
            },
            calcLadder() {
                const exp = parseInt(this.els.ladderRank?.value) || 0;
                const E = parseFloat(this.els.ladderEnvE?.value) || 1;
                const I = parseInt(this.els.ladderActionI?.value) || 5;

                // 修正：与法则一致，E_final = E + (Exp × 0.1)
                const E_final = E + (exp * 0.1);
                const delta = I * E_final;

                const ranks = ['无名之辈', '榜上有名', '天梯前百', '天梯前十'];
                const rankNames = { 0: '无名之辈', 1: '榜上有名', 3: '天梯前百', 6: '天梯前十' };
                const rankName = rankNames[exp] || '未知';

                let result = `Δ = ${delta.toFixed(1)}`;
                let desc, status;

                const expPenalty = I * exp * 0.1;
                if (exp === 0) {
                    desc = `${rankName}: 基础熵增 = ${I * E}`;
                    status = 'result-safe';
                } else if (exp <= 3) {
                    desc = `${rankName}: E_final=${E_final.toFixed(2)}, 暴露惩罚+${expPenalty.toFixed(1)}熵增`;
                    status = delta > 20 ? 'result-danger' : 'result-warn';
                } else {
                    desc = `${rankName}: 行走的临界值磁铁! E_final=${E_final.toFixed(2)}\n暴露惩罚+${expPenalty.toFixed(1)}, 魔潮强度×${(1 + exp * 0.15).toFixed(2)}`;
                    status = delta >= 20 ? 'result-danger' : (delta >= 10 ? 'result-warn' : 'result-safe');
                }

                // 死亡风险预警
                if (delta >= 20) {
                    desc += '\n⚠ 高熵增警告: 可能跌落两阶!';
                }

                this.updateResult(this.els.ladderRes, result, desc, status);
            },
            calcCrystal() {
                const count = parseInt(this.els.crystalCount?.value) || 0;
                const mentalIdx = parseInt(this.els.crystalMental?.value) || 0;
                const bodyIdx = parseInt(this.els.crystalBody?.value) || 2;
                const hasDrain = this.els.crystalDrain?.value === 'yes';

                const mentalStates = ['清醒', '动摇', '崩溃', '昏乱'];
                const bodyStates = ['充沛', '正常', '疲劳', '虚弱', '濑死'];
                const currentMental = mentalStates[mentalIdx];
                const currentBody = bodyStates[bodyIdx];

                let result, desc, status;

                if (mentalIdx >= 3) {
                    result = '无法吞噬';
                    desc = '昏乱状态下无法行动，更无法吞噬魔晶';
                    status = 'result-danger';
                } else if (count <= 3) {
                    const rValue = hasDrain && count === 3 ? '8-10' : '10';
                    result = `安全第${count + 1}枚`;
                    desc = `第${count + 1}枚魔晶: R=${rValue}正常生效`;
                    desc += `\n当前精神: ${currentMental} | 躯体: ${currentBody}`;
                    status = 'result-safe';
                } else if (count === 4) {
                    const rValue = hasDrain ? '8-10' : '40';
                    const nextMental = mentalStates[Math.min(mentalIdx + 1, 3)];
                    result = '高风险高回报';
                    desc = `第4枚: 精神强制跌落一阶`;
                    desc += `\n${currentMental} → ${nextMental}`;
                    if (hasDrain) {
                        desc += '\n[灵魂耗竭]限制: R降至8-10，仅清空槽值';
                    } else {
                        desc += '\n驱体恢复: 每10R提升1阶 (可从濑死→充沛)';
                    }
                    status = mentalIdx >= 2 ? 'result-danger' : 'result-warn';
                } else if (count === 5) {
                    const nextMental = mentalStates[Math.min(mentalIdx + 1, 3)];
                    result = '纯惩罚';
                    desc = `第5枚: R=0，精神强制跌落`;
                    desc += `\n${currentMental} → ${nextMental}`;
                    desc += '\n⚠ 无任何收益，纯惩罚!';
                    status = 'result-danger';
                } else {
                    const bodyDrop = Math.min(2, bodyIdx + 2);
                    const finalBody = bodyStates[Math.min(bodyIdx + 2, 4)];
                    result = '致命毒性';
                    desc = `第${count}枚: R=0, Δ+20`;
                    desc += `\n躯体强制跌落两阶: ${currentBody} → ${finalBody}`;
                    if (bodyIdx >= 3) {
                        desc += '\n⚠ 濑死状态下槽满溢出 → 死亡!';
                    }
                    status = 'result-danger';
                }

                this.updateResult(this.els.crystalRes, result, desc, status);
            },
            updateResult(el, val, desc, cls) {
                if (!el) return;
                el.className = `result ${cls}`;
                el.innerHTML = `<div class="val">${val}</div><div class="desc">${desc.replace(/\n/g, '<br>')}</div>`;
            },
            loadRules() {
                const full = document.getElementById('fullPrompt')?.textContent || '';
                if (this.els.ruleDisplay) this.els.ruleDisplay.textContent = full.trim();
            },
            copy() {
                const text = document.getElementById('fullPrompt')?.textContent || '';
                if (!text) return;

                if (navigator.clipboard?.writeText) {
                    navigator.clipboard.writeText(text).then(() => this.showCopyOk());
                } else {
                    const ta = document.createElement('textarea');
                    ta.value = text;
                    ta.style.cssText = 'position:fixed;opacity:0';
                    document.body.appendChild(ta);
                    ta.select();
                    document.execCommand('copy');
                    document.body.removeChild(ta);
                    this.showCopyOk();
                }
            },
            showCopyOk() {
                const btn = this.els.copyBtn;
                if (!btn) return;
                const orig = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> 已复制';
                btn.style.background = 'var(--safe)';
                btn.style.color = '#000';
                setTimeout(() => { btn.innerHTML = orig; btn.style.background = ''; btn.style.color = ''; }, 1500);
            },
            download() {
                const text = document.getElementById('fullPrompt')?.textContent || '';
                if (!text) return;

                const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'Aetherion_核心法则协议.md';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        };

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>

</html>
