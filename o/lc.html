<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å·çº¸è®¡ç®—å·¥å…·</title>
  <style>
    /* ===== åŸºç¡€å˜é‡ ===== */
    :root {
      --primary-color: #1976d2;
      --bg-color: #ffffff;
      --text-color: #333333;
      --input-bg: #f8f9fa;
      --module-bg: #f8f9fa;
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      --transition: 0.3s;
    }

    /* ===== æš—è‰²ä¸»é¢˜ ===== */
    [data-theme="dark"] {
      --primary-color: #5f98c7;
      --bg-color: #1a1a1a;
      --text-color: #f0f0f0;
      --input-bg: #2d2d2d;
      --module-bg: #2d2d2d;
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    /* ===== å…¨å±€æ ·å¼ ===== */
    body {
      background: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      padding: 20px;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      transition: background-color var(--transition) ease, color var(--transition) ease;
      margin: 0;
    }

    /* ===== ä¸»é¢˜åˆ‡æ¢æŒ‰é’® ===== */
    .theme-toggle {
      position: fixed;
      top: 20px;
      left: 20px;
      width: 44px;
      height: 44px;
      background: var(--primary-color);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      color: white;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      transition: transform 0.2s;
      z-index: 1000;
    }
    .theme-toggle:hover { transform: scale(1.1); }
    .theme-toggle:active { transform: scale(0.95); }

    /* ===== å¸ƒå±€å®¹å™¨ ===== */
    .calculators {
      max-width: 800px;
      margin: 60px auto 0;
    }

    .calculator-module {
      background: var(--module-bg);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
      transition: background-color var(--transition) ease;
    }

    .module-title {
      color: var(--primary-color);
      margin: 0 0 1.5rem 0;
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 0.5rem;
      font-size: 1.25rem;
    }

    /* ===== è¾“å…¥åŒºåŸŸ ===== */
    .input-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 20px;
    }

    .input-group input {
      flex: 1 1 200px; /* æœ€å°å®½åº¦200pxï¼Œè‡ªåŠ¨ä¼¸ç¼© */
      padding: 12px 16px;
      border: 1px solid #ccc;
      border-color: var(--primary-color);
      border-radius: 8px;
      background: var(--input-bg);
      color: var(--text-color);
      font-size: 1rem;
      transition: all 0.2s;
    }

    .input-group input:focus {
      outline: none;
      box-shadow: 0 0 0 2px var(--primary-color);
    }

    /* ===== ç»“æœåŒºåŸŸ ===== */
    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
    }

    .result-item {
      padding: 16px;
      background: var(--bg-color);
      border-radius: 8px;
      border: 2px solid var(--primary-color);
      text-align: center;
      font-weight: 600;
      line-height: 1.5;
      transition: transform 0.2s;
    }
    
    .result-item:hover {
      transform: translateY(-2px);
    }

    .result-value {
      color: var(--primary-color);
      font-size: 1.4em;
      margin-left: 8px;
      font-family: monospace;
      font-weight: 700;
    }

    /* ===== æç¤ºè¯­æ ·å¼ ===== */
    .result-hint {
      margin-top: 15px;
      font-size: 0.85rem;
      color: #888; /* åœ¨æš—è‰²æ¨¡å¼ä¸‹å¯èƒ½éœ€è¦è°ƒæ•´ï¼Œä¸‹æ–¹å·²å¤„ç† */
      text-align: center;
      font-style: italic;
      opacity: 0.8;
    }
    
    [data-theme="dark"] .result-hint {
      color: #bbb;
    }

    /* ===== æ‰¾åˆ°è¿™æ®µå“åº”å¼é€‚é…ä»£ç  ===== */
@media (max-width: 768px) {
  body { 
    padding: 20px; /* è¿™é‡ŒåŸæ¥æ˜¯ 10pxï¼Œæ”¹å› 20px è¾¹è·å°±å®½äº† */
  }
  .calculators { 
    margin-top: 20px; /* å¦‚æœè§‰å¾—ç¦»é¡¶éƒ¨å¤ªé˜³æŒ‰é’®å¤ªè¿‘ï¼Œå¯ä»¥æŠŠè¿™ä¸ª 60 æ”¹æˆ 80 */
  }
  .calculator-module { 
    padding: 20px; /* è¿™é‡ŒåŸæ¥æ˜¯ 16pxï¼Œæ”¹å› 20px æ¨¡å—å†…éƒ¨ä¼šæ›´é€æ°” */
  }
  .input-group input { 
    flex-basis: 100%; 
  }
  .result-grid { 
    grid-template-columns: 1fr; 
  }

  </style>
</head>

<body>
  <button class="theme-toggle" id="theme-toggle-btn" aria-label="åˆ‡æ¢ä¸»é¢˜">â˜€ï¸</button>

  <main class="calculators">
    
    <section class="calculator-module">
      <h3 class="module-title">é•¿åº¦è®¡ç®—</h3>
      <div class="input-group">
        <input type="number" id="paperNetWeight" placeholder="å‡€é‡ (kg)" step="0.01" min="0">
        <input type="number" id="paperGrammage" placeholder="å…‹é‡ (g/mÂ²)" step="0.01" min="0">
        <input type="number" id="paperWidth" placeholder="å®½åº¦ (mm)" step="0.01" min="0">
        <input type="number" id="coreDiameter" placeholder="ç©ºçº¸ç­’ç›´å¾„ (mm)" value="100" step="1" min="0">
        <input type="number" id="splitCount" placeholder="åˆ†åˆ‡å·æ•°é‡" value="2" step="1" min="1">
      </div>
      <div class="result-grid">
        <div class="result-item">
          çº¸å·æ€»é•¿åº¦ï¼š<span class="result-value" id="totalLengthResult">0</span> m
        </div>
        <div class="result-item">
          å•å·é•¿åº¦ï¼š<span class="result-value" id="singleLengthResult">0</span> m
        </div>
      </div>
      <div class="result-hint">è®¡ç®—å…¬å¼ä¸å®é™…æ•°æ®æœ‰åå·®ï¼Œä»…ä¾›å‚è€ƒ</div>
    </section>

    <section class="calculator-module">
      <h3 class="module-title">ç›´å¾„åˆ†åˆ‡è®¡ç®—</h3>
      <div class="input-group">
        <input type="number" id="totalDiameter" placeholder="åŸçº¸ æ€»ç›´å¾„ (mm)" step="1" min="0">
        <input type="number" id="coreDiameter2" placeholder="åŸçº¸ ç©ºå¿ƒçº¸èŠ¯ç›´å¾„ (mm)" step="1" min="0" value="100">
        <input type="number" id="splitCount3" placeholder="åˆ†åˆ‡åˆ€æ•°" step="1" min="1" value="2">
        <input type="number" id="splitCountCore" placeholder="åˆ†åˆ‡å ç©ºçº¸èŠ¯ç›´å¾„(mm)" step="1" min="0" value="100">
      </div>
      <div class="result-grid">
        <div class="result-item" id="splitDiameterResult">
          åˆ†åˆ‡åç›´å¾„çº¦ï¼š<span class="result-value">0</span> mm<br>
          çº¯çº¸ç¯å®½åº¦çº¦ï¼š<span class="result-value">0</span> mm
        </div>
      </div>
      <div class="result-hint">è®¡ç®—å…¬å¼ä¸å®é™…æ•°æ®æœ‰åå·®ï¼Œä»…ä¾›å‚è€ƒ</div>
    </section>
    
    <section class="calculator-module">
      <h3 class="module-title">ç›´å¾„åˆå¹¶è®¡ç®—</h3>
      <div class="input-group">
        <input type="text" id="diameterFormula" placeholder="è¾“å…¥ç›´å¾„(mm)ï¼Œå¦‚ 100*2 + 80*3">
        <input type="number" id="originalCoreDiameter" placeholder="åŸçº¸ç©ºå¿ƒç­’ç›´å¾„ (mm)" value="100" step="1" min="0">
        <input type="number" id="newCoreDiameter" placeholder="åˆå¹¶åç©ºçº¸èŠ¯ç›´å¾„ (mm)" value="100" step="1" min="0">
      </div>
      <div class="result-grid">
        <div class="result-item">
          åˆå¹¶åç›´å¾„ï¼š<span class="result-value" id="mergedDiameterResult">0</span> mm
        </div>
        <div class="result-item">
          çº¯çº¸ç¯å®½åº¦ï¼š<span class="result-value" id="paperRingWidthResult">0</span> mm
        </div>
      </div>
      <div class="result-hint">è®¡ç®—å…¬å¼ä¸å®é™…æ•°æ®æœ‰åå·®ï¼Œä»…ä¾›å‚è€ƒ</div>
    </section>

  </main>

  <script>
    // === é€šç”¨å·¥å…·å‡½æ•° ===
    const Utils = {
      // éªŒè¯æ•°å€¼ï¼šå°†è¾“å…¥è½¬æ¢ä¸ºæ•°å­—ï¼Œè‹¥æ— æ•ˆæˆ–å°äºæœ€å°å€¼åˆ™è¿”å›é»˜è®¤å€¼
      validate: (val, min = 0, def = 0) => {
        const num = parseFloat(val);
        return !isNaN(num) ? Math.max(num, min) : def;
      },
      // æ‰¹é‡ç»‘å®šäº‹ä»¶
      bindEvents: (inputs, handler) => {
        inputs.forEach(el => {
          if (el) {
            el.addEventListener('input', handler);
            el.addEventListener('change', handler); // å…¼å®¹æŸäº›æµè§ˆå™¨çš„è‡ªåŠ¨å¡«å……
          }
        });
      }
    };

    // === ä¸»é¢˜ç®¡ç†æ¨¡å— ===
    (function initTheme() {
      const btn = document.getElementById('theme-toggle-btn');
      // è¯»å–æœ¬åœ°å­˜å‚¨ï¼Œé»˜è®¤ä¸ºæµ…è‰²
      let isDark = localStorage.getItem('theme') === 'dark';
      
      const update = () => {
        document.body.setAttribute('data-theme', isDark ? 'dark' : 'light');
        btn.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
      };
      
      btn.addEventListener('click', () => {
        isDark = !isDark;
        update();
      });
      
      update(); // åˆå§‹åŒ–æ‰§è¡Œ
    })();

    // === 1. é•¿åº¦è®¡ç®—é€»è¾‘ ===
    (function initLengthCalc() {
      const dom = {
        net: document.getElementById('paperNetWeight'),
        gram: document.getElementById('paperGrammage'),
        width: document.getElementById('paperWidth'),
        core: document.getElementById('coreDiameter'),
        split: document.getElementById('splitCount'),
        totalRes: document.getElementById('totalLengthResult'),
        singleRes: document.getElementById('singleLengthResult')
      };

      const calc = () => {
        try {
          const netWeight = Utils.validate(dom.net.value);
          const grammage = Utils.validate(dom.gram.value);
          const widthM = Utils.validate(dom.width.value) / 1000; // mm -> m
          const coreM = Utils.validate(dom.core.value) / 1000;   // mm -> m
          const split = Utils.validate(dom.split.value, 1);

          // åŸºç¡€æ ¡éªŒ
          if (grammage <= 0 || widthM <= 0) {
            throw new Error("å‚æ•°ä¸è¶³");
          }

          // è®¡ç®—çº¸ç­’ä¼°é‡ (åŸºäºè¡¨é¢ç§¯é€»è¾‘ï¼Œä¿ç•™åŸé€»è¾‘)
          const coreArea = Math.PI * coreM * widthM; 
          const coreWeight = (coreArea * grammage) / 1000;

          if (netWeight <= coreWeight) {
            dom.totalRes.textContent = "å‡€é‡è¿‡å°";
            dom.singleRes.textContent = "-";
            return;
          }

          // è®¡ç®—çº¯çº¸é‡é‡
          const paperWeight = netWeight - coreWeight;
          // è®¡ç®—æ€»é•¿åº¦
          const totalLength = (paperWeight * 1000) / (grammage * widthM);
          
          dom.totalRes.textContent = totalLength.toFixed(2);
          dom.singleRes.textContent = (totalLength / split).toFixed(2);
        } catch (e) {
          dom.totalRes.textContent = "0";
          dom.singleRes.textContent = "0";
        }
      };

      Utils.bindEvents([dom.net, dom.gram, dom.width, dom.core, dom.split], calc);
      calc(); // åˆå§‹è¿è¡Œ
    })();

    // === 2. ç›´å¾„åˆ†åˆ‡è®¡ç®—é€»è¾‘ ===
    (function initSplitCalc() {
      const dom = {
        total: document.getElementById('totalDiameter'),
        core: document.getElementById('coreDiameter2'),
        num: document.getElementById('splitCount3'),
        newCore: document.getElementById('splitCountCore'),
        res: document.getElementById('splitDiameterResult')
      };

      const calc = () => {
        try {
          const D_total = Utils.validate(dom.total.value);
          const D_core = Utils.validate(dom.core.value);
          const N = Utils.validate(dom.num.value, 1);
          const D_newCore = Utils.validate(dom.newCore.value);

          // é€»è¾‘æ ¡éªŒ
          if (D_core >= D_total) throw new Error('èŠ¯å¾„è¿‡å¤§');

          // é¢ç§¯æ³•è®¡ç®—
          const areaTotal = Math.PI * Math.pow(D_total / 2, 2);
          const areaCore = Math.PI * Math.pow(D_core / 2, 2);
          const areaEffective = areaTotal - areaCore; // çº¯çº¸æ€»é¢ç§¯
          
          const areaPerRoll = areaEffective / N; // å•å·çº¯çº¸é¢ç§¯
          const areaNewTotal = areaPerRoll + Math.PI * Math.pow(D_newCore / 2, 2); // å•å·æ€»é¢ç§¯ï¼ˆå«æ–°èŠ¯ï¼‰
          
          const D_final = 2 * Math.sqrt(areaNewTotal / Math.PI);
          const widthRing = (D_final - D_newCore) / 2;

          dom.res.innerHTML = `
            åˆ†åˆ‡åç›´å¾„çº¦ï¼š<span class="result-value">${D_final.toFixed(1)}</span> mm<br>
            çº¯çº¸ç¯å®½åº¦çº¦ï¼š<span class="result-value">${widthRing.toFixed(1)}</span> mm
          `;
        } catch (e) {
          dom.res.innerHTML = `
            åˆ†åˆ‡åç›´å¾„çº¦ï¼š<span class="result-value">0</span> mm<br>
            çº¯çº¸ç¯å®½åº¦çº¦ï¼š<span class="result-value">0</span> mm
          `;
        }
      };

      Utils.bindEvents([dom.total, dom.core, dom.num, dom.newCore], calc);
      calc();
    })();

    // === 3. ç›´å¾„åˆå¹¶è®¡ç®—é€»è¾‘ ===
    (function initMergeCalc() {
      const dom = {
        formula: document.getElementById('diameterFormula'),
        oldCore: document.getElementById('originalCoreDiameter'),
        newCore: document.getElementById('newCoreDiameter'),
        resDia: document.getElementById('mergedDiameterResult'),
        resWidth: document.getElementById('paperRingWidthResult')
      };

      const calc = () => {
        try {
          const formula = dom.formula.value.replace(/\s/g, ''); // å»ç©ºæ ¼
          const D_oldCore = Utils.validate(dom.oldCore.value);
          const D_newCore = Utils.validate(dom.newCore.value);

          let totalPaperArea = 0;
          const segments = formula.split('+');
          
          // è§£æç®—å¼ "100*2 + 80"
          segments.forEach(seg => {
            if (!seg) return;
            const parts = seg.split('*');
            const dia = Utils.validate(parts[0]);
            const count = parts.length > 1 ? Utils.validate(parts[1], 1) : 1;

            if (dia > D_oldCore) {
              const fullArea = Math.PI * Math.pow(dia / 2, 2);
              const coreArea = Math.PI * Math.pow(D_oldCore / 2, 2);
              totalPaperArea += (fullArea - coreArea) * count;
            }
          });

          if (totalPaperArea <= 0) {
            dom.resDia.textContent = "0";
            dom.resWidth.textContent = "0";
            return;
          }

          // åˆå¹¶åçš„æ€»é¢ç§¯ = æ€»çº¯çº¸é¢ç§¯ + æ–°ç®¡èŠ¯é¢ç§¯
          const areaFinal = totalPaperArea + Math.PI * Math.pow(D_newCore / 2, 2);
          const D_final = 2 * Math.sqrt(areaFinal / Math.PI);
          
          dom.resDia.textContent = D_final.toFixed(1);
          dom.resWidth.textContent = ((D_final - D_newCore) / 2).toFixed(1);

        } catch (e) {
          dom.resDia.textContent = "é”™è¯¯";
          dom.resWidth.textContent = "é”™è¯¯";
        }
      };

      Utils.bindEvents([dom.formula, dom.oldCore, dom.newCore], calc);
      calc();
    })();
  </script>
</body>
</html>
