<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·çº¸è®¡ç®—ç›¸å…³</title>
    <style>
        /* ===== åŸºç¡€å˜é‡å®šä¹‰ ===== */
        :root {
            --primary-color: #1976d2;
            --background-color: #ffffff;
            --text-color: #333333;
            --input-background: #f8f9fa;
            --input-text: #333333;
            --message-background: #f8f9fa;
            --message-text: #333333;
            --transition-speed: 0.3s;
        }

        /* ===== æš—è‰²ä¸»é¢˜é…ç½® ===== */
        [data-theme="dark"] {
            --primary-color: #5f98c7;
            --background-color: #1a1a1a;
            --text-color: #f0f0f0;
            --input-background: #2d2d2d;
            --input-text: #e0e0e0;
            --message-background: #2d2d2d;
            --message-text: #e0e0e0;
        }

        /* ===== åŸºç¡€æ ·å¼ ===== */
        body {
            background: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            font-family: system-ui, -apple-system, sans-serif;
            transition: background-color var(--transition-speed) ease;
        }

        /* ===== ä¸»é¢˜åˆ‡æ¢æŒ‰é’® ===== */
        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            color: white;
            font-size: 1.2rem;
            transition: transform 0.2s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .theme-toggle.sending {
            opacity: 0.7;
        }

        /* ===== è®¡ç®—å™¨å®¹å™¨ ===== */
        .calculators {
            max-width: 800px;
            margin: 60px auto 0;
        }

        .calculator-module {
            background: var(--message-background);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all var(--transition-speed) ease;
        }

        .module-title {
            color: var(--primary-color);
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }

        /* ===== è¾“å…¥ç»„æ ·å¼ ===== */
        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .input-group input {
            flex: 1 1 30%;
            min-width: 200px;
            padding: 12px;
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            background: var(--input-background);
            color: var(--input-text);
            font-size: 1rem;
            transition: border-color var(--transition-speed) ease;
        }

        .input-group input:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* ===== ç»“æœå±•ç¤ºåŒº ===== */
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .result-item {
            padding: 16px;
            background: var(--background-color);
            border-radius: 8px;
            border: 2px solid var(--primary-color);
            text-align: center;
            font-weight: bold;
            transition: transform 0.2s ease;
        }

        .result-item:hover {
            transform: translateY(-2px);
        }

        .result-value {
            color: var(--primary-color);
            font-size: 1.3em;
            margin-left: 8px;
            font-family: monospace;
        }

        /* ===== ä¸»é¢˜åˆ‡æ¢æŒ‰é’® ===== */
        #theme-toggle-btn:active {
            background-color: #0056b3;
            transform: scale(0.9);
        }

        /* ===== ä¸»é¢˜åˆ‡æ¢æŒ‰é’® ===== */
        #theme-toggle-btn {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        /* ===== å“åº”å¼è®¾è®¡ ===== */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .calculators {
                margin-top: 40px;
            }

            .input-group input {
                flex-basis: 100%;
                min-width: auto;
            }

            .result-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
    <button class="theme-toggle">â˜€ï¸</button>

    <main class="calculators">
        <!-- å·çº¸é•¿åº¦è®¡ç®—æ¨¡å— -->
        <section class="calculator-module">
            <h3 class="module-title">é•¿åº¦è®¡ç®—</h3>
            <div class="input-group">
                <input type="number" id="paperNetWeight" placeholder="å‡€é‡ (kg)" step="0.01" min="0">
                <input type="number" id="paperGrammage" placeholder="å…‹é‡ (g/mÂ²)" step="0.01" min="0">
                <input type="number" id="paperWidth" placeholder="å®½åº¦ (mm)" step="0.01" min="0">
                <input type="number" id="coreDiameter" placeholder="ç©ºçº¸ç­’ç›´å¾„ (mm)" value="100" step="1" min="0">
                <input type="number" id="splitCount" placeholder="åˆ†åˆ‡å·æ•°é‡" value="2" step="1" min="1">
            </div>
            <div class="result-grid">
                <div class="result-item">
                    çº¸å·æ€»é•¿åº¦ï¼š<span class="result-value" id="totalLengthResult">0</span> m
                </div>
                <div class="result-item">
                    å•å·é•¿åº¦ï¼š<span class="result-value" id="singleLengthResult">0</span> m
                </div>
                <div class="result-item">
                    æ¨èåˆå§‹å¼ åŠ›ï¼š<span class="result-value" id="tensionRecommendation">0</span> kg
                </div>
            </div>
        </section>

        <!-- åˆ†æ ‹è®¡ç®—æ¨¡å— -->
        <section class="calculator-module">
            <h3 class="module-title">åˆ†æ ‹è®¡ç®—</h3>
            <div class="input-group">
                <input type="text" id="widthFormula" placeholder="è¾“å…¥ç®—å¼(mm)ï¼Œå¦‚104*11 + 91">
                <input type="number" id="splitCount2" placeholder="åˆ†åˆ‡åˆ€æ•°" value="2" min="1" step="1">
                <input type="number" id="maxHeight" placeholder="é™åˆ¶é«˜åº¦(mm)" value="1500" min="0" step="1">
            </div>
            <div class="result-grid">
                <div class="result-item">
                    åˆ†æ ‹å»ºè®®ï¼š<span class="result-value" id="distributionAdvice"></span>
                </div>
            </div>
        </section>

        <!-- èµ·ç‚¹è·ç¦»è®¡ç®—æ¨¡å— -->
        <section class="calculator-module">
            <h3 class="module-title">èµ·ç‚¹è·ç¦»è®¡ç®—</h3>
            <div class="input-group">
                <input type="number" id="shaftLength" placeholder="è½´é•¿åº¦ (mm)" step="1" min="0" value="1800">
                <input type="number" id="edgeMargin" placeholder="å•è¾¹è¾¹è·å°ºå¯¸ (mm)" step="1" min="0" value="100">
                <input type="number" id="rollWidth" placeholder="å·çº¸å®½åº¦ (mm)" step="1" min="0">
            </div>
            <div class="result-grid">
                <div class="result-item">
                    èµ·ç‚¹è·ç¦»ï¼š<span class="result-value" id="startPositionResult">0</span> mm
                </div>
            </div>
        </section>

        <!-- åˆ€ç‰‡åˆ†é…è®¡ç®—æ¨¡å—
<section class="calculator-module">
<h3 class="module-title">åˆ†åˆ‡åˆ€ç‰‡å‡åˆ†è®¡ç®—</h3>
<div class="input-group">
<input type="number" id="lowerBlades" placeholder="ä¸‹åœ†åˆ€ç‰‡æ•°" step="1" min="0" value="28">
<input type="number" id="cuttingBlades" placeholder="åˆ‡å‰²åˆ€æ•°" step="1" min="0">
<input type="number" id="flashEdges" placeholder="é£è¾¹æ•°" step="1" min="0" max="2"
oninput="this.value = Math.min(2, Math.max(0, this.value))">
</div>
<div class="result-grid">
<div class="result-item">
åˆ†é…æ–¹æ¡ˆï¼š<span class="result-value" id="bladeDistributionResult"></span>
</div>
</div>
</section>
-->

        <!-- åˆ†åˆ‡é‡é‡è®¡ç®—æ¨¡å— -->
        <section class="calculator-module">
            <h3 class="module-title">åˆ†åˆ‡é‡é‡è®¡ç®—</h3>
            <div class="input-group">
                <input type="number" id="cuttingNetWeight" placeholder="å‡€é‡ (kg)" step="0.01" min="0">
                <input type="number" id="cuttingWidth" placeholder="åŸå®½åº¦ (mm)" step="0.01" min="0">
                <input type="text" id="cuttingFormula" placeholder="è¾“å…¥åˆ†åˆ‡å®½åº¦(mm)ï¼Œå¦‚ 104*11 + 91">
            </div>
            <div class="result-grid">
                <div class="result-item">
                    åˆ†åˆ‡é‡é‡ï¼š<span class="result-value" id="cuttingWeightResult"></span>
                </div>
            </div>
        </section>

        <!-- åˆ†åˆ‡ç›´å¾„è®¡ç®—æ¨¡å— -->
        <section class="calculator-module">
            <h3 class="module-title">åˆ†åˆ‡ç›´å¾„è®¡ç®—</h3>
            <div class="input-group">
                <input type="number" id="totalDiameter" placeholder="åŸçº¸æ€»ç›´å¾„ (mm)" step="1" min="0">
                <input type="number" id="coreDiameter2" placeholder="åŸçº¸èŠ¯ç©ºå¿ƒçº¸èŠ¯ç›´å¾„ (mm)" step="1" min="0" value="100">
                <input type="number" id="splitCount3" placeholder="åˆ†åˆ‡æ•°é‡" step="1" min="1" value="2">
            </div>
            <div class="result-grid">
                <div class="result-item">
                    å»ºè®®ï¼š<span class="result-value" id="splitDiameterResult">0</span>
                </div>
            </div>
        </section>

        <section class="calculator-module">
            <h3 class="module-title">è®¡ç®—å…¬å¼</h3>
            <div class="result-grid">
                <div class="result-item">
                    é•¿åº¦ï¼š<span class="result-value" id="">(å‡€é‡kg * 1000) / (å…‹é‡g/mÂ² * å®½åº¦mm)</span></br></br>
                    åˆ†åˆ‡é‡é‡ï¼š<span class="result-value" id="">å‡€é‡ * (åˆ†åˆ‡åå®½åº¦ / åŸå®½åº¦)</span></br></br>
                    èµ·ç‚¹è·ç¦»ï¼š<span class="result-value" id="">(è½´é•¿åº¦ - å·çº¸å®½åº¦ + ä¸¤è¾¹æ€»è¾¹è·) / 2</span></br></br>
                    åˆå§‹å¼ åŠ›ï¼š<span class="result-value" id="">å‡€é‡kg * ( 0.02 & 0.045) æœ€å°å€¼-æœ€å¤§å€¼ </span></br></br>
                </div>
            </div>
        </section>

    </main>

    <script>
        // å¸¸é‡é…ç½®
        const TENSION = {
            MIN_RATIO: 0.02, // å¼ åŠ›ä¸‹é™ç³»æ•°
            MAX_RATIO: 0.045 // å¼ åŠ›ä¸Šé™ç³»æ•°
        };

        // ä¸»é¢˜ç®¡ç†æ¨¡å—
        (function initThemeManager() {
            const themeToggle = document.querySelector('.theme-toggle');
            let isDarkMode = localStorage.getItem('theme') === 'dark';

            function updateTheme() {
                document.body.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
                themeToggle.textContent = isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™';
                localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
            }

            themeToggle.addEventListener('click', () => {
                isDarkMode = !isDarkMode;
                updateTheme();
            });

            updateTheme(); // åˆå§‹åŒ–ä¸»é¢˜
        })();

        // è¾“å…¥éªŒè¯å·¥å…·
        const InputValidator = {
            /**
            * æ•°å€¼éªŒè¯ä¸æ ‡å‡†åŒ–
            * @param {string|number} value - è¾“å…¥å€¼
            * @param {number} [min=0] - æœ€å°å€¼
            * @param {number} [defaultValue=0] - é»˜è®¤è¿”å›å€¼
            * @returns {number} éªŒè¯åçš„æ•°å€¼
            */
            validate: (value, min = 0, defaultValue = 0) => {
                const numericValue = parseFloat(value);
                return !isNaN(numericValue) ? Math.max(numericValue, min) : defaultValue;
            }
        };

        // å·çº¸å‚æ•°è®¡ç®—æ¨¡å—
        (function initPaperCalculator() {
            // DOMå…ƒç´ å¼•ç”¨
            const elements = {
                netWeight: document.getElementById('paperNetWeight'),
                grammage: document.getElementById('paperGrammage'),
                width: document.getElementById('paperWidth'),
                coreDiameter: document.getElementById('coreDiameter'),
                splitCount: document.getElementById('splitCount'),
                totalLength: document.getElementById('totalLengthResult'),
                singleLength: document.getElementById('singleLengthResult'),
                tension: document.getElementById('tensionRecommendation')
            };

            // æ ¸å¿ƒè®¡ç®—é€»è¾‘
            function calculateParameters() {
                try {
                    // è¾“å…¥å€¼æ ‡å‡†åŒ–
                    const netWeight = InputValidator.validate(elements.netWeight.value); // å‡€é‡
                    const grammage = InputValidator.validate(elements.grammage.value); // å…‹é‡
                    const width = InputValidator.validate(elements.width.value) / 1000; // è½¬ç±³
                    const coreDiameter = InputValidator.validate(elements.coreDiameter.value) / 1000; // è½¬ç±³
                    const splitCount = InputValidator.validate(elements.splitCount.value, 1); // åˆ†å‰²æ•°

                    // è®¡ç®—çº¸ç­’é‡é‡
                    const coreArea = Math.PI * coreDiameter * width; // çº¸ç­’é¢ç§¯
                    const coreWeight = (coreArea * grammage) / 1000; // çº¸ç­’é‡é‡

                    // æœ‰æ•ˆæ€§æ£€æŸ¥
                    if (netWeight <= coreWeight) {
                        throw new Error('å‡€é‡å¿…é¡»å¤§äºçº¸ç­’é‡é‡');
                    }
                    if (grammage <= 0 || width <= 0) {
                        throw new Error('æ— æ•ˆçš„å…‹é‡æˆ–å®½åº¦å€¼');
                    }

                    // ä¸»è®¡ç®—é€»è¾‘
                    const paperWeight = netWeight - coreWeight; // å‡€é‡ - çº¸ç­’é‡é‡
                    const totalLength = (paperWeight * 1000) / (grammage * width); // æ€»é•¿åº¦
                    const singleLength = totalLength / splitCount; // å•å·é•¿åº¦

                    // å¼ åŠ›è®¡ç®—
                    const minTension = netWeight * TENSION.MIN_RATIO; // æœ€å°å¼ åŠ›
                    const maxTension = netWeight * TENSION.MAX_RATIO; // æœ€å¤§å¼ åŠ›

                    // æ›´æ–°æ˜¾ç¤º
                    elements.totalLength.textContent = totalLength.toFixed(2);
                    elements.singleLength.textContent = singleLength.toFixed(2);
                    elements.tension.textContent = `${minTension.toFixed(1)} - ${maxTension.toFixed(1)}`;

                } catch (error) {
                    console.error('å·çº¸å‚æ•°è®¡ç®—é”™è¯¯:', error);
                    elements.totalLength.textContent = 'é”™è¯¯';
                    elements.singleLength.textContent = 'é”™è¯¯';
                    elements.tension.textContent = 'é”™è¯¯';
                }
            }

            // äº‹ä»¶ç›‘å¬
            ['input', 'change'].forEach(event => {
                [elements.netWeight, elements.grammage, elements.width,
                elements.coreDiameter, elements.splitCount].forEach(input => {
                    input.addEventListener(event, calculateParameters);
                });
            });

            calculateParameters(); // åˆå§‹è®¡ç®—
        })();

        // åˆ†æ ‹å»ºè®®è®¡ç®—æ¨¡å—
        (function initDistributionCalculator() {
            const elements = {
                formula: document.getElementById('widthFormula'),
                splitCount: document.getElementById('splitCount2'),
                maxHeight: document.getElementById('maxHeight'),
                result: document.getElementById('distributionAdvice')
            };

            function calculateDistribution() {
                try {
                    const formula = elements.formula.value.trim(); // åˆ†æ ‹å…¬å¼
                    const splitCount = InputValidator.validate(elements.splitCount.value, 1);// åˆ†å‰²æ•°
                    const maxHeight = InputValidator.validate(elements.maxHeight.value, 1);// æœ€å¤§é«˜åº¦

                    // è§£æå…¬å¼
                    const items = new Map();
                    formula.split('+').forEach(segment => {
                        const [sizePart, count = 1] = segment.replace(/\s/g, '').split('*');
                        const size = InputValidator.validate(sizePart);
                        if (size > 0) {
                            const total = InputValidator.validate(count) * splitCount;
                            items.set(size, (items.get(size) || 0) + total);
                        }
                    });

                    // ç”Ÿæˆå»ºè®®
                    let advice = [];
                    let totalRolls = 0;

                    items.forEach((quantity, size) => {
                        totalRolls += quantity;
                        const maxPerStack = Math.floor(maxHeight / size);

                        if (maxPerStack === 0) {
                            advice.push(`<strong>${size}mm</strong> å°ºå¯¸è¿‡å¤§`);
                            return;
                        }

                        // æ ¸å¿ƒä¼˜åŒ–é€»è¾‘ï¼šå¯»æ‰¾æœ€ä¼˜åˆ†é…æ–¹æ¡ˆ
                        const minStacks = Math.ceil(quantity / maxPerStack); //æœ€å°‘åˆ†æ ‹æ•°
                        let bestStacks = minStacks; // æœ€ä¼˜åˆ†æ ‹æ•°
                        let bestPerStack = Math.floor(quantity / bestStacks);// æœ€ä¼˜æ¯æ ‹æ•°é‡
                        let remainder = quantity % bestStacks; // å‰©ä½™æ•°é‡

                        // å°è¯•æ‰¾åˆ°æ›´ä¼˜çš„å‡åˆ†æ–¹æ¡ˆ
                        for (let stacks = minStacks; stacks <= minStacks + 2; stacks++) {
                            const perStack = Math.floor(quantity / stacks);
                            const currentRemainder = quantity % stacks;

                            if (perStack <= maxPerStack &&
                                (currentRemainder === 0 || (perStack + 1) <= maxPerStack)) {
                                bestStacks = stacks;
                                bestPerStack = perStack;
                                remainder = currentRemainder;
                                break;
                            }
                        }

                        // ç”Ÿæˆåˆ†æ ‹æè¿°
                        let stackInfo = `${bestStacks}æ ‹`;
                        if (remainder === 0) {
                            stackInfo += ` (æ¯æ ‹${bestPerStack}å·)`;
                        } else {
                            stackInfo += ` (å‰${remainder}æ ‹${bestPerStack + 1}å·ï¼Œå…¶ä½™${bestPerStack}å·)`;
                        }

                        advice.push(`<strong>${size}mm</strong>: ${stackInfo}ï¼Œå…±${quantity}å·`);
                    });

                    elements.result.innerHTML = advice.join('<br>') +
                        `<br>æ€»è®¡ï¼š${totalRolls}å·`;

                } catch (error) {
                    console.error('åˆ†æ ‹è®¡ç®—é”™è¯¯:', error);
                    elements.result.textContent = 'è¾“å…¥æ ¼å¼é”™è¯¯';
                }
            }


            // äº‹ä»¶ç›‘å¬
            [elements.formula, elements.splitCount, elements.maxHeight]
                .forEach(input => input.addEventListener('input', calculateDistribution));

            calculateDistribution(); // åˆå§‹è®¡ç®—
        })();

        // èµ·ç‚¹è·ç¦»è®¡ç®—æ¨¡å—
        (function initPositionCalculator() {
            const elements = {
                shaftLength: document.getElementById('shaftLength'),
                edgeMargin: document.getElementById('edgeMargin'),
                rollWidth: document.getElementById('rollWidth'),
                result: document.getElementById('startPositionResult')
            };

            function calculatePosition() {
                try {
                    const shaftLength = InputValidator.validate(elements.shaftLength.value);
                    const edgeMargin = InputValidator.validate(elements.edgeMargin.value);
                    const rollWidth = InputValidator.validate(elements.rollWidth.value);

                    if (rollWidth > shaftLength) {
                        throw new Error('å·å®½ä¸èƒ½å¤§äºè½´é•¿');
                    }

                    const position = (shaftLength - rollWidth) / 2 + edgeMargin;
                    elements.result.textContent = position.toFixed(0);

                } catch (error) {
                    console.error('èµ·ç‚¹è®¡ç®—é”™è¯¯:', error);
                    elements.result.textContent = 'æ— æ•ˆè¾“å…¥';
                }
            }

            // äº‹ä»¶ç›‘å¬
            [elements.shaftLength, elements.edgeMargin, elements.rollWidth]
                .forEach(input => input.addEventListener('input', calculatePosition));

            calculatePosition(); // åˆå§‹è®¡ç®—
        })();

        /* åˆ€ç‰‡åˆ†é…è®¡ç®—æ¨¡å—
        (function initBladeCalculator() {
          const elements = {
            lowerBlades: document.getElementById('lowerBlades'),
            cuttingBlades: document.getElementById('cuttingBlades'),
            flashEdges: document.getElementById('flashEdges'),
            result: document.getElementById('bladeDistributionResult')
          };
        
          function calculateBladeDistribution() {
            try {
              const lowerBlades = InputValidator.validate(elements.lowerBlades.value);
              const cuttingBlades = InputValidator.validate(elements.cuttingBlades.value);
              const flashEdges = Math.min(2, InputValidator.validate(elements.flashEdges.value));
        
              // åŸºç¡€éœ€æ±‚è®¡ç®—
              const requiredForFlash = 4 * flashEdges;
              let messages = [`é£è¾¹éœ€æ±‚ï¼š${requiredForFlash}åˆ€ç‰‡`];
        
              // å¯è¡Œæ€§æ£€æŸ¥
              if (lowerBlades < requiredForFlash) {
                messages.push(`\nâŒ åˆ€ç‰‡ä¸è¶³ï¼éœ€è¦${requiredForFlash}ï¼Œå½“å‰${lowerBlades}`);
                elements.result.innerHTML = messages.join('<br>');
                return;
              }
        
              // å‰©ä½™åˆ€ç‰‡åˆ†é…
              const remainingBlades = lowerBlades - requiredForFlash;
              messages.push(`å‰©ä½™å¯ç”¨åˆ€ç‰‡ï¼š${remainingBlades}`);
        
              // æ ¸å¿ƒåˆ†é…é€»è¾‘
              if (remainingBlades < cuttingBlades) {
                messages.push(`\nâŒ åˆ‡å‰²åˆ€ç‰‡ä¸è¶³ï¼ç¼º${cuttingBlades - remainingBlades}ç‰‡`);
                } else {
                const surplus = remainingBlades - cuttingBlades;
                const totalUsed = requiredForFlash + cuttingBlades;
        
                if (surplus > 0) {
                  messages.push(`\nâœ… å……è¶³ï¼å‰©ä½™${surplus}ç‰‡å¯ç½®äºå†…ä¾§`);
                  messages.push(`å»ºè®®ï¼šå°†${surplus}ç‰‡å‡åŒ€åˆ†é…åœ¨ä¸­é—´åŒºåŸŸ`);
                  } else {
                  messages.push(`\nâœ… ç²¾ç¡®åŒ¹é…ï¼Œæ— å‰©ä½™åˆ€ç‰‡`);
                }
        
                // æœªä½¿ç”¨åˆ€ç‰‡æ£€æŸ¥
                if (totalUsed < lowerBlades) {
                  messages.push(`\nâš ï¸ æ³¨æ„ï¼šå°šæœ‰${lowerBlades - totalUsed}ç‰‡æœªä½¿ç”¨`);
                }
              }
        
              elements.result.innerHTML = messages.join('<br>');
        
              } catch (error) {
              console.error('åˆ€ç‰‡è®¡ç®—é”™è¯¯:', error);
              elements.result.textContent = 'è¾“å…¥å€¼å¼‚å¸¸';
            }
          }
        
          // äº‹ä»¶ç›‘å¬
          [elements.lowerBlades, elements.cuttingBlades, elements.flashEdges]
          .forEach(input => {
            input.addEventListener('input', calculateBladeDistribution);
          });
        
          calculateBladeDistribution(); // åˆå§‹è®¡ç®—
        })();*/

        // åˆ†åˆ‡é‡é‡è®¡ç®—æ¨¡å—
        (function initCuttingCalculator() {
            const elements = {
                netWeight: document.getElementById('cuttingNetWeight'),
                width: document.getElementById('cuttingWidth'),
                formula: document.getElementById('cuttingFormula'),
                result: document.getElementById('cuttingWeightResult')
            };

            function calculateCuttingWeight() {
                try {
                    // è¾“å…¥å€¼æ ‡å‡†åŒ–
                    const netWeight = InputValidator.validate(elements.netWeight.value);
                    const originalWidth = InputValidator.validate(elements.width.value);
                    const formula = elements.formula.value.replace(/\s/g, ''); // å»é™¤ç©ºæ ¼

                    // æœ‰æ•ˆæ€§æ£€æŸ¥
                    if (!formula || originalWidth <= 0) {
                        elements.result.textContent = 'è¯·è¾“å…¥å®Œæ•´å‚æ•°';
                        return;
                    }

                    // è§£æåˆ†åˆ‡å…¬å¼
                    const segments = formula.split('+');
                    const splitSegments = [];
                    let totalSplitWidth = 0;

                    segments.forEach(seg => {
                        const parts = seg.split('*');
                        const width = InputValidator.validate(parts[0]);
                        const count = parts.length > 1 ? InputValidator.validate(parts[1], 1) : 1;
                        if (width <= 0 || count <= 0) throw new Error("æ— æ•ˆçš„å®½åº¦æˆ–æ•°é‡");
                        splitSegments.push({ width, count });
                        totalSplitWidth += width * count;
                    });

                    // éªŒè¯æ€»å®½åº¦
                    if (Math.abs(totalSplitWidth - originalWidth) > 2) {//è¯¯å·®2mm
                        throw new Error(`åˆ†åˆ‡æ€»å®½åº¦${totalSplitWidth}mmä¸åŸå®½åº¦${originalWidth}mmä¸ç¬¦`);
                    }

                    // ç”Ÿæˆç»“æœ
                    let results = [];
                    splitSegments.forEach(({ width, count }) => {
                        const totalSegmentWeight = netWeight * (width * count) / originalWidth;
                        const singleWeight = totalSegmentWeight / count;
                        results.push(
                            `${width}mm * ${count}å·ï¼Œå•å·ï¼š${singleWeight.toFixed(2)} kg ï¼Œå…± ${totalSegmentWeight.toFixed(2)} kg `
                        );
                    });

                    elements.result.innerHTML = results.join('<br>');

                } catch (error) {
                    console.error('åˆ†åˆ‡è®¡ç®—é”™è¯¯:', error);
                    elements.result.textContent = error.message || 'è®¡ç®—é”™è¯¯';
                }
            }

            // äº‹ä»¶ç›‘å¬
            [elements.netWeight, elements.width, elements.formula]
                .forEach(input => input.addEventListener('input', calculateCuttingWeight));

            calculateCuttingWeight(); // åˆå§‹è®¡ç®—
        })();

        // ç›´å¾„åˆ†åˆ‡è®¡ç®—
        (function initSplitCalculator() {
            const elements = {
                totalDia: document.getElementById('totalDiameter'),
                coreDia: document.getElementById('coreDiameter2'),
                splitNum: document.getElementById('splitCount3'),
                result: document.getElementById('splitDiameterResult')
            };

            function calculateSplitDiameter() {
                try {
                    // è¾“å…¥å€¼æ ‡å‡†åŒ–ï¼ˆå«è¾¹ç•Œå¤„ç†ï¼‰
                    const totalDiameter = InputValidator.validate(elements.totalDia.value, 1); // æ€»ç›´å¾„å¿…é¡»â‰¥1mm
                    const coreDiameter = InputValidator.validate(elements.coreDia.value, 0); // ç©ºå¿ƒç›´å¾„å¯0ï¼ˆå®å¿ƒçº¸å·åœºæ™¯ï¼‰
                    const splitCount = InputValidator.validate(elements.splitNum.value, 1); // åˆ†åˆ‡æ•°å¿…é¡»â‰¥1

                    // å·¥ç¨‹é€»è¾‘æ ¡éªŒ
                    if (coreDiameter >= totalDiameter) {
                        throw new Error('å‚æ•°é”™è¯¯');
                    }

                    // æ ¸å¿ƒè®¡ç®—ï¼šåŸºäºé¢ç§¯å®ˆæ’åŸç†ï¼ˆåœ†ç¯é¢ç§¯å‡åˆ†ï¼‰
                    const totalArea = Math.PI * ((totalDiameter / 2) ** 2 - (coreDiameter / 2) ** 2); // æ€»æœ‰æ•ˆé¢ç§¯
                    const singleArea = totalArea / splitCount; // å•å·æœ‰æ•ˆé¢ç§¯
                    const singleRadius = Math.sqrt(singleArea / Math.PI); // å•å·åŠå¾„
                    const splitDiameter = (2 * singleRadius).toFixed(1); // è®¡ç®—ç›´å¾„å¹¶ä¿ç•™1ä½å°æ•°

                    //è®¡ç®— çº¸ç¯å‚ç›´å®½åº¦(å¤§åœ†åŠå¾„å‡å°çº¸èŠ¯åŠå¾„)
                    const singleCoreRadius = Math.sqrt((singleArea - Math.PI * (coreDiameter / 2) ** 2) / Math.PI).toFixed(1);

                    elements.result.innerHTML = `å•ä¸ªç›´å¾„çº¦ï¼š` + splitDiameter + ' mm' + '<br>' + 'å•ä¸ªçº¸ç¯å‚ç›´å®½åº¦çº¦ï¼š ' + singleCoreRadius + ' mm';
                } catch (error) {
                    elements.result.textContent = error.message || 'è¾“å…¥å¼‚å¸¸'; // å‹å¥½é”™è¯¯æç¤º
                }
            }

            // å…¨é‡è¾“å…¥é¡¹ç›‘å¬ï¼ˆä¿®å¤åŸç›‘å¬ä¸å…¨é—®é¢˜ï¼‰
            [elements.totalDia, elements.coreDia, elements.splitNum].forEach(input => {
                input.addEventListener('input', calculateSplitDiameter);
            });

            calculateSplitDiameter(); // åˆå§‹åŒ–è®¡ç®—
        })();


    </script>
</body>

</html>