<!doctype html>
<html lang="zh-CN">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å·çº¸å‚æ•°è®¡ç®—</title>
  <style>
    :root {
      --primary-color: #1976d2;
      --bg-color: #FFFFFF;
      --text-color: #333333;
      --input-bg-color: #F8F9FA;
      --input-text-color: #333333;
      --message-bg-color: #F8F9FA;
      --message-text-color: #333333;
      --transition-speed: 0.3s;
    }

    [data-theme="dark"] {
      --primary-color: #5f98c7;
      --bg-color: #1a1a1a;
      --text-color: #f0f0f0;
      --input-bg-color: #2d2d2d;
      --input-text-color: #E0E0E0;
      --message-bg-color: #2d2d2d;
      --message-text-color: #E0E0E0;
    }

    body {
      background: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      transition: background var(--transition-speed) ease;
    }

    .theme-toggle {
      position: fixed;
      top: 20px;
      left: 20px;
      width: 40px;
      height: 40px;
      background: var(--primary-color);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      color: white;
      font-size: 18px;
      transition: transform 0.2s ease;
    }

    .theme-toggle:hover {
      transform: scale(1.1);
    }

    .calculators {
      max-width: 800px;
      margin: 60px auto 0;
    }

    .calc-container {
      background: var(--message-bg-color);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all var(--transition-speed) ease;
    }

    .calc-container h3 {
      color: var(--primary-color);
      margin-bottom: 16px;
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 8px;
    }

    .input-group {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    input {
      padding: 12px;
      border: 1px solid var(--primary-color);
      border-radius: 8px;
      background: var(--input-bg-color);
      color: var(--input-text-color);
      font-size: 16px;
      transition: border-color var(--transition-speed) ease;
    }

    input:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .result-box {
      padding: 16px;
      background: var(--bg-color);
      border-radius: 8px;
      border: 2px solid var(--primary-color);
      text-align: center;
      font-weight: bold;
      transition: transform 0.2s ease;
    }

    .result-box:hover {
      transform: translateY(-2px);
    }

    .result-value {
      color: var(--primary-color);
      font-size: 1.3em;
      margin-left: 8px;
      font-family: monospace;
    }

    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      .calculators {
        margin-top: 40px;
      }
      .input-group {
        grid-template-columns: 1fr;
      }
      .result-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
 </head>
 <body>
  <button class="theme-toggle">â˜€ï¸</button> <!-- å·çº¸è®¡ç®—æ¨¡å— -->
  <div class="calc-container">
   <h3>å·çº¸å‚æ•°è®¡ç®—</h3>
   <div class="input-group">
    <input type="number" id="netWeight" placeholder="å‡€é‡ (kg)" step="0.01" min="0"> <input type="number" id="grammage" placeholder="å…‹é‡ (g/mÂ²)" step="0.01" min="0"> <input type="number" id="width" placeholder="å®½åº¦ (cm)" step="0.01" min="0"> <input type="number" id="tubeDiameter" placeholder="ç©ºçº¸ç­’ç›´å¾„ (mm)" value="98" step="1" min="0"> <input type="number" id="cutCount" placeholder="åˆ†åˆ‡å·æ•°é‡" value="2" step="1" min="1">
   </div>
   <div class="result-grid">
    <div class="result-box">
     çº¸å·æ€»é•¿åº¦çº¦ï¼š<span class="result-value" id="lengthResult">0</span> m
    </div>
    <div class="result-box">
     åˆ†åˆ‡åå•å·é•¿åº¦çº¦ï¼š<span class="result-value" id="lengthResultAfterCut">0</span> m
    </div>
    <div class="result-box">
     æ¨èå¼ åŠ›èŒƒå›´ï¼š<span class="result-value" id="tensionAdvice">0</span> kg
    </div>
   </div>
  </div>
  <script>
    // å¸¸é‡é…ç½®
    const TENSION_MIN_RATIO = 0.02; // å¼ åŠ›ä¸‹é™ç³»æ•°
    const TENSION_MAX_RATIO = 0.045; // å¼ åŠ›ä¸Šé™ç³»æ•°

    // ä¸»é¢˜ç®¡ç†æ¨¡å—
    const themeToggle = document.querySelector('.theme-toggle');
    let isDarkTheme = localStorage.getItem('theme') === 'dark';

    function toggleTheme() {
      isDarkTheme = !isDarkTheme;
      document.body.setAttribute('data-theme', isDarkTheme ? 'dark' : 'light');
      themeToggle.textContent = isDarkTheme ? 'â˜€ï¸' : 'ğŸŒ™';
      localStorage.setItem('theme', isDarkTheme ? 'dark' : 'light');
    }

    // è¾“å…¥éªŒè¯æ¨¡å—
    function validateInput(value, min=0) {
      return Math.max(parseFloat(value) || min, min);
    }

    // è®¡ç®—æ ¸å¿ƒæ¨¡å—
    function calculatePaperParams() {
      try {
        // è¾“å…¥å€¼æ ‡å‡†åŒ–å¤„ç†
        const netWeight = validateInput(document.getElementById('netWeight').value);
        const grammage = validateInput(document.getElementById('grammage').value);
        const width = validateInput(document.getElementById('width').value) / 100; // cmè½¬m
        const tubeDiameter = validateInput(document.getElementById('tubeDiameter').value) / 1000; // mmè½¬m
        const cutCount = validateInput(document.getElementById('cutCount').value, 1);

        // çº¸ç­’å‚æ•°è®¡ç®—
        const tubeWeight = (Math.PI * tubeDiameter * width * grammage) / 1000;
        const paperWeight = netWeight - tubeWeight;

        // å¼‚å¸¸å¤„ç†
        if (paperWeight < 0) return showError("å‡€é‡ä¸è¶³");
        if (grammage === 0 || width === 0) return showError("æ— æ•ˆå‚æ•°");

        // æ ¸å¿ƒè®¡ç®—é€»è¾‘
        const length = (paperWeight * 1000) / (grammage * width);
        const lengthAfterCut = length / cutCount;
        
        // å‡ ä½•å‚æ•°è®¡ç®—
        const paperThickness = (paperWeight / grammage) * 0.1; // mm
        const totalRadius = (tubeDiameter/2 + paperThickness) * 1000;
        const singleRadius = (tubeDiameter/2 + paperThickness/cutCount) * 1000;

        // å¼ åŠ›å»ºè®®
        const tensionMin = netWeight * TENSION_MIN_RATIO;
        const tensionMax = netWeight * TENSION_MAX_RATIO;

        // æ›´æ–°æ˜¾ç¤º
        updateDisplay({
          length: length.toFixed(2),
          lengthAfterCut: lengthAfterCut.toFixed(2),
          totalDiameter: (totalRadius * 2).toFixed(2),
          singleDiameter: (singleRadius * 2).toFixed(2),
          tension: `${tensionMin.toFixed(1)} - ${tensionMax.toFixed(1)}`,
        });

      } catch (e) {
        showError("è®¡ç®—å¼‚å¸¸");
      }
    }

    // æ˜¾ç¤ºæ›´æ–°æ¨¡å—
    function updateDisplay(data) {
      document.getElementById('lengthResult').textContent = data.length;
      document.getElementById('lengthResultAfterCut').textContent = data.lengthAfterCut;
      document.getElementById('tensionAdvice').textContent = data.tension;
    }

    // é”™è¯¯å¤„ç†æ¨¡å—
    function showError(message) {
      const elements = document.querySelectorAll('.result-value');
      elements.forEach(el => el.textContent = message);
    }

    // äº‹ä»¶ç›‘å¬å™¨ï¼ˆä½¿ç”¨äº‹ä»¶å§”æ‰˜ï¼‰
    document.querySelector('.calc-container').addEventListener('input', (e) => {
      if (e.target.tagName === 'INPUT') calculatePaperParams();
    });

    // åˆå§‹åŒ–ç³»ç»Ÿ
    document.body.setAttribute('data-theme', isDarkTheme ? 'dark' : 'light');
    themeToggle.textContent = isDarkTheme ? 'â˜€ï¸' : 'ğŸŒ™';
    themeToggle.addEventListener('click', toggleTheme);
    calculatePaperParams();
  </script>
 </body>
</html>