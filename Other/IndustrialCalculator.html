<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜é€Ÿå·çº¸åˆ†åˆ‡è®¡ç®—ç³»ç»Ÿ</title>
    <style>
        /* ===== åŸºç¡€å˜é‡å®šä¹‰ ===== */
        :root {
            --primary-color: #1976d2;
            --background-color: #ffffff;
            --text-color: #333333;
            --input-background: #f8f9fa;
            --input-text: #333333;
            --message-background: #f8f9fa;
            --message-text: #333333;
            --transition-speed: 0.3s;
        }

        /* ===== æš—è‰²ä¸»é¢˜é…ç½® ===== */
        [data-theme="dark"] {
            --primary-color: #5f98c7;
            --background-color: #1a1a1a;
            --text-color: #f0f0f0;
            --input-background: #2d2d2d;
            --input-text: #e0e0e0;
            --message-background: #2d2d2d;
            --message-text: #e0e0e0;
        }

        /* ===== åŸºç¡€æ ·å¼ ===== */
        body {
            background: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            font-family: system-ui, -apple-system, sans-serif;
            transition: background-color var(--transition-speed) ease;
        }

        /* ===== ä¸»é¢˜åˆ‡æ¢æŒ‰é’® ===== */
        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            color: white;
            font-size: 1.2rem;
            transition: transform 0.2s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* ===== è®¡ç®—å™¨å®¹å™¨ ===== */
        .calculators {
            max-width: 800px;
            margin: 60px auto 0;
        }

        .calculator-module {
            background: var(--message-background);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all var(--transition-speed) ease;
        }

        .module-title {
            color: var(--primary-color);
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }

        /* ===== è¾“å…¥ç»„æ ·å¼ ===== */
        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .input-group input {
            flex: 1 1 30%;
            min-width: 200px;
            padding: 12px;
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            background: var(--input-background);
            color: var(--input-text);
            font-size: 1rem;
            transition: border-color var(--transition-speed) ease;
        }

        .input-group input:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* ===== ç»“æœå±•ç¤ºåŒº ===== */
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .result-item {
            padding: 16px;
            background: var(--background-color);
            border-radius: 8px;
            border: 2px solid var(--primary-color);
            text-align: center;
            font-weight: bold;
            transition: transform 0.2s ease;
        }

        .result-item:hover {
            transform: translateY(-2px);
        }

        .result-value {
            color: var(--primary-color);
            font-size: 1.3em;
            margin-left: 8px;
            font-family: monospace;
        }

        /* ===== å“åº”å¼è®¾è®¡ ===== */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .calculators {
                margin-top: 40px;
            }

            .input-group input {
                flex-basis: 100%;
                min-width: auto;
            }

            .result-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
    <button class="theme-toggle">â˜€ï¸</button>

    <main class="calculators">
        <!-- å·çº¸å‚æ•°è®¡ç®—æ¨¡å— -->
        <section class="calculator-module">
            <h3 class="module-title">å·çº¸å‚æ•°è®¡ç®—</h3>
            <div class="input-group">
                <input type="number" id="paperNetWeight" placeholder="å‡€é‡ (kg)" step="0.01" min="0">
                <input type="number" id="paperGrammage" placeholder="å…‹é‡ (g/mÂ²)" step="0.01" min="0">
                <input type="number" id="paperWidth" placeholder="å®½åº¦ (mm)" step="0.01" min="0">
                <input type="number" id="coreDiameter" placeholder="ç©ºçº¸ç­’ç›´å¾„ (mm)" value="98" step="1" min="0">
                <input type="number" id="splitCount" placeholder="åˆ†åˆ‡å·æ•°é‡" value="2" step="1" min="1">
            </div>
            <div class="result-grid">
                <div class="result-item">
                    çº¸å·æ€»é•¿åº¦ï¼š<span class="result-value" id="totalLengthResult">0</span> m
                </div>
                <div class="result-item">
                    å•å·é•¿åº¦ï¼š<span class="result-value" id="singleLengthResult">0</span> m
                </div>
                <div class="result-item">
                    æ¨èå¼ åŠ›ï¼š<span class="result-value" id="tensionRecommendation">0</span> kg
                </div>
            </div>
        </section>

        <!-- äº§å“åˆ†æ ‹è®¡ç®—æ¨¡å— -->
        <section class="calculator-module">
            <h3 class="module-title">åˆ†å‰²åäº§å“åˆ†æ ‹è®¡ç®—</h3>
            <div class="input-group">
                <input type="text" id="widthFormula" placeholder="è¾“å…¥ç®—å¼(mm)ï¼Œå¦‚104*11 + 91">
                <input type="number" id="splitCount2" placeholder="åˆ†åˆ‡å·æ•°" value="2" min="1" step="1">
                <input type="number" id="maxHeight" placeholder="é™åˆ¶é«˜åº¦(mm)" value="1600" min="0" step="1">
            </div>
            <div class="result-grid">
                <div class="result-item">
                    åˆ†æ ‹å»ºè®®ï¼š<span class="result-value" id="distributionAdvice"></span>
                </div>
            </div>
        </section>

        <!-- èµ·ç‚¹è·ç¦»è®¡ç®—æ¨¡å— -->
        <section class="calculator-module">
            <h3 class="module-title">èµ·ç‚¹è·ç¦»è®¡ç®—</h3>
            <div class="input-group">
                <input type="number" id="shaftLength" placeholder="è½´é•¿åº¦ (mm)" step="1" min="0" value="1800">
                <input type="number" id="edgeMargin" placeholder="è¾¹è·å°ºå¯¸ (mm)" step="1" min="0" value="100">
                <input type="number" id="rollWidth" placeholder="å·çº¸å®½åº¦ (mm)" step="1" min="0">
            </div>
            <div class="result-grid">
                <div class="result-item">
                    èµ·ç‚¹è·ç¦»ï¼š<span class="result-value" id="startPositionResult">0</span> mm
                </div>
            </div>
        </section>

        <!-- åˆ€ç‰‡åˆ†é…è®¡ç®—æ¨¡å— -->
        <section class="calculator-module">
            <h3 class="module-title">åˆ†åˆ‡åˆ€ç‰‡å‡åˆ†è®¡ç®—</h3>
            <div class="input-group">
                <input type="number" id="lowerBlades" placeholder="ä¸‹åœ†åˆ€ç‰‡æ•°" step="1" min="0" value="28">
                <input type="number" id="cuttingBlades" placeholder="åˆ‡å‰²åˆ€æ•°" step="1" min="0">
                <input type="number" id="flashEdges" placeholder="é£è¾¹æ•°" step="1" min="0" max="2"
                    oninput="this.value = Math.min(2, Math.max(0, this.value))">
            </div>
            <div class="result-grid">
                <div class="result-item">
                    åˆ†é…æ–¹æ¡ˆï¼š<span class="result-value" id="bladeDistributionResult"></span>
                </div>
            </div>
        </section>
    </main>

    <script>
        // å¸¸é‡é…ç½®
        const TENSION = {
            MIN_RATIO: 0.02,  // å¼ åŠ›ä¸‹é™ç³»æ•°
            MAX_RATIO: 0.045  // å¼ åŠ›ä¸Šé™ç³»æ•°
        };

        // ä¸»é¢˜ç®¡ç†æ¨¡å—
        (function initThemeManager() {
            const themeToggle = document.querySelector('.theme-toggle');
            let isDarkMode = localStorage.getItem('theme') === 'dark';

            function updateTheme() {
                document.body.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
                themeToggle.textContent = isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™';
                localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
            }

            themeToggle.addEventListener('click', () => {
                isDarkMode = !isDarkMode;
                updateTheme();
            });

            updateTheme(); // åˆå§‹åŒ–ä¸»é¢˜
        })();

        // è¾“å…¥éªŒè¯å·¥å…·
        const InputValidator = {
            /**
             * æ•°å€¼éªŒè¯ä¸æ ‡å‡†åŒ–
             * @param {string|number} value - è¾“å…¥å€¼
             * @param {number} [min=0] - æœ€å°å€¼
             * @param {number} [defaultValue=0] - é»˜è®¤è¿”å›å€¼
             * @returns {number} éªŒè¯åçš„æ•°å€¼
             */
            validate: (value, min = 0, defaultValue = 0) => {
                const numericValue = parseFloat(value);
                return !isNaN(numericValue) ? Math.max(numericValue, min) : defaultValue;
            }
        };

        // å·çº¸å‚æ•°è®¡ç®—æ¨¡å—
        (function initPaperCalculator() {
            // DOMå…ƒç´ å¼•ç”¨
            const elements = {
                netWeight: document.getElementById('paperNetWeight'),
                grammage: document.getElementById('paperGrammage'),
                width: document.getElementById('paperWidth'),
                coreDiameter: document.getElementById('coreDiameter'),
                splitCount: document.getElementById('splitCount'),
                totalLength: document.getElementById('totalLengthResult'),
                singleLength: document.getElementById('singleLengthResult'),
                tension: document.getElementById('tensionRecommendation')
            };

            // æ ¸å¿ƒè®¡ç®—é€»è¾‘
            function calculateParameters() {
                try {
                    // è¾“å…¥å€¼æ ‡å‡†åŒ–
                    const netWeight = InputValidator.validate(elements.netWeight.value);
                    const grammage = InputValidator.validate(elements.grammage.value);
                    const width = InputValidator.validate(elements.width.value) / 1000; // è½¬ç±³
                    const coreDiameter = InputValidator.validate(elements.coreDiameter.value) / 1000;
                    const splitCount = InputValidator.validate(elements.splitCount.value, 1);

                    // è®¡ç®—çº¸ç­’é‡é‡
                    const coreArea = Math.PI * coreDiameter * width;
                    const coreWeight = (coreArea * grammage) / 1000;

                    // æœ‰æ•ˆæ€§æ£€æŸ¥
                    if (netWeight <= coreWeight) {
                        throw new Error('å‡€é‡å¿…é¡»å¤§äºçº¸ç­’é‡é‡');
                    }
                    if (grammage <= 0 || width <= 0) {
                        throw new Error('æ— æ•ˆçš„å…‹é‡æˆ–å®½åº¦å€¼');
                    }

                    // ä¸»è®¡ç®—é€»è¾‘
                    const paperWeight = netWeight - coreWeight;
                    const totalLength = (paperWeight * 1000) / (grammage * width);
                    const singleLength = totalLength / splitCount;

                    // å¼ åŠ›è®¡ç®—
                    const minTension = netWeight * TENSION.MIN_RATIO;
                    const maxTension = netWeight * TENSION.MAX_RATIO;

                    // æ›´æ–°æ˜¾ç¤º
                    elements.totalLength.textContent = totalLength.toFixed(2);
                    elements.singleLength.textContent = singleLength.toFixed(2);
                    elements.tension.textContent = `${minTension.toFixed(1)} - ${maxTension.toFixed(1)}`;

                } catch (error) {
                    console.error('å·çº¸å‚æ•°è®¡ç®—é”™è¯¯:', error);
                    elements.totalLength.textContent = 'é”™è¯¯';
                    elements.singleLength.textContent = 'é”™è¯¯';
                    elements.tension.textContent = 'é”™è¯¯';
                }
            }

            // äº‹ä»¶ç›‘å¬
            ['input', 'change'].forEach(event => {
                [elements.netWeight, elements.grammage, elements.width,
                elements.coreDiameter, elements.splitCount].forEach(input => {
                    input.addEventListener(event, calculateParameters);
                });
            });

            calculateParameters(); // åˆå§‹è®¡ç®—
        })();

        // åˆ†æ ‹å»ºè®®è®¡ç®—æ¨¡å—
        (function initDistributionCalculator() {
            const elements = {
                formula: document.getElementById('widthFormula'),
                splitCount: document.getElementById('splitCount2'),
                maxHeight: document.getElementById('maxHeight'),
                result: document.getElementById('distributionAdvice')
            };

            function calculateDistribution() {
                try {
                    const formula = elements.formula.value.trim();
                    const splitCount = InputValidator.validate(elements.splitCount.value, 1);
                    const maxHeight = InputValidator.validate(elements.maxHeight.value, 1);

                    // è§£æå…¬å¼
                    const items = new Map();
                    formula.split('+').forEach(segment => {
                        const [sizePart, count = 1] = segment.replace(/\s/g, '').split('*');
                        const size = InputValidator.validate(sizePart);
                        if (size > 0) {
                            const total = InputValidator.validate(count) * splitCount;
                            items.set(size, (items.get(size) || 0) + total);
                        }
                    });

                    // ç”Ÿæˆå»ºè®®
                    let advice = [];
                    let totalRolls = 0;

                    items.forEach((quantity, size) => {
                        totalRolls += quantity;
                        const maxPerStack = Math.floor(maxHeight / size);

                        if (maxPerStack === 0) {
                            advice.push(`<strong>${size}mm</strong> å°ºå¯¸è¿‡å¤§`);
                            return;
                        }

                        const stacks = Math.ceil(quantity / maxPerStack);
                        const remainder = quantity % maxPerStack;

                        let stackInfo = `${stacks}æ ‹ (æ¯æ ‹â‰¤${maxPerStack})`;
                        if (remainder > 0) stackInfo += `ï¼Œæœ«æ ‹${remainder}å·`;

                        advice.push(`<strong>${size}mm</strong>: ${stackInfo}ï¼Œå…±${quantity}å·`);
                    });

                    elements.result.innerHTML = advice.join('<br>') +
                        `<br>æ€»è®¡ï¼š${totalRolls}å·`;

                } catch (error) {
                    console.error('åˆ†æ ‹è®¡ç®—é”™è¯¯:', error);
                    elements.result.textContent = 'è¾“å…¥æ ¼å¼é”™è¯¯';
                }
            }

            // äº‹ä»¶ç›‘å¬
            [elements.formula, elements.splitCount, elements.maxHeight]
                .forEach(input => input.addEventListener('input', calculateDistribution));

            calculateDistribution(); // åˆå§‹è®¡ç®—
        })();

        // èµ·ç‚¹è·ç¦»è®¡ç®—æ¨¡å—
        (function initPositionCalculator() {
            const elements = {
                shaftLength: document.getElementById('shaftLength'),
                edgeMargin: document.getElementById('edgeMargin'),
                rollWidth: document.getElementById('rollWidth'),
                result: document.getElementById('startPositionResult')
            };

            function calculatePosition() {
                try {
                    const shaftLength = InputValidator.validate(elements.shaftLength.value);
                    const edgeMargin = InputValidator.validate(elements.edgeMargin.value);
                    const rollWidth = InputValidator.validate(elements.rollWidth.value);

                    if (rollWidth > shaftLength) {
                        throw new Error('å·å®½ä¸èƒ½å¤§äºè½´é•¿');
                    }

                    const position = (shaftLength - rollWidth) / 2 + edgeMargin;
                    elements.result.textContent = position.toFixed(0);

                } catch (error) {
                    console.error('èµ·ç‚¹è®¡ç®—é”™è¯¯:', error);
                    elements.result.textContent = 'æ— æ•ˆè¾“å…¥';
                }
            }

            // äº‹ä»¶ç›‘å¬
            [elements.shaftLength, elements.edgeMargin, elements.rollWidth]
                .forEach(input => input.addEventListener('input', calculatePosition));

            calculatePosition(); // åˆå§‹è®¡ç®—
        })();

        // åˆ€ç‰‡åˆ†é…è®¡ç®—æ¨¡å—
        (function initBladeCalculator() {
            const elements = {
                lowerBlades: document.getElementById('lowerBlades'),
                cuttingBlades: document.getElementById('cuttingBlades'),
                flashEdges: document.getElementById('flashEdges'),
                result: document.getElementById('bladeDistributionResult')
            };

            function calculateBladeDistribution() {
                try {
                    const lowerBlades = InputValidator.validate(elements.lowerBlades.value);
                    const cuttingBlades = InputValidator.validate(elements.cuttingBlades.value);
                    const flashEdges = Math.min(2, InputValidator.validate(elements.flashEdges.value));

                    // åŸºç¡€éœ€æ±‚è®¡ç®—
                    const requiredForFlash = 4 * flashEdges;
                    let messages = [`é£è¾¹éœ€æ±‚ï¼š${requiredForFlash}åˆ€ç‰‡`];

                    // å¯è¡Œæ€§æ£€æŸ¥
                    if (lowerBlades < requiredForFlash) {
                        messages.push(`\nâŒ åˆ€ç‰‡ä¸è¶³ï¼éœ€è¦${requiredForFlash}ï¼Œå½“å‰${lowerBlades}`);
                        elements.result.innerHTML = messages.join('<br>');
                        return;
                    }

                    // å‰©ä½™åˆ€ç‰‡åˆ†é…
                    const remainingBlades = lowerBlades - requiredForFlash;
                    messages.push(`å‰©ä½™å¯ç”¨åˆ€ç‰‡ï¼š${remainingBlades}`);

                    // æ ¸å¿ƒåˆ†é…é€»è¾‘
                    if (remainingBlades < cuttingBlades) {
                        messages.push(`\nâŒ åˆ‡å‰²åˆ€ç‰‡ä¸è¶³ï¼ç¼º${cuttingBlades - remainingBlades}ç‰‡`);
                    } else {
                        const surplus = remainingBlades - cuttingBlades;
                        const totalUsed = requiredForFlash + cuttingBlades;

                        if (surplus > 0) {
                            messages.push(`\nâœ… å……è¶³ï¼å‰©ä½™${surplus}ç‰‡å¯ç½®äºå†…ä¾§`);
                            messages.push(`å»ºè®®ï¼šå°†${surplus}ç‰‡å‡åŒ€åˆ†é…åœ¨ä¸­é—´åŒºåŸŸ`);
                        } else {
                            messages.push(`\nâœ… ç²¾ç¡®åŒ¹é…ï¼Œæ— å‰©ä½™åˆ€ç‰‡`);
                        }

                        // æœªä½¿ç”¨åˆ€ç‰‡æ£€æŸ¥
                        if (totalUsed < lowerBlades) {
                            messages.push(`\nâš ï¸ æ³¨æ„ï¼šå°šæœ‰${lowerBlades - totalUsed}ç‰‡æœªä½¿ç”¨`);
                        }
                    }

                    elements.result.innerHTML = messages.join('<br>');

                } catch (error) {
                    console.error('åˆ€ç‰‡è®¡ç®—é”™è¯¯:', error);
                    elements.result.textContent = 'è¾“å…¥å€¼å¼‚å¸¸';
                }
            }

            // äº‹ä»¶ç›‘å¬
            [elements.lowerBlades, elements.cuttingBlades, elements.flashEdges]
                .forEach(input => {
                    input.addEventListener('input', calculateBladeDistribution);
                });

            calculateBladeDistribution(); // åˆå§‹è®¡ç®—
        })();

    </script>
</body>

</html>